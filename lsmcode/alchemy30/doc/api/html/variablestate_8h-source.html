<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Alchemy: src/logic/variablestate.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="classes.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir_bad0962745a374caf6e9fb10c9087375.html">src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_5fa6dff3c95823d97bd37bbb86c0a4ab.html">logic</a></div>
<h1>variablestate.h</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * All of the documentation and software included in the</span>
<a name="l00003"></a>00003 <span class="comment"> * Alchemy Software is copyrighted by Stanley Kok, Parag</span>
<a name="l00004"></a>00004 <span class="comment"> * Singla, Matthew Richardson, Pedro Domingos, Marc</span>
<a name="l00005"></a>00005 <span class="comment"> * Sumner and Hoifung Poon.</span>
<a name="l00006"></a>00006 <span class="comment"> * </span>
<a name="l00007"></a>00007 <span class="comment"> * Copyright [2004-07] Stanley Kok, Parag Singla, Matthew</span>
<a name="l00008"></a>00008 <span class="comment"> * Richardson, Pedro Domingos, Marc Sumner and Hoifung</span>
<a name="l00009"></a>00009 <span class="comment"> * Poon. All rights reserved.</span>
<a name="l00010"></a>00010 <span class="comment"> * </span>
<a name="l00011"></a>00011 <span class="comment"> * Contact: Pedro Domingos, University of Washington</span>
<a name="l00012"></a>00012 <span class="comment"> * (pedrod@cs.washington.edu).</span>
<a name="l00013"></a>00013 <span class="comment"> * </span>
<a name="l00014"></a>00014 <span class="comment"> * Redistribution and use in source and binary forms, with</span>
<a name="l00015"></a>00015 <span class="comment"> * or without modification, are permitted provided that</span>
<a name="l00016"></a>00016 <span class="comment"> * the following conditions are met:</span>
<a name="l00017"></a>00017 <span class="comment"> * </span>
<a name="l00018"></a>00018 <span class="comment"> * 1. Redistributions of source code must retain the above</span>
<a name="l00019"></a>00019 <span class="comment"> * copyright notice, this list of conditions and the</span>
<a name="l00020"></a>00020 <span class="comment"> * following disclaimer.</span>
<a name="l00021"></a>00021 <span class="comment"> * </span>
<a name="l00022"></a>00022 <span class="comment"> * 2. Redistributions in binary form must reproduce the</span>
<a name="l00023"></a>00023 <span class="comment"> * above copyright notice, this list of conditions and the</span>
<a name="l00024"></a>00024 <span class="comment"> * following disclaimer in the documentation and/or other</span>
<a name="l00025"></a>00025 <span class="comment"> * materials provided with the distribution.</span>
<a name="l00026"></a>00026 <span class="comment"> * </span>
<a name="l00027"></a>00027 <span class="comment"> * 3. All advertising materials mentioning features or use</span>
<a name="l00028"></a>00028 <span class="comment"> * of this software must display the following</span>
<a name="l00029"></a>00029 <span class="comment"> * acknowledgment: "This product includes software</span>
<a name="l00030"></a>00030 <span class="comment"> * developed by Stanley Kok, Parag Singla, Matthew</span>
<a name="l00031"></a>00031 <span class="comment"> * Richardson, Pedro Domingos, Marc Sumner and Hoifung</span>
<a name="l00032"></a>00032 <span class="comment"> * Poon in the Department of Computer Science and</span>
<a name="l00033"></a>00033 <span class="comment"> * Engineering at the University of Washington".</span>
<a name="l00034"></a>00034 <span class="comment"> * </span>
<a name="l00035"></a>00035 <span class="comment"> * 4. Your publications acknowledge the use or</span>
<a name="l00036"></a>00036 <span class="comment"> * contribution made by the Software to your research</span>
<a name="l00037"></a>00037 <span class="comment"> * using the following citation(s): </span>
<a name="l00038"></a>00038 <span class="comment"> * Stanley Kok, Parag Singla, Matthew Richardson and</span>
<a name="l00039"></a>00039 <span class="comment"> * Pedro Domingos (2005). "The Alchemy System for</span>
<a name="l00040"></a>00040 <span class="comment"> * Statistical Relational AI", Technical Report,</span>
<a name="l00041"></a>00041 <span class="comment"> * Department of Computer Science and Engineering,</span>
<a name="l00042"></a>00042 <span class="comment"> * University of Washington, Seattle, WA.</span>
<a name="l00043"></a>00043 <span class="comment"> * http://www.cs.washington.edu/ai/alchemy.</span>
<a name="l00044"></a>00044 <span class="comment"> * </span>
<a name="l00045"></a>00045 <span class="comment"> * 5. Neither the name of the University of Washington nor</span>
<a name="l00046"></a>00046 <span class="comment"> * the names of its contributors may be used to endorse or</span>
<a name="l00047"></a>00047 <span class="comment"> * promote products derived from this software without</span>
<a name="l00048"></a>00048 <span class="comment"> * specific prior written permission.</span>
<a name="l00049"></a>00049 <span class="comment"> * </span>
<a name="l00050"></a>00050 <span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE UNIVERSITY OF WASHINGTON</span>
<a name="l00051"></a>00051 <span class="comment"> * AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED</span>
<a name="l00052"></a>00052 <span class="comment"> * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED</span>
<a name="l00053"></a>00053 <span class="comment"> * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR</span>
<a name="l00054"></a>00054 <span class="comment"> * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE UNIVERSITY</span>
<a name="l00055"></a>00055 <span class="comment"> * OF WASHINGTON OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,</span>
<a name="l00056"></a>00056 <span class="comment"> * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL</span>
<a name="l00057"></a>00057 <span class="comment"> * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF</span>
<a name="l00058"></a>00058 <span class="comment"> * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR</span>
<a name="l00059"></a>00059 <span class="comment"> * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON</span>
<a name="l00060"></a>00060 <span class="comment"> * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</span>
<a name="l00061"></a>00061 <span class="comment"> * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</span>
<a name="l00062"></a>00062 <span class="comment"> * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN</span>
<a name="l00063"></a>00063 <span class="comment"> * IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00064"></a>00064 <span class="comment"> * </span>
<a name="l00065"></a>00065 <span class="comment"> */</span>
<a name="l00066"></a>00066 <span class="preprocessor">#ifndef VARIABLESTATE_H_</span>
<a name="l00067"></a>00067 <span class="preprocessor"></span><span class="preprocessor">#define VARIABLESTATE_H_</span>
<a name="l00068"></a>00068 <span class="preprocessor"></span>
<a name="l00069"></a>00069 <span class="preprocessor">#include "mrf.h"</span>
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 <span class="keyword">const</span> <span class="keywordtype">int</span> NOVALUE = -1;
<a name="l00072"></a>00072 <span class="keyword">const</span> <span class="keywordtype">bool</span> vsdebug = <span class="keyword">false</span>;
<a name="l00073"></a>00073 
<a name="l00093"></a><a class="code" href="classVariableState.html">00093</a> <span class="keyword">class </span><a class="code" href="classVariableState.html">VariableState</a>
<a name="l00094"></a>00094 {
<a name="l00095"></a>00095  <span class="keyword">public</span>:
<a name="l00096"></a>00096 
<a name="l00115"></a><a class="code" href="classVariableState.html#abd28fc5eef663c5ec3d1e67cd313047">00115</a>   <a class="code" href="classVariableState.html#abd28fc5eef663c5ec3d1e67cd313047">VariableState</a>(<a class="code" href="classHashArray.html">GroundPredicateHashArray</a>* <span class="keyword">const</span>&amp; unknownQueries,
<a name="l00116"></a>00116                 <a class="code" href="classHashArray.html">GroundPredicateHashArray</a>* <span class="keyword">const</span>&amp; knownQueries,
<a name="l00117"></a>00117                 <a class="code" href="classArray.html">Array&lt;TruthValue&gt;</a>* <span class="keyword">const</span> &amp; knownQueryValues,
<a name="l00118"></a>00118                 <span class="keyword">const</span> <a class="code" href="classArray.html">Array&lt;int&gt;</a>* <span class="keyword">const</span> &amp; allPredGndingsAreQueries,
<a name="l00119"></a>00119                 <span class="keyword">const</span> <span class="keywordtype">bool</span>&amp; markHardGndClauses,
<a name="l00120"></a>00120                 <span class="keyword">const</span> <span class="keywordtype">bool</span>&amp; trackParentClauseWts,
<a name="l00121"></a>00121                 <span class="keyword">const</span> <a class="code" href="classMLN.html">MLN</a>* <span class="keyword">const</span> &amp; mln, <span class="keyword">const</span> <a class="code" href="classDomain.html">Domain</a>* <span class="keyword">const</span> &amp; domain,
<a name="l00122"></a>00122                 <span class="keyword">const</span> <span class="keywordtype">bool</span>&amp; lazy)
<a name="l00123"></a>00123   {
<a name="l00124"></a>00124     this-&gt;mln_ = (<a class="code" href="classMLN.html">MLN</a>*)mln;
<a name="l00125"></a>00125     this-&gt;domain_ = (<a class="code" href="classDomain.html">Domain</a>*)domain;
<a name="l00126"></a>00126     this-&gt;lazy_ = lazy;
<a name="l00127"></a>00127 
<a name="l00128"></a>00128       <span class="comment">// Instantiate information</span>
<a name="l00129"></a>00129     baseNumAtoms_ = 0;
<a name="l00130"></a>00130     activeAtoms_ = 0;
<a name="l00131"></a>00131     numFalseClauses_ = 0;
<a name="l00132"></a>00132     costOfFalseClauses_ = 0.0;
<a name="l00133"></a>00133     lowCost_ = LDBL_MAX;
<a name="l00134"></a>00134     lowBad_ = INT_MAX;
<a name="l00135"></a>00135 
<a name="l00136"></a>00136       <span class="comment">// Clauses and preds are stored in gndClauses_ and gndPreds_</span>
<a name="l00137"></a>00137     gndClauses_ = <span class="keyword">new</span> <a class="code" href="classArray.html">Array&lt;GroundClause*&gt;</a>;
<a name="l00138"></a>00138     gndPreds_ = <span class="keyword">new</span> <a class="code" href="classArray.html">Array&lt;GroundPredicate*&gt;</a>;
<a name="l00139"></a>00139 
<a name="l00140"></a>00140       <span class="comment">// Set the hard clause weight</span>
<a name="l00141"></a>00141     setHardClauseWeight();
<a name="l00142"></a>00142 
<a name="l00143"></a>00143       <span class="comment">// Lazy version: Produce state with initial active atoms and clauses</span>
<a name="l00144"></a>00144     <span class="keywordflow">if</span> (lazy_)
<a name="l00145"></a>00145     {
<a name="l00146"></a>00146         <span class="comment">// Unknown preds are treated as false</span>
<a name="l00147"></a>00147       domain_-&gt;<a class="code" href="classDomain.html#732940c3a6c4064099aaf353513b553f">getDB</a>()-&gt;<a class="code" href="classDatabase.html#f9e84d7c6945e840453c46b2c72b5d16">setPerformingInference</a>(<span class="keyword">true</span>);
<a name="l00148"></a>00148 
<a name="l00149"></a>00149         <span class="comment">// Blocks are copied from the domain</span>
<a name="l00150"></a>00150       <a class="code" href="classVariableState.html#7b3f22000c5ad265858bc34da586b280">initLazyBlocks</a>();
<a name="l00151"></a>00151 
<a name="l00152"></a>00152       clauseLimit_ = INT_MAX;
<a name="l00153"></a>00153       noApprox_ = <span class="keyword">false</span>;
<a name="l00154"></a>00154       haveDeactivated_ = <span class="keyword">false</span>;
<a name="l00155"></a>00155 
<a name="l00157"></a>00157         <span class="comment">// Get initial set of active atoms (atoms in unsat. clauses)</span>
<a name="l00158"></a>00158         <span class="comment">// Assumption is: all atoms are initially false except those in blocks</span>
<a name="l00159"></a>00159 
<a name="l00160"></a>00160         <span class="comment">// One atom in each block is set to true and activated</span>
<a name="l00161"></a>00161       <a class="code" href="classVariableState.html#328560d1ccaecf634090c84a72fb094f">addOneAtomToEachBlock</a>();
<a name="l00162"></a>00162 
<a name="l00163"></a>00163 <span class="comment">//cout &lt;&lt; "After addOneAtomToEachBlock" &lt;&lt; endl;</span>
<a name="l00164"></a>00164 <span class="comment">//for (int i = 1; i &lt; atom_.size(); i++)</span>
<a name="l00165"></a>00165 <span class="comment">//  cout &lt;&lt; atom_[i] &lt;&lt; endl;</span>
<a name="l00166"></a>00166 
<a name="l00167"></a>00167       <span class="keywordtype">bool</span> ignoreActivePreds = <span class="keyword">false</span>;
<a name="l00168"></a>00168       <a class="code" href="classVariableState.html#1944a7ef1d312dab635ad19801ba13f7">getActiveClauses</a>(newClauses_, ignoreActivePreds);
<a name="l00169"></a>00169       <span class="keywordtype">int</span> defaultCnt = newClauses_.<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>();
<a name="l00170"></a>00170       <span class="keywordtype">long</span> <span class="keywordtype">double</span> defaultCost = 0;
<a name="l00171"></a>00171 
<a name="l00172"></a>00172       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; defaultCnt; i++)
<a name="l00173"></a>00173       {
<a name="l00174"></a>00174         <span class="keywordflow">if</span> (newClauses_[i]-&gt;isHardClause())
<a name="l00175"></a>00175           defaultCost += hardWt_;
<a name="l00176"></a>00176         <span class="keywordflow">else</span>
<a name="l00177"></a>00177           defaultCost += abs(newClauses_[i]-&gt;getWt());
<a name="l00178"></a>00178       }
<a name="l00179"></a>00179 
<a name="l00180"></a>00180         <span class="comment">// Clear ground clauses in the ground preds</span>
<a name="l00181"></a>00181       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; gndPredHashArray_.<a class="code" href="classHashArray.html#ccdf0d4f7188821cd872b1618312fbd0">size</a>(); i++)
<a name="l00182"></a>00182         gndPredHashArray_[i]-&gt;removeGndClauses();
<a name="l00183"></a>00183 
<a name="l00184"></a>00184         <span class="comment">// Delete new clauses</span>
<a name="l00185"></a>00185       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; newClauses_.<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>(); i++)
<a name="l00186"></a>00186         <span class="keyword">delete</span> newClauses_[i];
<a name="l00187"></a>00187       newClauses_.<a class="code" href="classArray.html#732046291e31f830757e0847280fb593">clear</a>();
<a name="l00188"></a>00188 
<a name="l00189"></a>00189       baseNumAtoms_ = gndPredHashArray_.<a class="code" href="classHashArray.html#ccdf0d4f7188821cd872b1618312fbd0">size</a>();
<a name="l00190"></a>00190       cout &lt;&lt; <span class="stringliteral">"Number of Baseatoms = "</span> &lt;&lt; baseNumAtoms_ &lt;&lt; endl;
<a name="l00191"></a>00191       cout &lt;&lt; <span class="stringliteral">"Default =&gt; Cost\t"</span> &lt;&lt; <span class="stringliteral">"******\t"</span> &lt;&lt; <span class="stringliteral">" Clause Cnt\t"</span> &lt;&lt; endl;
<a name="l00192"></a>00192       cout &lt;&lt; <span class="stringliteral">"           "</span> &lt;&lt; defaultCost &lt;&lt; <span class="stringliteral">"\t"</span> &lt;&lt; <span class="stringliteral">"******\t"</span> &lt;&lt; defaultCnt
<a name="l00193"></a>00193            &lt;&lt; <span class="stringliteral">"\t"</span> &lt;&lt; endl &lt;&lt; endl;
<a name="l00194"></a>00194 
<a name="l00195"></a>00195         <span class="comment">// Set base atoms as active in DB</span>
<a name="l00196"></a>00196       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; baseNumAtoms_; i++)
<a name="l00197"></a>00197       {
<a name="l00198"></a>00198         domain_-&gt;<a class="code" href="classDomain.html#732940c3a6c4064099aaf353513b553f">getDB</a>()-&gt;<a class="code" href="classDatabase.html#60d5fbbfcda7a0e255e3727f4b7b148d">setActiveStatus</a>(gndPredHashArray_[i], <span class="keyword">true</span>);
<a name="l00199"></a>00199         activeAtoms_++;        
<a name="l00200"></a>00200       }
<a name="l00201"></a>00201 
<a name="l00202"></a>00202         <span class="comment">// Add the rest of the atoms in the blocks, but don't activate</span>
<a name="l00203"></a>00203       <a class="code" href="classVariableState.html#d6804e71c36bc1d271ee2b3cbaf81750">fillLazyBlocks</a>();
<a name="l00204"></a>00204 
<a name="l00205"></a>00205         <span class="comment">// Get the initial set of active clauses</span>
<a name="l00206"></a>00206       ignoreActivePreds = <span class="keyword">false</span>;
<a name="l00207"></a>00207       <a class="code" href="classVariableState.html#1944a7ef1d312dab635ad19801ba13f7">getActiveClauses</a>(newClauses_, ignoreActivePreds);      
<a name="l00208"></a>00208     } <span class="comment">// End lazy version</span>
<a name="l00209"></a>00209       <span class="comment">// Eager version: Use KBMC to produce the state</span>
<a name="l00210"></a>00210     <span class="keywordflow">else</span>
<a name="l00211"></a>00211     {
<a name="l00212"></a>00212       unePreds_ = unknownQueries;
<a name="l00213"></a>00213       knePreds_ = knownQueries;
<a name="l00214"></a>00214       knePredValues_ = knownQueryValues;
<a name="l00215"></a>00215 
<a name="l00216"></a>00216         <span class="comment">// MRF is built on known and unknown queries</span>
<a name="l00217"></a>00217       <span class="keywordtype">int</span> size = 0;
<a name="l00218"></a>00218       <span class="keywordflow">if</span> (unknownQueries) size += unknownQueries-&gt;<a class="code" href="classHashArray.html#ccdf0d4f7188821cd872b1618312fbd0">size</a>();
<a name="l00219"></a>00219       <span class="keywordflow">if</span> (knownQueries) size += knownQueries-&gt;<a class="code" href="classHashArray.html#ccdf0d4f7188821cd872b1618312fbd0">size</a>();
<a name="l00220"></a>00220       <a class="code" href="classHashArray.html">GroundPredicateHashArray</a>* queries = <span class="keyword">new</span> <a class="code" href="classHashArray.html">GroundPredicateHashArray</a>(size);
<a name="l00221"></a>00221       <span class="keywordflow">if</span> (unknownQueries) queries-&gt;<a class="code" href="classHashArray.html#5b55b617cd22fd9e0557de4d15a608be">append</a>(unknownQueries);
<a name="l00222"></a>00222       <span class="keywordflow">if</span> (knownQueries) queries-&gt;<a class="code" href="classHashArray.html#5b55b617cd22fd9e0557de4d15a608be">append</a>(knownQueries);
<a name="l00223"></a>00223       mrf_ = <span class="keyword">new</span> <a class="code" href="classMRF.html">MRF</a>(queries, allPredGndingsAreQueries, domain_,
<a name="l00224"></a>00224                      domain_-&gt;<a class="code" href="classDomain.html#732940c3a6c4064099aaf353513b553f">getDB</a>(), mln_, markHardGndClauses,
<a name="l00225"></a>00225                      trackParentClauseWts, -1);
<a name="l00226"></a>00226         <span class="comment">//delete to save space. Can be deleted because no more gndClauses are</span>
<a name="l00227"></a>00227         <span class="comment">//appended to gndPreds beyond this point</span>
<a name="l00228"></a>00228       mrf_-&gt;<a class="code" href="classMRF.html#54120a9ab60129f2d30a00a905db1209">deleteGndPredsGndClauseSets</a>();
<a name="l00229"></a>00229         <span class="comment">//do not delete the intArrRep in gndPreds_;</span>
<a name="l00230"></a>00230       <span class="keyword">delete</span> queries;
<a name="l00231"></a>00231 
<a name="l00232"></a>00232         <span class="comment">// Blocks built in MRF</span>
<a name="l00233"></a>00233       blocks_ = mrf_-&gt;<a class="code" href="classMRF.html#71a0712a7e1536494212b81e83966c04">getBlocks</a>();
<a name="l00234"></a>00234       blockEvidence_ = mrf_-&gt;<a class="code" href="classMRF.html#be7dfddd29cb3e226a3c438c1611d12f">getBlockEvidence</a>();
<a name="l00235"></a>00235         
<a name="l00236"></a>00236         <span class="comment">// Put ground clauses in newClauses_</span>
<a name="l00237"></a>00237       newClauses_ = *(<a class="code" href="classArray.html">Array&lt;GroundClause*&gt;</a>*)mrf_-&gt;<a class="code" href="classMRF.html#31490672018fd7951507f5ed404a0c18">getGndClauses</a>();
<a name="l00238"></a>00238         <span class="comment">// Put ground preds in the hash array</span>
<a name="l00239"></a>00239       <span class="comment">//const Array&lt;GroundPredicate*&gt;* gndPreds = mrf_-&gt;getGndPreds();</span>
<a name="l00240"></a>00240       <span class="keyword">const</span> <a class="code" href="classHashArray.html">GroundPredicateHashArray</a>* gndPreds = mrf_-&gt;<a class="code" href="classMRF.html#a9705576b7a99ee3158766ce841e6230">getGndPreds</a>();
<a name="l00241"></a>00241       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; gndPreds-&gt;<a class="code" href="classHashArray.html#ccdf0d4f7188821cd872b1618312fbd0">size</a>(); i++)
<a name="l00242"></a>00242         gndPredHashArray_.<a class="code" href="classHashArray.html#5b55b617cd22fd9e0557de4d15a608be">append</a>((*gndPreds)[i]);
<a name="l00243"></a>00243     
<a name="l00244"></a>00244         <span class="comment">// baseNumAtoms_ are all atoms in eager version</span>
<a name="l00245"></a>00245       baseNumAtoms_ = gndPredHashArray_.<a class="code" href="classHashArray.html#ccdf0d4f7188821cd872b1618312fbd0">size</a>();        
<a name="l00246"></a>00246     } <span class="comment">// End eager version</span>
<a name="l00247"></a>00247     
<a name="l00248"></a>00248       <span class="comment">// At this point, ground clauses are held in newClauses_</span>
<a name="l00249"></a>00249       <span class="comment">// and ground predicates are held in gndPredHashArray_</span>
<a name="l00250"></a>00250       <span class="comment">// for both versions</span>
<a name="l00251"></a>00251     
<a name="l00252"></a>00252       <span class="comment">// Add the clauses and preds and fill info arrays</span>
<a name="l00253"></a>00253     <span class="keywordtype">bool</span> initial = <span class="keyword">true</span>;
<a name="l00254"></a>00254     <a class="code" href="classVariableState.html#2748a93f222dafedaf7443634e234ddd">addNewClauses</a>(initial);
<a name="l00255"></a>00255     
<a name="l00256"></a>00256     cout &lt;&lt; <span class="stringliteral">"Initial num. of clauses: "</span> &lt;&lt; <a class="code" href="classVariableState.html#703e262481d6c0b076799511af07df67">getNumClauses</a>() &lt;&lt; endl;
<a name="l00257"></a>00257   }
<a name="l00258"></a>00258 
<a name="l00263"></a><a class="code" href="classVariableState.html#42046a00643e0464dcc6798b9c132f63">00263</a>   <a class="code" href="classVariableState.html#42046a00643e0464dcc6798b9c132f63">~VariableState</a>()
<a name="l00264"></a>00264   {
<a name="l00265"></a>00265     <span class="keywordflow">if</span> (lazy_)
<a name="l00266"></a>00266     {
<a name="l00267"></a>00267         <span class="comment">// Block information from lazy version is deleted</span>
<a name="l00268"></a>00268       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; blocks_-&gt;<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>(); i++)
<a name="l00269"></a>00269         (*blocks_)[i].clearAndCompress();
<a name="l00270"></a>00270       <span class="keyword">delete</span> blocks_;
<a name="l00271"></a>00271     
<a name="l00272"></a>00272       <span class="keyword">delete</span> blockEvidence_;  
<a name="l00273"></a>00273     }
<a name="l00274"></a>00274     <span class="keywordflow">else</span>
<a name="l00275"></a>00275     {
<a name="l00276"></a>00276         <span class="comment">// MRF from eager version is deleted</span>
<a name="l00277"></a>00277       <span class="keywordflow">if</span> (mrf_) <span class="keyword">delete</span> mrf_;
<a name="l00278"></a>00278       <span class="comment">//if (unePreds_) delete unePreds_;</span>
<a name="l00279"></a>00279       <span class="comment">//if (knePreds_) delete knePreds_;</span>
<a name="l00280"></a>00280       <span class="comment">//if (knePredValues_) delete knePredValues_;</span>
<a name="l00281"></a>00281     }    
<a name="l00282"></a>00282   }
<a name="l00283"></a>00283 
<a name="l00284"></a>00284 
<a name="l00292"></a><a class="code" href="classVariableState.html#2748a93f222dafedaf7443634e234ddd">00292</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#2748a93f222dafedaf7443634e234ddd">addNewClauses</a>(<span class="keywordtype">bool</span> initial)
<a name="l00293"></a>00293   {
<a name="l00294"></a>00294     <span class="keywordflow">if</span> (vsdebug)
<a name="l00295"></a>00295       cout &lt;&lt; <span class="stringliteral">"Adding "</span> &lt;&lt; newClauses_.<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>() &lt;&lt; <span class="stringliteral">" new clauses.."</span> &lt;&lt; endl;
<a name="l00296"></a>00296 
<a name="l00297"></a>00297       <span class="comment">// Store the old number of clauses and atoms</span>
<a name="l00298"></a>00298     <span class="keywordtype">int</span> oldNumClauses = <a class="code" href="classVariableState.html#703e262481d6c0b076799511af07df67">getNumClauses</a>();
<a name="l00299"></a>00299     <span class="keywordtype">int</span> oldNumAtoms = <a class="code" href="classVariableState.html#bc520a99648ee29ef9447b86c26d9faf">getNumAtoms</a>();
<a name="l00300"></a>00300 
<a name="l00301"></a>00301     gndClauses_-&gt;<a class="code" href="classArray.html#752db599431d93ee14c5b0f7b05ba03a">append</a>(newClauses_);
<a name="l00302"></a>00302     gndPreds_-&gt;<a class="code" href="classArray.html#a8417f3aab7a56eee773c45173c77626">growToSize</a>(gndPredHashArray_.<a class="code" href="classHashArray.html#ccdf0d4f7188821cd872b1618312fbd0">size</a>());
<a name="l00303"></a>00303 
<a name="l00304"></a>00304     <span class="keywordtype">int</span> numAtoms = <a class="code" href="classVariableState.html#bc520a99648ee29ef9447b86c26d9faf">getNumAtoms</a>();
<a name="l00305"></a>00305     <span class="keywordtype">int</span> numClauses = <a class="code" href="classVariableState.html#703e262481d6c0b076799511af07df67">getNumClauses</a>();
<a name="l00306"></a>00306       <span class="comment">// If no new atoms or clauses have been added, then do nothing</span>
<a name="l00307"></a>00307     <span class="keywordflow">if</span> (numAtoms == oldNumAtoms &amp;&amp; numClauses == oldNumClauses) <span class="keywordflow">return</span>;
<a name="l00308"></a>00308 
<a name="l00309"></a>00309     <span class="keywordflow">if</span> (vsdebug) cout &lt;&lt; <span class="stringliteral">"Clauses: "</span> &lt;&lt; numClauses &lt;&lt; endl;
<a name="l00310"></a>00310       <span class="comment">// atomIdx starts at 1</span>
<a name="l00311"></a>00311     atom_.<a class="code" href="classArray.html#a8417f3aab7a56eee773c45173c77626">growToSize</a>(numAtoms + 1, <span class="keyword">false</span>);
<a name="l00312"></a>00312 
<a name="l00313"></a>00313     makeCost_.<a class="code" href="classArray.html#a8417f3aab7a56eee773c45173c77626">growToSize</a>(numAtoms + 1, 0.0);
<a name="l00314"></a>00314     breakCost_.<a class="code" href="classArray.html#a8417f3aab7a56eee773c45173c77626">growToSize</a>(numAtoms + 1, 0.0);
<a name="l00315"></a>00315     lowAtom_.<a class="code" href="classArray.html#a8417f3aab7a56eee773c45173c77626">growToSize</a>(numAtoms + 1, <span class="keyword">false</span>);
<a name="l00316"></a>00316     fixedAtom_.<a class="code" href="classArray.html#a8417f3aab7a56eee773c45173c77626">growToSize</a>(numAtoms + 1, 0);
<a name="l00317"></a>00317 
<a name="l00318"></a>00318       <span class="comment">// Copy ground preds to gndPreds_ and set values in atom and lowAtom</span>
<a name="l00319"></a>00319     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = oldNumAtoms; i &lt; gndPredHashArray_.<a class="code" href="classHashArray.html#ccdf0d4f7188821cd872b1618312fbd0">size</a>(); i++)
<a name="l00320"></a>00320     {
<a name="l00321"></a>00321       (*gndPreds_)[i] = gndPredHashArray_[i];
<a name="l00322"></a>00322 
<a name="l00323"></a>00323       <span class="keywordflow">if</span> (vsdebug)
<a name="l00324"></a>00324       {
<a name="l00325"></a>00325         cout &lt;&lt; <span class="stringliteral">"New pred: "</span>;
<a name="l00326"></a>00326         (*gndPreds_)[i]-&gt;print(cout, domain_);
<a name="l00327"></a>00327         cout &lt;&lt; endl;
<a name="l00328"></a>00328       }
<a name="l00329"></a>00329 
<a name="l00330"></a>00330       lowAtom_[i + 1] = atom_[i + 1] = 
<a name="l00331"></a>00331         (domain_-&gt;<a class="code" href="classDomain.html#732940c3a6c4064099aaf353513b553f">getDB</a>()-&gt;<a class="code" href="classDatabase.html#599fbc0b7e396c424f747a4c8bedd25e">getValue</a>((*gndPreds_)[i]) == TRUE) ? <span class="keyword">true</span> : <span class="keyword">false</span>;
<a name="l00332"></a>00332     }
<a name="l00333"></a>00333     newClauses_.<a class="code" href="classArray.html#732046291e31f830757e0847280fb593">clear</a>();
<a name="l00334"></a>00334 
<a name="l00335"></a>00335     clause_.<a class="code" href="classArray.html#a8417f3aab7a56eee773c45173c77626">growToSize</a>(numClauses);
<a name="l00336"></a>00336     clauseCost_.<a class="code" href="classArray.html#a8417f3aab7a56eee773c45173c77626">growToSize</a>(numClauses);
<a name="l00337"></a>00337     falseClause_.<a class="code" href="classArray.html#a8417f3aab7a56eee773c45173c77626">growToSize</a>(numClauses);
<a name="l00338"></a>00338     whereFalse_.<a class="code" href="classArray.html#a8417f3aab7a56eee773c45173c77626">growToSize</a>(numClauses);
<a name="l00339"></a>00339     numTrueLits_.<a class="code" href="classArray.html#a8417f3aab7a56eee773c45173c77626">growToSize</a>(numClauses);
<a name="l00340"></a>00340     watch1_.<a class="code" href="classArray.html#a8417f3aab7a56eee773c45173c77626">growToSize</a>(numClauses);
<a name="l00341"></a>00341     watch2_.<a class="code" href="classArray.html#a8417f3aab7a56eee773c45173c77626">growToSize</a>(numClauses);
<a name="l00342"></a>00342     isSatisfied_.<a class="code" href="classArray.html#a8417f3aab7a56eee773c45173c77626">growToSize</a>(numClauses, <span class="keyword">false</span>);
<a name="l00343"></a>00343     deadClause_.<a class="code" href="classArray.html#a8417f3aab7a56eee773c45173c77626">growToSize</a>(numClauses, <span class="keyword">false</span>);
<a name="l00344"></a>00344     threshold_.<a class="code" href="classArray.html#a8417f3aab7a56eee773c45173c77626">growToSize</a>(numClauses, <span class="keyword">false</span>);
<a name="l00345"></a>00345 
<a name="l00346"></a>00346     occurence_.<a class="code" href="classArray.html#a8417f3aab7a56eee773c45173c77626">growToSize</a>(2*numAtoms + 1);
<a name="l00347"></a>00347 
<a name="l00348"></a>00348     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = oldNumClauses; i &lt; numClauses; i++)
<a name="l00349"></a>00349     {
<a name="l00350"></a>00350       <a class="code" href="classGroundClause.html">GroundClause</a>* gndClause = (*gndClauses_)[i];
<a name="l00351"></a>00351 
<a name="l00352"></a>00352       <span class="keywordflow">if</span> (vsdebug)
<a name="l00353"></a>00353       {
<a name="l00354"></a>00354         cout &lt;&lt; <span class="stringliteral">"New clause: "</span>;
<a name="l00355"></a>00355         gndClause-&gt;print(cout, domain_, &amp;gndPredHashArray_);
<a name="l00356"></a>00356         cout &lt;&lt; endl;
<a name="l00357"></a>00357       }
<a name="l00358"></a>00358       
<a name="l00359"></a>00359         <span class="comment">// Set thresholds for clause selection</span>
<a name="l00360"></a>00360       <span class="keywordflow">if</span> (gndClause-&gt;isHardClause()) threshold_[i] = RAND_MAX;
<a name="l00361"></a>00361       <span class="keywordflow">else</span>
<a name="l00362"></a>00362       {
<a name="l00363"></a>00363         <span class="keywordtype">double</span> w = gndClause-&gt;getWt();
<a name="l00364"></a>00364         threshold_[i] = RAND_MAX*(1 - exp(-abs(w)));
<a name="l00365"></a>00365         <span class="keywordflow">if</span> (vsdebug)
<a name="l00366"></a>00366         {
<a name="l00367"></a>00367           cout &lt;&lt; <span class="stringliteral">"Weight: "</span> &lt;&lt; w &lt;&lt; endl;            
<a name="l00368"></a>00368         }
<a name="l00369"></a>00369       }
<a name="l00370"></a>00370       <span class="keywordflow">if</span> (vsdebug)
<a name="l00371"></a>00371         cout &lt;&lt; <span class="stringliteral">"Threshold: "</span> &lt;&lt; threshold_[i] &lt;&lt; endl;            
<a name="l00372"></a>00372       
<a name="l00373"></a>00373       <span class="keywordtype">int</span> numGndPreds = gndClause-&gt;getNumGroundPredicates();
<a name="l00374"></a>00374       clause_[i].<a class="code" href="classArray.html#a8417f3aab7a56eee773c45173c77626">growToSize</a>(numGndPreds);
<a name="l00375"></a>00375 
<a name="l00376"></a>00376       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; numGndPreds; j++) 
<a name="l00377"></a>00377       {
<a name="l00378"></a>00378         <span class="keywordtype">int</span> lit = gndClause-&gt;getGroundPredicateIndex(j);
<a name="l00379"></a>00379         clause_[i][j] = lit;
<a name="l00380"></a>00380         <span class="keywordtype">int</span> litIdx = 2*abs(lit) - (lit &gt; 0);
<a name="l00381"></a>00381         occurence_[litIdx].<a class="code" href="classArray.html#752db599431d93ee14c5b0f7b05ba03a">append</a>(i);
<a name="l00382"></a>00382       }
<a name="l00383"></a>00383 
<a name="l00384"></a>00384         <span class="comment">// Hard clause weight has been previously determined</span>
<a name="l00385"></a>00385       <span class="keywordflow">if</span> (gndClause-&gt;isHardClause())
<a name="l00386"></a>00386         clauseCost_[i] = hardWt_;
<a name="l00387"></a>00387       <span class="keywordflow">else</span>
<a name="l00388"></a>00388         clauseCost_[i] = gndClause-&gt;getWt();
<a name="l00389"></a>00389     }
<a name="l00390"></a>00390 
<a name="l00391"></a>00391     <span class="keywordflow">if</span> (!initial)
<a name="l00392"></a>00392     {
<a name="l00393"></a>00393       <span class="comment">//initNumSatLiterals(1, oldNumClauses);</span>
<a name="l00394"></a>00394       <span class="keywordflow">if</span> (useThreshold_)
<a name="l00395"></a>00395       {
<a name="l00396"></a>00396         <a class="code" href="classVariableState.html#4e30712524da7ecb7b450b98155dd717">killClauses</a>(oldNumClauses);
<a name="l00397"></a>00397       }
<a name="l00398"></a>00398       <span class="keywordflow">else</span>
<a name="l00399"></a>00399       {
<a name="l00400"></a>00400         <a class="code" href="classVariableState.html#2c53e96f2f2f3ed8978fae90a7daad36">initMakeBreakCostWatch</a>(oldNumClauses);
<a name="l00401"></a>00401       }
<a name="l00402"></a>00402     }
<a name="l00403"></a>00403     <span class="keywordflow">if</span> (vsdebug) cout &lt;&lt; <span class="stringliteral">"Done adding new clauses.."</span> &lt;&lt; endl;
<a name="l00404"></a>00404   }
<a name="l00405"></a>00405 
<a name="l00409"></a><a class="code" href="classVariableState.html#78315762db15542e9cdab7753c697e66">00409</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#78315762db15542e9cdab7753c697e66">init</a>()
<a name="l00410"></a>00410   {
<a name="l00411"></a>00411       <span class="comment">// Initialize info arrays</span>
<a name="l00412"></a>00412     <a class="code" href="classVariableState.html#2c53e96f2f2f3ed8978fae90a7daad36">initMakeBreakCostWatch</a>();
<a name="l00413"></a>00413   }
<a name="l00414"></a>00414   
<a name="l00418"></a><a class="code" href="classVariableState.html#a8f619357092cf7e5ac33d76c9e89afc">00418</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#a8f619357092cf7e5ac33d76c9e89afc">reinit</a>()
<a name="l00419"></a>00419   {
<a name="l00420"></a>00420     clause_.<a class="code" href="classArray.html#bd77eb205b05d2327c2cbd5dbc9bcc11">clearAndCompress</a>();
<a name="l00421"></a>00421     clauseCost_.<a class="code" href="classArray.html#bd77eb205b05d2327c2cbd5dbc9bcc11">clearAndCompress</a>();
<a name="l00422"></a>00422     falseClause_.<a class="code" href="classArray.html#bd77eb205b05d2327c2cbd5dbc9bcc11">clearAndCompress</a>();
<a name="l00423"></a>00423     whereFalse_.<a class="code" href="classArray.html#bd77eb205b05d2327c2cbd5dbc9bcc11">clearAndCompress</a>();
<a name="l00424"></a>00424     numTrueLits_.<a class="code" href="classArray.html#bd77eb205b05d2327c2cbd5dbc9bcc11">clearAndCompress</a>();
<a name="l00425"></a>00425     watch1_.<a class="code" href="classArray.html#bd77eb205b05d2327c2cbd5dbc9bcc11">clearAndCompress</a>();
<a name="l00426"></a>00426     watch2_.<a class="code" href="classArray.html#bd77eb205b05d2327c2cbd5dbc9bcc11">clearAndCompress</a>();
<a name="l00427"></a>00427     isSatisfied_.<a class="code" href="classArray.html#bd77eb205b05d2327c2cbd5dbc9bcc11">clearAndCompress</a>();
<a name="l00428"></a>00428     deadClause_.<a class="code" href="classArray.html#bd77eb205b05d2327c2cbd5dbc9bcc11">clearAndCompress</a>();
<a name="l00429"></a>00429     threshold_.<a class="code" href="classArray.html#bd77eb205b05d2327c2cbd5dbc9bcc11">clearAndCompress</a>();
<a name="l00430"></a>00430 
<a name="l00431"></a>00431     newClauses_.<a class="code" href="classArray.html#752db599431d93ee14c5b0f7b05ba03a">append</a>(gndClauses_);
<a name="l00432"></a>00432     gndClauses_-&gt;<a class="code" href="classArray.html#bd77eb205b05d2327c2cbd5dbc9bcc11">clearAndCompress</a>();
<a name="l00433"></a>00433     gndPreds_-&gt;<a class="code" href="classArray.html#bd77eb205b05d2327c2cbd5dbc9bcc11">clearAndCompress</a>();
<a name="l00434"></a>00434     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; occurence_.<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>(); i++)
<a name="l00435"></a>00435       occurence_.<a class="code" href="classArray.html#bd77eb205b05d2327c2cbd5dbc9bcc11">clearAndCompress</a>();
<a name="l00436"></a>00436     occurence_.<a class="code" href="classArray.html#bd77eb205b05d2327c2cbd5dbc9bcc11">clearAndCompress</a>();
<a name="l00437"></a>00437     
<a name="l00438"></a>00438       <span class="comment">// Add the clauses and preds and fill info arrays</span>
<a name="l00439"></a>00439     <span class="keywordtype">bool</span> initial = <span class="keyword">true</span>;
<a name="l00440"></a>00440     <a class="code" href="classVariableState.html#2748a93f222dafedaf7443634e234ddd">addNewClauses</a>(initial);
<a name="l00441"></a>00441     baseNumAtoms_ = gndPredHashArray_.<a class="code" href="classHashArray.html#ccdf0d4f7188821cd872b1618312fbd0">size</a>();
<a name="l00442"></a>00442     <a class="code" href="classVariableState.html#78315762db15542e9cdab7753c697e66">init</a>();    
<a name="l00443"></a>00443   }
<a name="l00444"></a>00444   
<a name="l00450"></a><a class="code" href="classVariableState.html#38cda38f91fe157e68b0c9c4ce5a20a6">00450</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#38cda38f91fe157e68b0c9c4ce5a20a6">initRandom</a>()
<a name="l00451"></a>00451   {
<a name="l00452"></a>00452       <span class="comment">// Set one in each block to true randomly</span>
<a name="l00453"></a>00453     <a class="code" href="classVariableState.html#431d61bc9c02ee8e10833d34063ed98e">initBlocksRandom</a>();
<a name="l00454"></a>00454 
<a name="l00455"></a>00455       <span class="comment">// Random truth value for all not in blocks</span>
<a name="l00456"></a>00456     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt;= baseNumAtoms_; i++)
<a name="l00457"></a>00457     {
<a name="l00458"></a>00458         <span class="comment">// fixedAtom_[i] = -1: false, fixedAtom_[i] = 1: true</span>
<a name="l00459"></a>00459       <span class="keywordflow">if</span> (fixedAtom_[i] != 0) <a class="code" href="classVariableState.html#5ca24c889ca9ea4ec1ad6fa64b59e348">setValueOfAtom</a>(i, (fixedAtom_[i] == 1));
<a name="l00460"></a>00460         <span class="comment">// Blocks are initialized above</span>
<a name="l00461"></a>00461       <span class="keywordflow">if</span> (<a class="code" href="classVariableState.html#48db641f2970801eefcb83a0147d9173">getBlockIndex</a>(i - 1) &gt;= 0)
<a name="l00462"></a>00462       {
<a name="l00463"></a>00463         <span class="keywordflow">if</span> (vsdebug) cout &lt;&lt; <span class="stringliteral">"Atom "</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">" in block"</span> &lt;&lt; endl;
<a name="l00464"></a>00464         <span class="keywordflow">continue</span>;
<a name="l00465"></a>00465       }
<a name="l00466"></a>00466         <span class="comment">// Not fixed and not in block</span>
<a name="l00467"></a>00467       <span class="keywordflow">else</span>
<a name="l00468"></a>00468       {
<a name="l00469"></a>00469         <span class="keywordflow">if</span> (vsdebug) cout &lt;&lt; <span class="stringliteral">"Atom "</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">" not in block"</span> &lt;&lt; endl;
<a name="l00470"></a>00470         <a class="code" href="classVariableState.html#5ca24c889ca9ea4ec1ad6fa64b59e348">setValueOfAtom</a>(i, random() % 2);
<a name="l00471"></a>00471       }
<a name="l00472"></a>00472     }
<a name="l00473"></a>00473     <a class="code" href="classVariableState.html#78315762db15542e9cdab7753c697e66">init</a>();
<a name="l00474"></a>00474   }
<a name="l00475"></a>00475 
<a name="l00479"></a><a class="code" href="classVariableState.html#431d61bc9c02ee8e10833d34063ed98e">00479</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#431d61bc9c02ee8e10833d34063ed98e">initBlocksRandom</a>()
<a name="l00480"></a>00480   {
<a name="l00481"></a>00481     <span class="keywordflow">if</span> (vsdebug)
<a name="l00482"></a>00482     {
<a name="l00483"></a>00483       cout &lt;&lt; <span class="stringliteral">"Initializing blocks randomly"</span> &lt;&lt; endl;
<a name="l00484"></a>00484       cout &lt;&lt; <span class="stringliteral">"Num. of blocks: "</span> &lt;&lt; blocks_-&gt;<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>() &lt;&lt; endl;
<a name="l00485"></a>00485     }
<a name="l00486"></a>00486     
<a name="l00487"></a>00487       <span class="comment">// For each block: select one to set to true</span>
<a name="l00488"></a>00488     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; blocks_-&gt;<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>(); i++)
<a name="l00489"></a>00489     {
<a name="l00490"></a>00490         <span class="comment">// True fixed atom in the block: set others to false</span>
<a name="l00491"></a>00491       <span class="keywordflow">if</span> (<span class="keywordtype">int</span> trueFixedAtomInBlock = <a class="code" href="classVariableState.html#bec37519e017eb2799b2ec09d0cdf0af">getTrueFixedAtomInBlock</a>(i) &gt;= 0)
<a name="l00492"></a>00492       {
<a name="l00493"></a>00493         <span class="keywordflow">if</span> (vsdebug) cout &lt;&lt; <span class="stringliteral">"True fixed atom in block "</span> &lt;&lt; i &lt;&lt; endl;
<a name="l00494"></a>00494         <a class="code" href="classVariableState.html#51328d98874eae61096c94b6626f14df">setOthersInBlockToFalse</a>(trueFixedAtomInBlock, i);
<a name="l00495"></a>00495         <span class="keywordflow">continue</span>;
<a name="l00496"></a>00496       }
<a name="l00497"></a>00497 
<a name="l00498"></a>00498         <span class="comment">// If evidence atom exists, then all others are false</span>
<a name="l00499"></a>00499       <span class="keywordflow">if</span> ((*blockEvidence_)[i])
<a name="l00500"></a>00500       {
<a name="l00501"></a>00501           <span class="comment">// If first argument is -1, then all are set to false</span>
<a name="l00502"></a>00502         <a class="code" href="classVariableState.html#51328d98874eae61096c94b6626f14df">setOthersInBlockToFalse</a>(-1, i);
<a name="l00503"></a>00503         <span class="keywordflow">continue</span>;
<a name="l00504"></a>00504       }
<a name="l00505"></a>00505 
<a name="l00506"></a>00506         <span class="comment">// Eager version: pick one at random</span>
<a name="l00507"></a>00507       <a class="code" href="classArray.html">Array&lt;int&gt;</a>&amp; block = (*blocks_)[i];
<a name="l00508"></a>00508       <span class="keywordtype">bool</span> ok = <span class="keyword">false</span>;
<a name="l00509"></a>00509       <span class="keywordflow">while</span> (!ok)
<a name="l00510"></a>00510       {
<a name="l00511"></a>00511         <span class="keywordtype">int</span> chosen = random() % block.<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>();
<a name="l00512"></a>00512           <span class="comment">// Atom not fixed</span>
<a name="l00513"></a>00513         <span class="keywordflow">if</span> (fixedAtom_[block[chosen] + 1] == 0)
<a name="l00514"></a>00514         {
<a name="l00515"></a>00515           <span class="keywordflow">if</span> (vsdebug) cout &lt;&lt; <span class="stringliteral">"Atom "</span> &lt;&lt; block[chosen] + 1 
<a name="l00516"></a>00516                             &lt;&lt; <span class="stringliteral">" chosen in block"</span> &lt;&lt; endl;
<a name="l00517"></a>00517           <a class="code" href="classVariableState.html#5ca24c889ca9ea4ec1ad6fa64b59e348">setValueOfAtom</a>(block[chosen] + 1, <span class="keyword">true</span>);
<a name="l00518"></a>00518           <a class="code" href="classVariableState.html#51328d98874eae61096c94b6626f14df">setOthersInBlockToFalse</a>(chosen, i);
<a name="l00519"></a>00519           ok = <span class="keyword">true</span>;
<a name="l00520"></a>00520         }
<a name="l00521"></a>00521       }
<a name="l00522"></a>00522     }
<a name="l00523"></a>00523     <span class="keywordflow">if</span> (vsdebug) cout &lt;&lt; <span class="stringliteral">"Done initializing blocks randomly"</span> &lt;&lt; endl;
<a name="l00524"></a>00524   }      
<a name="l00525"></a>00525 
<a name="l00530"></a><a class="code" href="classVariableState.html#2c53e96f2f2f3ed8978fae90a7daad36">00530</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#2c53e96f2f2f3ed8978fae90a7daad36">initMakeBreakCostWatch</a>()
<a name="l00531"></a>00531   {
<a name="l00532"></a>00532       <span class="comment">// Reset info concerning true lits, false clauses, etc.</span>
<a name="l00533"></a>00533     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classVariableState.html#703e262481d6c0b076799511af07df67">getNumClauses</a>(); i++) numTrueLits_[i] = 0;
<a name="l00534"></a>00534     numFalseClauses_ = 0;
<a name="l00535"></a>00535     costOfFalseClauses_ = 0.0;
<a name="l00536"></a>00536     lowCost_ = LDBL_MAX;
<a name="l00537"></a>00537     lowBad_ = INT_MAX;
<a name="l00538"></a>00538 
<a name="l00539"></a>00539     assert(makeCost_.<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>() == breakCost_.<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>());
<a name="l00540"></a>00540       <span class="comment">// Reset make and break cost to 0</span>
<a name="l00541"></a>00541     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; makeCost_.<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>(); i++)
<a name="l00542"></a>00542     {
<a name="l00543"></a>00543       makeCost_[i] = breakCost_[i] = 0.0;
<a name="l00544"></a>00544     }
<a name="l00545"></a>00545     <a class="code" href="classVariableState.html#2c53e96f2f2f3ed8978fae90a7daad36">initMakeBreakCostWatch</a>(0);
<a name="l00546"></a>00546   }
<a name="l00547"></a>00547 
<a name="l00555"></a><a class="code" href="classVariableState.html#07b395d520788e7e8f58da07e6327c75">00555</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#2c53e96f2f2f3ed8978fae90a7daad36">initMakeBreakCostWatch</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; startClause)
<a name="l00556"></a>00556   {
<a name="l00557"></a>00557     <span class="keywordtype">int</span> theTrueLit = -1;
<a name="l00558"></a>00558       <span class="comment">// Initialize breakCost and makeCost in the following:</span>
<a name="l00559"></a>00559     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = startClause; i &lt; <a class="code" href="classVariableState.html#703e262481d6c0b076799511af07df67">getNumClauses</a>(); i++)
<a name="l00560"></a>00560     {
<a name="l00561"></a>00561         <span class="comment">// Don't look at dead clauses</span>
<a name="l00562"></a>00562       <span class="keywordflow">if</span> (deadClause_[i]) <span class="keywordflow">continue</span>;
<a name="l00563"></a>00563       <span class="keywordtype">int</span> trueLit1 = 0;
<a name="l00564"></a>00564       <span class="keywordtype">int</span> trueLit2 = 0;
<a name="l00565"></a>00565       <span class="keywordtype">long</span> <span class="keywordtype">double</span> cost = clauseCost_[i];
<a name="l00566"></a>00566       numTrueLits_[i] = 0;
<a name="l00567"></a>00567       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classVariableState.html#12d6e101244182a1962c99cc016f4b78">getClauseSize</a>(i); j++)
<a name="l00568"></a>00568       {
<a name="l00569"></a>00569         <span class="keywordflow">if</span> (<a class="code" href="classVariableState.html#a6cd0ba26bb4d5c3f7b19d0cd76f3317">isTrueLiteral</a>(clause_[i][j]))
<a name="l00570"></a>00570         { <span class="comment">// ij is true lit</span>
<a name="l00571"></a>00571           numTrueLits_[i]++;
<a name="l00572"></a>00572           theTrueLit = abs(clause_[i][j]);
<a name="l00573"></a>00573           <span class="keywordflow">if</span> (!trueLit1) trueLit1 = theTrueLit;
<a name="l00574"></a>00574           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (trueLit1 &amp;&amp; !trueLit2) trueLit2 = theTrueLit;
<a name="l00575"></a>00575         }
<a name="l00576"></a>00576       }
<a name="l00577"></a>00577 
<a name="l00578"></a>00578         <span class="comment">// Unsatisfied positive-weighted clauses or</span>
<a name="l00579"></a>00579         <span class="comment">// Satisfied negative-weighted clauses</span>
<a name="l00580"></a>00580       <span class="keywordflow">if</span> ((numTrueLits_[i] == 0 &amp;&amp; cost &gt; 0) ||
<a name="l00581"></a>00581           (numTrueLits_[i] &gt; 0 &amp;&amp; cost &lt; 0))
<a name="l00582"></a>00582       {
<a name="l00583"></a>00583         whereFalse_[i] = numFalseClauses_;
<a name="l00584"></a>00584         falseClause_[numFalseClauses_] = i;
<a name="l00585"></a>00585         numFalseClauses_++;
<a name="l00586"></a>00586         costOfFalseClauses_ += abs(cost);
<a name="l00587"></a>00587         <span class="keywordflow">if</span> (highestCost_ == abs(cost)) {eqHighest_ = <span class="keyword">true</span>; numHighest_++;}
<a name="l00588"></a>00588 
<a name="l00589"></a>00589           <span class="comment">// Unsat. pos. clause: increase makeCost_ of all atoms</span>
<a name="l00590"></a>00590         <span class="keywordflow">if</span> (numTrueLits_[i] == 0)
<a name="l00591"></a>00591           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classVariableState.html#12d6e101244182a1962c99cc016f4b78">getClauseSize</a>(i); j++)
<a name="l00592"></a>00592           {
<a name="l00593"></a>00593             makeCost_[abs(clause_[i][j])] += cost;
<a name="l00594"></a>00594           }
<a name="l00595"></a>00595 
<a name="l00596"></a>00596           <span class="comment">// Sat. neg. clause: increase makeCost_ if one true literal</span>
<a name="l00597"></a>00597         <span class="keywordflow">if</span> (numTrueLits_[i] == 1)
<a name="l00598"></a>00598         {
<a name="l00599"></a>00599             <span class="comment">// Subtract neg. cost</span>
<a name="l00600"></a>00600           makeCost_[theTrueLit] -= cost;
<a name="l00601"></a>00601           watch1_[i] = theTrueLit;
<a name="l00602"></a>00602         }
<a name="l00603"></a>00603         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (numTrueLits_[i] &gt; 1)
<a name="l00604"></a>00604         {
<a name="l00605"></a>00605           watch1_[i] = trueLit1;
<a name="l00606"></a>00606           watch2_[i] = trueLit2;
<a name="l00607"></a>00607         }
<a name="l00608"></a>00608       }
<a name="l00609"></a>00609         <span class="comment">// Pos. clauses satisfied by one true literal</span>
<a name="l00610"></a>00610       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (numTrueLits_[i] == 1 &amp;&amp; cost &gt; 0)
<a name="l00611"></a>00611       {
<a name="l00612"></a>00612         breakCost_[theTrueLit] += cost;
<a name="l00613"></a>00613         watch1_[i] = theTrueLit;
<a name="l00614"></a>00614       }
<a name="l00615"></a>00615         <span class="comment">// Pos. clauses satisfied by 2 or more true literals</span>
<a name="l00616"></a>00616       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cost &gt; 0)
<a name="l00617"></a>00617       { <span class="comment">/*if (numtruelit[i] == 2)*/</span>
<a name="l00618"></a>00618         watch1_[i] = trueLit1;
<a name="l00619"></a>00619         watch2_[i] = trueLit2;
<a name="l00620"></a>00620       }
<a name="l00621"></a>00621         <span class="comment">// Unsat. neg. clauses: increase breakCost of all atoms</span>
<a name="l00622"></a>00622       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (numTrueLits_[i] == 0 &amp;&amp; cost &lt; 0)
<a name="l00623"></a>00623       {
<a name="l00624"></a>00624         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classVariableState.html#12d6e101244182a1962c99cc016f4b78">getClauseSize</a>(i); j++)
<a name="l00625"></a>00625           breakCost_[abs(clause_[i][j])] -= cost;
<a name="l00626"></a>00626       }
<a name="l00627"></a>00627     } <span class="comment">// for all clauses</span>
<a name="l00628"></a>00628   }
<a name="l00629"></a>00629 
<a name="l00630"></a><a class="code" href="classVariableState.html#bc520a99648ee29ef9447b86c26d9faf">00630</a>   <span class="keywordtype">int</span> <a class="code" href="classVariableState.html#bc520a99648ee29ef9447b86c26d9faf">getNumAtoms</a>() { <span class="keywordflow">return</span> gndPreds_-&gt;<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>(); }
<a name="l00631"></a>00631   
<a name="l00632"></a><a class="code" href="classVariableState.html#703e262481d6c0b076799511af07df67">00632</a>   <span class="keywordtype">int</span> <a class="code" href="classVariableState.html#703e262481d6c0b076799511af07df67">getNumClauses</a>() { <span class="keywordflow">return</span> gndClauses_-&gt;<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>(); }
<a name="l00633"></a>00633   
<a name="l00634"></a><a class="code" href="classVariableState.html#fe382d0e9cd941649c330062cc71c8db">00634</a>   <span class="keywordtype">int</span> <a class="code" href="classVariableState.html#fe382d0e9cd941649c330062cc71c8db">getNumDeadClauses</a>()
<a name="l00635"></a>00635   { 
<a name="l00636"></a>00636     <span class="keywordtype">int</span> count = 0;
<a name="l00637"></a>00637     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; deadClause_.<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>(); i++)
<a name="l00638"></a>00638       <span class="keywordflow">if</span> (deadClause_[i]) count++;
<a name="l00639"></a>00639     <span class="keywordflow">return</span> count;
<a name="l00640"></a>00640   }
<a name="l00641"></a>00641 
<a name="l00645"></a><a class="code" href="classVariableState.html#bfb994798a09590a85c7df10be856828">00645</a>   <span class="keywordtype">int</span> <a class="code" href="classVariableState.html#bfb994798a09590a85c7df10be856828">getIndexOfRandomAtom</a>()
<a name="l00646"></a>00646   {
<a name="l00647"></a>00647     <span class="keywordtype">int</span> numAtoms = <a class="code" href="classVariableState.html#bc520a99648ee29ef9447b86c26d9faf">getNumAtoms</a>();
<a name="l00648"></a>00648     <span class="keywordflow">if</span> (numAtoms == 0) <span class="keywordflow">return</span> NOVALUE;
<a name="l00649"></a>00649     <span class="keywordflow">return</span> random()%numAtoms + 1;
<a name="l00650"></a>00650   }
<a name="l00651"></a>00651 
<a name="l00657"></a><a class="code" href="classVariableState.html#f25a7b72dbd120a39bdf16a8f5177c0a">00657</a>   <span class="keywordtype">int</span> <a class="code" href="classVariableState.html#f25a7b72dbd120a39bdf16a8f5177c0a">getIndexOfAtomInRandomFalseClause</a>()
<a name="l00658"></a>00658   {
<a name="l00659"></a>00659     <span class="keywordflow">if</span> (numFalseClauses_ == 0) <span class="keywordflow">return</span> NOVALUE;
<a name="l00660"></a>00660     <span class="keywordtype">int</span> clauseIdx = falseClause_[random()%numFalseClauses_];
<a name="l00661"></a>00661       <span class="comment">// Pos. clause: return index of random atom</span>
<a name="l00662"></a>00662     <span class="keywordflow">if</span> (clauseCost_[clauseIdx] &gt; 0)
<a name="l00663"></a>00663       <span class="keywordflow">return</span> abs(clause_[clauseIdx][random()%<a class="code" href="classVariableState.html#12d6e101244182a1962c99cc016f4b78">getClauseSize</a>(clauseIdx)]);
<a name="l00664"></a>00664       <span class="comment">// Neg. clause: find random true lit</span>
<a name="l00665"></a>00665     <span class="keywordflow">else</span>
<a name="l00666"></a>00666       <span class="keywordflow">return</span> <a class="code" href="classVariableState.html#2464e6883cae56360dfdccd4704e9a34">getRandomTrueLitInClause</a>(clauseIdx);
<a name="l00667"></a>00667   }
<a name="l00668"></a>00668   
<a name="l00673"></a><a class="code" href="classVariableState.html#8ebb42420177d489c46c56f2c6e7547a">00673</a>   <span class="keywordtype">int</span> <a class="code" href="classVariableState.html#8ebb42420177d489c46c56f2c6e7547a">getRandomFalseClauseIndex</a>()
<a name="l00674"></a>00674   {
<a name="l00675"></a>00675     <span class="keywordflow">if</span> (numFalseClauses_ == 0) <span class="keywordflow">return</span> NOVALUE;
<a name="l00676"></a>00676     <span class="keywordflow">return</span> falseClause_[random()%numFalseClauses_];
<a name="l00677"></a>00677   }
<a name="l00678"></a>00678   
<a name="l00683"></a><a class="code" href="classVariableState.html#5d7c8bcbf357de431370e2845019b08e">00683</a>   <span class="keywordtype">long</span> <span class="keywordtype">double</span> <a class="code" href="classVariableState.html#5d7c8bcbf357de431370e2845019b08e">getCostOfFalseClauses</a>()
<a name="l00684"></a>00684   {
<a name="l00685"></a>00685     <span class="keywordflow">return</span> costOfFalseClauses_;
<a name="l00686"></a>00686   }
<a name="l00687"></a>00687   
<a name="l00692"></a><a class="code" href="classVariableState.html#f3b4406c82b68fa76396996d9f6878a6">00692</a>   <span class="keywordtype">int</span> <a class="code" href="classVariableState.html#f3b4406c82b68fa76396996d9f6878a6">getNumFalseClauses</a>()
<a name="l00693"></a>00693   {
<a name="l00694"></a>00694     <span class="keywordflow">return</span> numFalseClauses_;
<a name="l00695"></a>00695   }
<a name="l00696"></a>00696 
<a name="l00703"></a><a class="code" href="classVariableState.html#1ad4eb75da5a498f834ce1aafd69f114">00703</a>   <span class="keywordtype">bool</span> <a class="code" href="classVariableState.html#1ad4eb75da5a498f834ce1aafd69f114">getValueOfAtom</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; atomIdx)
<a name="l00704"></a>00704   {
<a name="l00705"></a>00705     <span class="keywordflow">return</span> atom_[atomIdx];
<a name="l00706"></a>00706   }
<a name="l00707"></a>00707 
<a name="l00714"></a><a class="code" href="classVariableState.html#73ac1309ad13b2e21ff4904cb835610e">00714</a>   <span class="keywordtype">bool</span> <a class="code" href="classVariableState.html#73ac1309ad13b2e21ff4904cb835610e">getValueOfLowAtom</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; atomIdx)
<a name="l00715"></a>00715   {
<a name="l00716"></a>00716     <span class="keywordflow">return</span> lowAtom_[atomIdx];
<a name="l00717"></a>00717   }
<a name="l00718"></a>00718 
<a name="l00726"></a><a class="code" href="classVariableState.html#5ca24c889ca9ea4ec1ad6fa64b59e348">00726</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#5ca24c889ca9ea4ec1ad6fa64b59e348">setValueOfAtom</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; atomIdx, <span class="keyword">const</span> <span class="keywordtype">bool</span>&amp; value)
<a name="l00727"></a>00727   {
<a name="l00728"></a>00728     <span class="keywordflow">if</span> (vsdebug) cout &lt;&lt; <span class="stringliteral">"Setting value of atom "</span> &lt;&lt; atomIdx 
<a name="l00729"></a>00729                       &lt;&lt; <span class="stringliteral">" to "</span> &lt;&lt; value &lt;&lt; endl;
<a name="l00730"></a>00730       <span class="comment">// If atom already has this value, then do nothing</span>
<a name="l00731"></a>00731     <span class="keywordflow">if</span> (atom_[atomIdx] == value) <span class="keywordflow">return</span>;
<a name="l00732"></a>00732       <span class="comment">// Propagate assigment to DB</span>
<a name="l00733"></a>00733     <a class="code" href="classGroundPredicate.html">GroundPredicate</a>* p = gndPredHashArray_[atomIdx - 1];
<a name="l00734"></a>00734     <span class="keywordflow">if</span> (value)
<a name="l00735"></a>00735     {
<a name="l00736"></a>00736       domain_-&gt;<a class="code" href="classDomain.html#732940c3a6c4064099aaf353513b553f">getDB</a>()-&gt;<a class="code" href="classDatabase.html#55bde3da38b3b555e9897d860dfff500">setValue</a>(p, TRUE);
<a name="l00737"></a>00737     }
<a name="l00738"></a>00738     <span class="keywordflow">else</span>
<a name="l00739"></a>00739     {
<a name="l00740"></a>00740       domain_-&gt;<a class="code" href="classDomain.html#732940c3a6c4064099aaf353513b553f">getDB</a>()-&gt;<a class="code" href="classDatabase.html#55bde3da38b3b555e9897d860dfff500">setValue</a>(p, FALSE);
<a name="l00741"></a>00741     }
<a name="l00742"></a>00742       <span class="comment">// If not active, then activate it</span>
<a name="l00743"></a>00743     <span class="keywordflow">if</span> (lazy_ &amp;&amp; !<a class="code" href="classVariableState.html#d1809e4857db8f403c53948b0ba9e960">isActive</a>(atomIdx))
<a name="l00744"></a>00744     {
<a name="l00745"></a>00745       <span class="keywordtype">bool</span> ignoreActivePreds = <span class="keyword">false</span>;
<a name="l00746"></a>00746       <a class="code" href="classVariableState.html#9082644cc8bc821e0ad8abd85bf11f80">activateAtom</a>(atomIdx, ignoreActivePreds);
<a name="l00747"></a>00747     }
<a name="l00748"></a>00748     atom_[atomIdx] = value;
<a name="l00749"></a>00749   }
<a name="l00750"></a>00750 
<a name="l00754"></a><a class="code" href="classVariableState.html#97f47d59c8ce2f05e2e32c52cadd87c4">00754</a>   <a class="code" href="classArray.html">Array&lt;int&gt;</a>&amp; <a class="code" href="classVariableState.html#97f47d59c8ce2f05e2e32c52cadd87c4">getNegOccurenceArray</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; atomIdx)
<a name="l00755"></a>00755   {
<a name="l00756"></a>00756     <span class="keywordtype">int</span> litIdx = 2*atomIdx;
<a name="l00757"></a>00757     <span class="keywordflow">return</span> <a class="code" href="classVariableState.html#32dc7e8ae1facd20d885cf6dac4c0028">getOccurenceArray</a>(litIdx);
<a name="l00758"></a>00758   }
<a name="l00759"></a>00759 
<a name="l00763"></a><a class="code" href="classVariableState.html#472841bdbf016395d0c6a8fc43f220ff">00763</a>   <a class="code" href="classArray.html">Array&lt;int&gt;</a>&amp; <a class="code" href="classVariableState.html#472841bdbf016395d0c6a8fc43f220ff">getPosOccurenceArray</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; atomIdx)
<a name="l00764"></a>00764   {
<a name="l00765"></a>00765     <span class="keywordtype">int</span> litIdx = 2*atomIdx - 1;
<a name="l00766"></a>00766     <span class="keywordflow">return</span> <a class="code" href="classVariableState.html#32dc7e8ae1facd20d885cf6dac4c0028">getOccurenceArray</a>(litIdx);
<a name="l00767"></a>00767   }
<a name="l00768"></a>00768 
<a name="l00774"></a><a class="code" href="classVariableState.html#a71f608d3613ba9ceae3b0f5e25a61c9">00774</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#a71f608d3613ba9ceae3b0f5e25a61c9">flipAtom</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; toFlip)
<a name="l00775"></a>00775   {
<a name="l00776"></a>00776     <span class="keywordtype">bool</span> toFlipValue = <a class="code" href="classVariableState.html#1ad4eb75da5a498f834ce1aafd69f114">getValueOfAtom</a>(toFlip);
<a name="l00777"></a>00777     <span class="keyword">register</span> <span class="keywordtype">int</span> clauseIdx;
<a name="l00778"></a>00778     <span class="keywordtype">int</span> sign;
<a name="l00779"></a>00779     <span class="keywordtype">int</span> oppSign;
<a name="l00780"></a>00780     <span class="keywordtype">int</span> litIdx;
<a name="l00781"></a>00781     <span class="keywordflow">if</span> (toFlipValue)
<a name="l00782"></a>00782       sign = 1;
<a name="l00783"></a>00783     <span class="keywordflow">else</span>
<a name="l00784"></a>00784       sign = 0;
<a name="l00785"></a>00785     oppSign = sign ^ 1;
<a name="l00786"></a>00786 
<a name="l00787"></a>00787     <a class="code" href="classVariableState.html#86615cee925136b0b8d9fa9ee553ff10">flipAtomValue</a>(toFlip);
<a name="l00788"></a>00788     
<a name="l00789"></a>00789       <span class="comment">// Update all clauses in which the atom occurs as a true literal</span>
<a name="l00790"></a>00790     litIdx = 2*toFlip - sign;
<a name="l00791"></a>00791     <a class="code" href="classArray.html">Array&lt;int&gt;</a>&amp; posOccArray = <a class="code" href="classVariableState.html#32dc7e8ae1facd20d885cf6dac4c0028">getOccurenceArray</a>(litIdx);
<a name="l00792"></a>00792     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; posOccArray.<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>(); i++)
<a name="l00793"></a>00793     {
<a name="l00794"></a>00794       clauseIdx = posOccArray[i];
<a name="l00795"></a>00795         <span class="comment">// Don't look at dead clauses</span>
<a name="l00796"></a>00796       <span class="keywordflow">if</span> (deadClause_[clauseIdx]) <span class="keywordflow">continue</span>;
<a name="l00797"></a>00797         <span class="comment">// The true lit became a false lit</span>
<a name="l00798"></a>00798       <span class="keywordtype">int</span> numTrueLits = <a class="code" href="classVariableState.html#df2045508a3820ac75f02bd297c587f8">decrementNumTrueLits</a>(clauseIdx);
<a name="l00799"></a>00799       <span class="keywordtype">long</span> <span class="keywordtype">double</span> cost = <a class="code" href="classVariableState.html#ce8401a0ed90726319c8d8d15cb5da30">getClauseCost</a>(clauseIdx);
<a name="l00800"></a>00800       <span class="keywordtype">int</span> watch1 = <a class="code" href="classVariableState.html#1ff785b813b350e67466c7210856243e">getWatch1</a>(clauseIdx);
<a name="l00801"></a>00801       <span class="keywordtype">int</span> watch2 = <a class="code" href="classVariableState.html#04e9c3e0a50b7bdfd04cdc0bafd6906d">getWatch2</a>(clauseIdx);
<a name="l00802"></a>00802 
<a name="l00803"></a>00803         <span class="comment">// 1. If last true lit was flipped, then we have to update</span>
<a name="l00804"></a>00804         <span class="comment">// the makecost / breakcost info accordingly        </span>
<a name="l00805"></a>00805       <span class="keywordflow">if</span> (numTrueLits == 0)
<a name="l00806"></a>00806       {
<a name="l00807"></a>00807           <span class="comment">// Pos. clause</span>
<a name="l00808"></a>00808         <span class="keywordflow">if</span> (cost &gt; 0)
<a name="l00809"></a>00809         {
<a name="l00810"></a>00810             <span class="comment">// Add this clause as false in the state</span>
<a name="l00811"></a>00811           <a class="code" href="classVariableState.html#a57ed676fde7a24d57e527756d592bd5">addFalseClause</a>(clauseIdx);
<a name="l00812"></a>00812             <span class="comment">// Decrease toFlip's breakcost (add neg. cost)</span>
<a name="l00813"></a>00813           <a class="code" href="classVariableState.html#e598f0dd45da0c61dacebea3871d9581">addBreakCost</a>(toFlip, -cost);
<a name="l00814"></a>00814             <span class="comment">// Increase makecost of all vars in clause (add pos. cost)</span>
<a name="l00815"></a>00815           <a class="code" href="classVariableState.html#189a058bc545cb3f284cf479d45dd6eb">addMakeCostToAtomsInClause</a>(clauseIdx, cost);
<a name="l00816"></a>00816         }
<a name="l00817"></a>00817           <span class="comment">// Neg. clause</span>
<a name="l00818"></a>00818         <span class="keywordflow">else</span>
<a name="l00819"></a>00819         {
<a name="l00820"></a>00820           assert(cost &lt; 0);
<a name="l00821"></a>00821             <span class="comment">// Remove this clause as false in the state</span>
<a name="l00822"></a>00822           <a class="code" href="classVariableState.html#324631d59cff78ffd52163f584bd237c">removeFalseClause</a>(clauseIdx);
<a name="l00823"></a>00823             <span class="comment">// Increase breakcost of all vars in clause (add pos. cost)</span>
<a name="l00824"></a>00824           <a class="code" href="classVariableState.html#8bda003606fd8a852f44a988124adb19">addBreakCostToAtomsInClause</a>(clauseIdx, -cost);        
<a name="l00825"></a>00825             <span class="comment">// Decrease toFlip's makecost (add neg. cost)</span>
<a name="l00826"></a>00826           <a class="code" href="classVariableState.html#d1574f8f2d9106457d6bb1b2d3282d60">addMakeCost</a>(toFlip, cost);
<a name="l00827"></a>00827         }
<a name="l00828"></a>00828       }
<a name="l00829"></a>00829         <span class="comment">// 2. If there is now one true lit left, then move watch2</span>
<a name="l00830"></a>00830         <span class="comment">// up to watch1 and increase the breakcost / makecost of watch1</span>
<a name="l00831"></a>00831       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (numTrueLits == 1)
<a name="l00832"></a>00832       {
<a name="l00833"></a>00833         <span class="keywordflow">if</span> (watch1 == toFlip)
<a name="l00834"></a>00834         {
<a name="l00835"></a>00835           assert(watch1 != watch2);
<a name="l00836"></a>00836           <a class="code" href="classVariableState.html#c0823bb22e2680eec885ca035ec17548">setWatch1</a>(clauseIdx, watch2);
<a name="l00837"></a>00837           watch1 = <a class="code" href="classVariableState.html#1ff785b813b350e67466c7210856243e">getWatch1</a>(clauseIdx);
<a name="l00838"></a>00838         }
<a name="l00839"></a>00839 
<a name="l00840"></a>00840           <span class="comment">// Pos. clause: Increase toFlip's breakcost (add pos. cost)</span>
<a name="l00841"></a>00841         <span class="keywordflow">if</span> (cost &gt; 0)
<a name="l00842"></a>00842         {
<a name="l00843"></a>00843           <a class="code" href="classVariableState.html#e598f0dd45da0c61dacebea3871d9581">addBreakCost</a>(watch1, cost);
<a name="l00844"></a>00844         }
<a name="l00845"></a>00845           <span class="comment">// Neg. clause: Increase toFlip's makecost (add pos. cost)</span>
<a name="l00846"></a>00846         <span class="keywordflow">else</span>
<a name="l00847"></a>00847         {
<a name="l00848"></a>00848           assert(cost &lt; 0);
<a name="l00849"></a>00849           <a class="code" href="classVariableState.html#d1574f8f2d9106457d6bb1b2d3282d60">addMakeCost</a>(watch1, -cost);
<a name="l00850"></a>00850         }
<a name="l00851"></a>00851       }
<a name="l00852"></a>00852         <span class="comment">// 3. If there are 2 or more true lits left, then we have to</span>
<a name="l00853"></a>00853         <span class="comment">// find a new true lit to watch if one was flipped</span>
<a name="l00854"></a>00854       <span class="keywordflow">else</span>
<a name="l00855"></a>00855       { <span class="comment">/* numtruelit[clauseIdx] &gt;= 2 */</span>
<a name="l00856"></a>00856           <span class="comment">// If watch1[clauseIdx] has been flipped</span>
<a name="l00857"></a>00857         <span class="keywordflow">if</span> (watch1 == toFlip)
<a name="l00858"></a>00858         {
<a name="l00859"></a>00859             <span class="comment">// find a different true literal to watch</span>
<a name="l00860"></a>00860           <span class="keywordtype">int</span> diffTrueLit = <a class="code" href="classVariableState.html#9a385abc27c6cf5d891c52204a8b9faa">getTrueLiteralOtherThan</a>(clauseIdx, watch1, watch2);
<a name="l00861"></a>00861           <a class="code" href="classVariableState.html#c0823bb22e2680eec885ca035ec17548">setWatch1</a>(clauseIdx, diffTrueLit);
<a name="l00862"></a>00862         }
<a name="l00863"></a>00863           <span class="comment">// If watch2[clauseIdx] has been flipped</span>
<a name="l00864"></a>00864         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (watch2 == toFlip)
<a name="l00865"></a>00865         {
<a name="l00866"></a>00866             <span class="comment">// find a different true literal to watch</span>
<a name="l00867"></a>00867           <span class="keywordtype">int</span> diffTrueLit = <a class="code" href="classVariableState.html#9a385abc27c6cf5d891c52204a8b9faa">getTrueLiteralOtherThan</a>(clauseIdx, watch1, watch2);
<a name="l00868"></a>00868           <a class="code" href="classVariableState.html#575dad9109552494ca6c9a56582844c7">setWatch2</a>(clauseIdx, diffTrueLit);
<a name="l00869"></a>00869         }
<a name="l00870"></a>00870       }
<a name="l00871"></a>00871     }
<a name="l00872"></a>00872         
<a name="l00873"></a>00873       <span class="comment">// Update all clauses in which the atom occurs as a false literal</span>
<a name="l00874"></a>00874     litIdx = 2*toFlip - oppSign;
<a name="l00875"></a>00875     <a class="code" href="classArray.html">Array&lt;int&gt;</a>&amp; negOccArray = <a class="code" href="classVariableState.html#32dc7e8ae1facd20d885cf6dac4c0028">getOccurenceArray</a>(litIdx);
<a name="l00876"></a>00876     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; negOccArray.<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>(); i++)
<a name="l00877"></a>00877     {
<a name="l00878"></a>00878       clauseIdx = negOccArray[i];
<a name="l00879"></a>00879         <span class="comment">// Don't look at dead clauses</span>
<a name="l00880"></a>00880       <span class="keywordflow">if</span> (deadClause_[clauseIdx]) <span class="keywordflow">continue</span>;
<a name="l00881"></a>00881         <span class="comment">// The false lit became a true lit</span>
<a name="l00882"></a>00882       <span class="keywordtype">int</span> numTrueLits = <a class="code" href="classVariableState.html#430605283b71f8a1c2ece97b62f6741f">incrementNumTrueLits</a>(clauseIdx);
<a name="l00883"></a>00883       <span class="keywordtype">long</span> <span class="keywordtype">double</span> cost = <a class="code" href="classVariableState.html#ce8401a0ed90726319c8d8d15cb5da30">getClauseCost</a>(clauseIdx);
<a name="l00884"></a>00884       <span class="keywordtype">int</span> watch1 = <a class="code" href="classVariableState.html#1ff785b813b350e67466c7210856243e">getWatch1</a>(clauseIdx);
<a name="l00885"></a>00885 
<a name="l00886"></a>00886         <span class="comment">// 1. If this is the only true lit, then we have to update</span>
<a name="l00887"></a>00887         <span class="comment">// the makecost / breakcost info accordingly        </span>
<a name="l00888"></a>00888       <span class="keywordflow">if</span> (numTrueLits == 1)
<a name="l00889"></a>00889       {
<a name="l00890"></a>00890           <span class="comment">// Pos. clause</span>
<a name="l00891"></a>00891         <span class="keywordflow">if</span> (cost &gt; 0)
<a name="l00892"></a>00892         {
<a name="l00893"></a>00893             <span class="comment">// Remove this clause as false in the state</span>
<a name="l00894"></a>00894           <a class="code" href="classVariableState.html#324631d59cff78ffd52163f584bd237c">removeFalseClause</a>(clauseIdx);
<a name="l00895"></a>00895             <span class="comment">// Increase toFlip's breakcost (add pos. cost)</span>
<a name="l00896"></a>00896           <a class="code" href="classVariableState.html#e598f0dd45da0c61dacebea3871d9581">addBreakCost</a>(toFlip, cost);        
<a name="l00897"></a>00897             <span class="comment">// Decrease makecost of all vars in clause (add neg. cost)</span>
<a name="l00898"></a>00898           <a class="code" href="classVariableState.html#189a058bc545cb3f284cf479d45dd6eb">addMakeCostToAtomsInClause</a>(clauseIdx, -cost);
<a name="l00899"></a>00899         }
<a name="l00900"></a>00900           <span class="comment">// Neg. clause</span>
<a name="l00901"></a>00901         <span class="keywordflow">else</span>
<a name="l00902"></a>00902         {
<a name="l00903"></a>00903           assert(cost &lt; 0);
<a name="l00904"></a>00904             <span class="comment">// Add this clause as false in the state</span>
<a name="l00905"></a>00905           <a class="code" href="classVariableState.html#a57ed676fde7a24d57e527756d592bd5">addFalseClause</a>(clauseIdx);
<a name="l00906"></a>00906             <span class="comment">// Decrease breakcost of all vars in clause (add neg. cost)</span>
<a name="l00907"></a>00907           <a class="code" href="classVariableState.html#8bda003606fd8a852f44a988124adb19">addBreakCostToAtomsInClause</a>(clauseIdx, cost);
<a name="l00908"></a>00908             <span class="comment">// Increase toFlip's makecost (add pos. cost)</span>
<a name="l00909"></a>00909           <a class="code" href="classVariableState.html#d1574f8f2d9106457d6bb1b2d3282d60">addMakeCost</a>(toFlip, -cost);
<a name="l00910"></a>00910         }
<a name="l00911"></a>00911           <span class="comment">// Watch this atom</span>
<a name="l00912"></a>00912         <a class="code" href="classVariableState.html#c0823bb22e2680eec885ca035ec17548">setWatch1</a>(clauseIdx, toFlip);
<a name="l00913"></a>00913       }
<a name="l00914"></a>00914         <span class="comment">// 2. If there are now exactly 2 true lits, then watch second atom</span>
<a name="l00915"></a>00915         <span class="comment">// and update breakcost</span>
<a name="l00916"></a>00916       <span class="keywordflow">else</span>
<a name="l00917"></a>00917       <span class="keywordflow">if</span> (numTrueLits == 2)
<a name="l00918"></a>00918       {
<a name="l00919"></a>00919         <span class="keywordflow">if</span> (cost &gt; 0)
<a name="l00920"></a>00920         {
<a name="l00921"></a>00921             <span class="comment">// Pos. clause</span>
<a name="l00922"></a>00922             <span class="comment">// Decrease breakcost of first atom being watched (add neg. cost)</span>
<a name="l00923"></a>00923           <a class="code" href="classVariableState.html#e598f0dd45da0c61dacebea3871d9581">addBreakCost</a>(watch1, -cost);
<a name="l00924"></a>00924         }
<a name="l00925"></a>00925         <span class="keywordflow">else</span>
<a name="l00926"></a>00926         {
<a name="l00927"></a>00927             <span class="comment">// Neg. clause</span>
<a name="l00928"></a>00928           assert(cost &lt; 0);
<a name="l00929"></a>00929             <span class="comment">// Decrease makecost of first atom being watched (add neg. cost)</span>
<a name="l00930"></a>00930           <a class="code" href="classVariableState.html#d1574f8f2d9106457d6bb1b2d3282d60">addMakeCost</a>(watch1, cost);
<a name="l00931"></a>00931         }
<a name="l00932"></a>00932         
<a name="l00933"></a>00933           <span class="comment">// Watch second atom</span>
<a name="l00934"></a>00934         <a class="code" href="classVariableState.html#575dad9109552494ca6c9a56582844c7">setWatch2</a>(clauseIdx, toFlip);
<a name="l00935"></a>00935       }
<a name="l00936"></a>00936     }
<a name="l00937"></a>00937   }
<a name="l00938"></a>00938 
<a name="l00943"></a><a class="code" href="classVariableState.html#86615cee925136b0b8d9fa9ee553ff10">00943</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#86615cee925136b0b8d9fa9ee553ff10">flipAtomValue</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; atomIdx)
<a name="l00944"></a>00944   {
<a name="l00945"></a>00945     <span class="keywordtype">bool</span> opposite = !atom_[atomIdx];
<a name="l00946"></a>00946     <a class="code" href="classVariableState.html#5ca24c889ca9ea4ec1ad6fa64b59e348">setValueOfAtom</a>(atomIdx, opposite);
<a name="l00947"></a>00947   }
<a name="l00948"></a>00948 
<a name="l00960"></a><a class="code" href="classVariableState.html#2ec57c8ad6127c24f96263abd8a301bb">00960</a>   <span class="keywordtype">long</span> <span class="keywordtype">double</span> <a class="code" href="classVariableState.html#2ec57c8ad6127c24f96263abd8a301bb">getImprovementByFlipping</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; atomIdx)
<a name="l00961"></a>00961   {
<a name="l00962"></a>00962     <span class="keywordflow">if</span> (lazy_ &amp;&amp; !<a class="code" href="classVariableState.html#d1809e4857db8f403c53948b0ba9e960">isActive</a>(atomIdx))
<a name="l00963"></a>00963     {
<a name="l00964"></a>00964         <span class="comment">// First flip the atom to activate it, then flip it back</span>
<a name="l00965"></a>00965       <a class="code" href="classVariableState.html#a71f608d3613ba9ceae3b0f5e25a61c9">flipAtom</a>(atomIdx);
<a name="l00966"></a>00966       <a class="code" href="classVariableState.html#a71f608d3613ba9ceae3b0f5e25a61c9">flipAtom</a>(atomIdx);
<a name="l00967"></a>00967     }
<a name="l00968"></a>00968     <span class="keywordtype">long</span> <span class="keywordtype">double</span> improvement = makeCost_[atomIdx] - breakCost_[atomIdx];
<a name="l00969"></a>00969     <span class="keywordflow">return</span> improvement;
<a name="l00970"></a>00970   }
<a name="l00971"></a>00971   
<a name="l00978"></a><a class="code" href="classVariableState.html#9082644cc8bc821e0ad8abd85bf11f80">00978</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#9082644cc8bc821e0ad8abd85bf11f80">activateAtom</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; atomIdx, <span class="keyword">const</span> <span class="keywordtype">bool</span>&amp; ignoreActivePreds)
<a name="l00979"></a>00979   {
<a name="l00980"></a>00980       <span class="comment">// Lazy version: if atom is not active, we need to activate clauses</span>
<a name="l00981"></a>00981       <span class="comment">// and take their cost into account</span>
<a name="l00982"></a>00982     <span class="keywordflow">if</span> (lazy_ &amp;&amp; !<a class="code" href="classVariableState.html#d1809e4857db8f403c53948b0ba9e960">isActive</a>(atomIdx))
<a name="l00983"></a>00983     {
<a name="l00984"></a>00984       <a class="code" href="classPredicate.html">Predicate</a>* p =
<a name="l00985"></a>00985         gndPredHashArray_[atomIdx - 1]-&gt;createEquivalentPredicate(domain_);
<a name="l00986"></a>00986       <a class="code" href="classVariableState.html#1944a7ef1d312dab635ad19801ba13f7">getActiveClauses</a>(p, newClauses_, <span class="keyword">true</span>, ignoreActivePreds);
<a name="l00987"></a>00987         <span class="comment">// Add the clauses and preds and fill info arrays</span>
<a name="l00988"></a>00988       <span class="keywordtype">bool</span> initial = <span class="keyword">false</span>;
<a name="l00989"></a>00989       <a class="code" href="classVariableState.html#2748a93f222dafedaf7443634e234ddd">addNewClauses</a>(initial);
<a name="l00990"></a>00990         <span class="comment">// Set active status in db</span>
<a name="l00991"></a>00991       domain_-&gt;<a class="code" href="classDomain.html#732940c3a6c4064099aaf353513b553f">getDB</a>()-&gt;<a class="code" href="classDatabase.html#60d5fbbfcda7a0e255e3727f4b7b148d">setActiveStatus</a>(p, <span class="keyword">true</span>);
<a name="l00992"></a>00992       activeAtoms_++;
<a name="l00993"></a>00993       <span class="keyword">delete</span> p;
<a name="l00994"></a>00994     }        
<a name="l00995"></a>00995   }
<a name="l00996"></a>00996 
<a name="l01003"></a><a class="code" href="classVariableState.html#d1809e4857db8f403c53948b0ba9e960">01003</a>   <span class="keywordtype">bool</span> <a class="code" href="classVariableState.html#d1809e4857db8f403c53948b0ba9e960">isActive</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; atomIdx)
<a name="l01004"></a>01004   {
<a name="l01005"></a>01005     <span class="keywordflow">return</span> domain_-&gt;<a class="code" href="classDomain.html#732940c3a6c4064099aaf353513b553f">getDB</a>()-&gt;<a class="code" href="classDatabase.html#a57622c524765825fb8ca985d84733b0">getActiveStatus</a>(gndPredHashArray_[atomIdx-1]);
<a name="l01006"></a>01006   }
<a name="l01007"></a>01007   
<a name="l01014"></a><a class="code" href="classVariableState.html#d827fe2df8b496ba5ba583514caa89ea">01014</a>   <span class="keywordtype">bool</span> <a class="code" href="classVariableState.html#d1809e4857db8f403c53948b0ba9e960">isActive</a>(<span class="keyword">const</span> <a class="code" href="classPredicate.html">Predicate</a>* pred)
<a name="l01015"></a>01015   {
<a name="l01016"></a>01016     <span class="keywordflow">return</span> domain_-&gt;<a class="code" href="classDomain.html#732940c3a6c4064099aaf353513b553f">getDB</a>()-&gt;<a class="code" href="classDatabase.html#a57622c524765825fb8ca985d84733b0">getActiveStatus</a>(pred);
<a name="l01017"></a>01017   }
<a name="l01018"></a>01018 
<a name="l01022"></a><a class="code" href="classVariableState.html#32dc7e8ae1facd20d885cf6dac4c0028">01022</a>   <a class="code" href="classArray.html">Array&lt;int&gt;</a>&amp; <a class="code" href="classVariableState.html#32dc7e8ae1facd20d885cf6dac4c0028">getOccurenceArray</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; idx)
<a name="l01023"></a>01023   {
<a name="l01024"></a>01024     <span class="keywordflow">return</span> occurence_[idx];
<a name="l01025"></a>01025   }
<a name="l01026"></a>01026   
<a name="l01030"></a><a class="code" href="classVariableState.html#430605283b71f8a1c2ece97b62f6741f">01030</a>   <span class="keywordtype">int</span> <a class="code" href="classVariableState.html#430605283b71f8a1c2ece97b62f6741f">incrementNumTrueLits</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; clauseIdx)
<a name="l01031"></a>01031   {
<a name="l01032"></a>01032     <span class="keywordflow">return</span> ++numTrueLits_[clauseIdx];
<a name="l01033"></a>01033   }
<a name="l01034"></a>01034 
<a name="l01038"></a><a class="code" href="classVariableState.html#df2045508a3820ac75f02bd297c587f8">01038</a>   <span class="keywordtype">int</span> <a class="code" href="classVariableState.html#df2045508a3820ac75f02bd297c587f8">decrementNumTrueLits</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; clauseIdx)
<a name="l01039"></a>01039   {
<a name="l01040"></a>01040     <span class="keywordflow">return</span> --numTrueLits_[clauseIdx];
<a name="l01041"></a>01041   }
<a name="l01042"></a>01042 
<a name="l01046"></a><a class="code" href="classVariableState.html#b6a9a11612400d7eebd0c4c50731ee65">01046</a>   <span class="keywordtype">int</span> <a class="code" href="classVariableState.html#b6a9a11612400d7eebd0c4c50731ee65">getNumTrueLits</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; clauseIdx)
<a name="l01047"></a>01047   {
<a name="l01048"></a>01048     <span class="keywordflow">return</span> numTrueLits_[clauseIdx];
<a name="l01049"></a>01049   }
<a name="l01050"></a>01050 
<a name="l01054"></a><a class="code" href="classVariableState.html#ce8401a0ed90726319c8d8d15cb5da30">01054</a>   <span class="keywordtype">long</span> <span class="keywordtype">double</span> <a class="code" href="classVariableState.html#ce8401a0ed90726319c8d8d15cb5da30">getClauseCost</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; clauseIdx)
<a name="l01055"></a>01055   {
<a name="l01056"></a>01056     <span class="keywordflow">return</span> clauseCost_[clauseIdx];
<a name="l01057"></a>01057   }
<a name="l01058"></a>01058   
<a name="l01062"></a><a class="code" href="classVariableState.html#304eb59515687e3d439fcd2bdc7d071f">01062</a>   <a class="code" href="classArray.html">Array&lt;int&gt;</a>&amp; <a class="code" href="classVariableState.html#304eb59515687e3d439fcd2bdc7d071f">getAtomsInClause</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; clauseIdx)
<a name="l01063"></a>01063   {
<a name="l01064"></a>01064     <span class="keywordflow">return</span> clause_[clauseIdx];
<a name="l01065"></a>01065   }
<a name="l01066"></a>01066 
<a name="l01070"></a><a class="code" href="classVariableState.html#a57ed676fde7a24d57e527756d592bd5">01070</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#a57ed676fde7a24d57e527756d592bd5">addFalseClause</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; clauseIdx)
<a name="l01071"></a>01071   {
<a name="l01072"></a>01072     falseClause_[numFalseClauses_] = clauseIdx;
<a name="l01073"></a>01073     whereFalse_[clauseIdx] = numFalseClauses_;
<a name="l01074"></a>01074     numFalseClauses_++;
<a name="l01075"></a>01075     costOfFalseClauses_ += abs(clauseCost_[clauseIdx]);
<a name="l01076"></a>01076   }
<a name="l01077"></a>01077   
<a name="l01081"></a><a class="code" href="classVariableState.html#324631d59cff78ffd52163f584bd237c">01081</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#324631d59cff78ffd52163f584bd237c">removeFalseClause</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; clauseIdx)
<a name="l01082"></a>01082   {
<a name="l01083"></a>01083     numFalseClauses_--;
<a name="l01084"></a>01084     falseClause_[whereFalse_[clauseIdx]] = falseClause_[numFalseClauses_];
<a name="l01085"></a>01085     whereFalse_[falseClause_[numFalseClauses_]] = whereFalse_[clauseIdx];
<a name="l01086"></a>01086     costOfFalseClauses_ -= abs(clauseCost_[clauseIdx]);
<a name="l01087"></a>01087   }
<a name="l01088"></a>01088 
<a name="l01092"></a><a class="code" href="classVariableState.html#e598f0dd45da0c61dacebea3871d9581">01092</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#e598f0dd45da0c61dacebea3871d9581">addBreakCost</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; atomIdx, <span class="keyword">const</span> <span class="keywordtype">long</span> <span class="keywordtype">double</span>&amp; cost)
<a name="l01093"></a>01093   {
<a name="l01094"></a>01094     breakCost_[atomIdx] += cost;
<a name="l01095"></a>01095   }
<a name="l01096"></a>01096 
<a name="l01100"></a><a class="code" href="classVariableState.html#168251599d33f81bd971d4f6417d7888">01100</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#168251599d33f81bd971d4f6417d7888">subtractBreakCost</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; atomIdx, <span class="keyword">const</span> <span class="keywordtype">long</span> <span class="keywordtype">double</span>&amp; cost)
<a name="l01101"></a>01101   {
<a name="l01102"></a>01102     breakCost_[atomIdx] -= cost;
<a name="l01103"></a>01103   }
<a name="l01104"></a>01104 
<a name="l01111"></a><a class="code" href="classVariableState.html#8bda003606fd8a852f44a988124adb19">01111</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#8bda003606fd8a852f44a988124adb19">addBreakCostToAtomsInClause</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; clauseIdx,
<a name="l01112"></a>01112                                    <span class="keyword">const</span> <span class="keywordtype">long</span> <span class="keywordtype">double</span>&amp; cost)
<a name="l01113"></a>01113   {
<a name="l01114"></a>01114     <span class="keyword">register</span> <span class="keywordtype">int</span> size = <a class="code" href="classVariableState.html#12d6e101244182a1962c99cc016f4b78">getClauseSize</a>(clauseIdx);
<a name="l01115"></a>01115     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; size; i++)
<a name="l01116"></a>01116     {
<a name="l01117"></a>01117       <span class="keyword">register</span> <span class="keywordtype">int</span> lit = clause_[clauseIdx][i];
<a name="l01118"></a>01118       breakCost_[abs(lit)] += cost;
<a name="l01119"></a>01119     }
<a name="l01120"></a>01120   }
<a name="l01121"></a>01121 
<a name="l01128"></a><a class="code" href="classVariableState.html#875cd0493e8d3ee050ef661ac01a7bcf">01128</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#875cd0493e8d3ee050ef661ac01a7bcf">subtractBreakCostFromAtomsInClause</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; clauseIdx,
<a name="l01129"></a>01129                                           <span class="keyword">const</span> <span class="keywordtype">long</span> <span class="keywordtype">double</span>&amp; cost)
<a name="l01130"></a>01130   {
<a name="l01131"></a>01131     <span class="keyword">register</span> <span class="keywordtype">int</span> size = <a class="code" href="classVariableState.html#12d6e101244182a1962c99cc016f4b78">getClauseSize</a>(clauseIdx);
<a name="l01132"></a>01132     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; size; i++)
<a name="l01133"></a>01133     {
<a name="l01134"></a>01134       <span class="keyword">register</span> <span class="keywordtype">int</span> lit = clause_[clauseIdx][i];
<a name="l01135"></a>01135       breakCost_[abs(lit)] -= cost;
<a name="l01136"></a>01136     }
<a name="l01137"></a>01137   }
<a name="l01138"></a>01138 
<a name="l01145"></a><a class="code" href="classVariableState.html#d1574f8f2d9106457d6bb1b2d3282d60">01145</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#d1574f8f2d9106457d6bb1b2d3282d60">addMakeCost</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; atomIdx, <span class="keyword">const</span> <span class="keywordtype">long</span> <span class="keywordtype">double</span>&amp; cost)
<a name="l01146"></a>01146   {
<a name="l01147"></a>01147     makeCost_[atomIdx] += cost;
<a name="l01148"></a>01148   }
<a name="l01149"></a>01149 
<a name="l01156"></a><a class="code" href="classVariableState.html#4557a6ec0c103778dea9032a930b8f4e">01156</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#4557a6ec0c103778dea9032a930b8f4e">subtractMakeCost</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; atomIdx, <span class="keyword">const</span> <span class="keywordtype">long</span> <span class="keywordtype">double</span>&amp; cost)
<a name="l01157"></a>01157   {
<a name="l01158"></a>01158     makeCost_[atomIdx] -= cost;
<a name="l01159"></a>01159   }
<a name="l01160"></a>01160 
<a name="l01167"></a><a class="code" href="classVariableState.html#189a058bc545cb3f284cf479d45dd6eb">01167</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#189a058bc545cb3f284cf479d45dd6eb">addMakeCostToAtomsInClause</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; clauseIdx,
<a name="l01168"></a>01168                                   <span class="keyword">const</span> <span class="keywordtype">long</span> <span class="keywordtype">double</span>&amp; cost)
<a name="l01169"></a>01169   {
<a name="l01170"></a>01170     <span class="keyword">register</span> <span class="keywordtype">int</span> size = <a class="code" href="classVariableState.html#12d6e101244182a1962c99cc016f4b78">getClauseSize</a>(clauseIdx);
<a name="l01171"></a>01171     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; size; i++)
<a name="l01172"></a>01172     {
<a name="l01173"></a>01173       <span class="keyword">register</span> <span class="keywordtype">int</span> lit = clause_[clauseIdx][i];
<a name="l01174"></a>01174       makeCost_[abs(lit)] += cost;
<a name="l01175"></a>01175     }
<a name="l01176"></a>01176   }
<a name="l01177"></a>01177 
<a name="l01184"></a><a class="code" href="classVariableState.html#884bd8ade0d0e51f2c300e66eff68fc9">01184</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#884bd8ade0d0e51f2c300e66eff68fc9">subtractMakeCostFromAtomsInClause</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; clauseIdx,
<a name="l01185"></a>01185                                          <span class="keyword">const</span> <span class="keywordtype">long</span> <span class="keywordtype">double</span>&amp; cost)
<a name="l01186"></a>01186   {
<a name="l01187"></a>01187     <span class="keyword">register</span> <span class="keywordtype">int</span> size = <a class="code" href="classVariableState.html#12d6e101244182a1962c99cc016f4b78">getClauseSize</a>(clauseIdx);
<a name="l01188"></a>01188     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; size; i++)
<a name="l01189"></a>01189     {
<a name="l01190"></a>01190       <span class="keyword">register</span> <span class="keywordtype">int</span> lit = clause_[clauseIdx][i];
<a name="l01191"></a>01191       makeCost_[abs(lit)] -= cost;
<a name="l01192"></a>01192     }
<a name="l01193"></a>01193   }
<a name="l01194"></a>01194 
<a name="l01204"></a><a class="code" href="classVariableState.html#9a385abc27c6cf5d891c52204a8b9faa">01204</a>   <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classVariableState.html#9a385abc27c6cf5d891c52204a8b9faa">getTrueLiteralOtherThan</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; clauseIdx,
<a name="l01205"></a>01205                                     <span class="keyword">const</span> <span class="keywordtype">int</span>&amp; atomIdx1,
<a name="l01206"></a>01206                                     <span class="keyword">const</span> <span class="keywordtype">int</span>&amp; atomIdx2)
<a name="l01207"></a>01207   {
<a name="l01208"></a>01208     <span class="keyword">register</span> <span class="keywordtype">int</span> size = <a class="code" href="classVariableState.html#12d6e101244182a1962c99cc016f4b78">getClauseSize</a>(clauseIdx);
<a name="l01209"></a>01209     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; size; i++)
<a name="l01210"></a>01210     {
<a name="l01211"></a>01211       <span class="keyword">register</span> <span class="keywordtype">int</span> lit = clause_[clauseIdx][i];
<a name="l01212"></a>01212       <span class="keyword">register</span> <span class="keywordtype">int</span> v = abs(lit);
<a name="l01213"></a>01213       <span class="keywordflow">if</span> (<a class="code" href="classVariableState.html#a6cd0ba26bb4d5c3f7b19d0cd76f3317">isTrueLiteral</a>(lit) &amp;&amp; v != atomIdx1 &amp;&amp; v != atomIdx2)
<a name="l01214"></a>01214         <span class="keywordflow">return</span> v;
<a name="l01215"></a>01215     }
<a name="l01216"></a>01216       <span class="comment">// If we're here, then no other true lit exists</span>
<a name="l01217"></a>01217     assert(<span class="keyword">false</span>);
<a name="l01218"></a>01218     <span class="keywordflow">return</span> -1;
<a name="l01219"></a>01219   }
<a name="l01220"></a>01220   
<a name="l01224"></a><a class="code" href="classVariableState.html#a6cd0ba26bb4d5c3f7b19d0cd76f3317">01224</a>   <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="classVariableState.html#a6cd0ba26bb4d5c3f7b19d0cd76f3317">isTrueLiteral</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; literal)
<a name="l01225"></a>01225   {
<a name="l01226"></a>01226     <span class="keywordflow">return</span> ((literal &gt; 0) == atom_[abs(literal)]);
<a name="l01227"></a>01227   }
<a name="l01228"></a>01228 
<a name="l01232"></a><a class="code" href="classVariableState.html#b148c43ffe3b2cb5d58a1fcd66e58e23">01232</a>   <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classVariableState.html#b148c43ffe3b2cb5d58a1fcd66e58e23">getAtomInClause</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; atomIdxInClause, <span class="keyword">const</span> <span class="keywordtype">int</span>&amp; clauseIdx)
<a name="l01233"></a>01233   {
<a name="l01234"></a>01234     <span class="keywordflow">return</span> clause_[clauseIdx][atomIdxInClause];
<a name="l01235"></a>01235   }
<a name="l01236"></a>01236 
<a name="l01240"></a><a class="code" href="classVariableState.html#a7f6f911d7f857cc29b17bc07c36b380">01240</a>   <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classVariableState.html#a7f6f911d7f857cc29b17bc07c36b380">getRandomAtomInClause</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; clauseIdx)
<a name="l01241"></a>01241   {
<a name="l01242"></a>01242     <span class="keywordflow">return</span> clause_[clauseIdx][random()%<a class="code" href="classVariableState.html#12d6e101244182a1962c99cc016f4b78">getClauseSize</a>(clauseIdx)];
<a name="l01243"></a>01243   }
<a name="l01244"></a>01244 
<a name="l01251"></a><a class="code" href="classVariableState.html#2464e6883cae56360dfdccd4704e9a34">01251</a>   <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classVariableState.html#2464e6883cae56360dfdccd4704e9a34">getRandomTrueLitInClause</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; clauseIdx)
<a name="l01252"></a>01252   {
<a name="l01253"></a>01253     assert(numTrueLits_[clauseIdx] &gt; 0);
<a name="l01254"></a>01254     <span class="keywordtype">int</span> trueLit = random()%numTrueLits_[clauseIdx];
<a name="l01255"></a>01255     <span class="keywordtype">int</span> whichTrueLit = 0;
<a name="l01256"></a>01256     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classVariableState.html#12d6e101244182a1962c99cc016f4b78">getClauseSize</a>(clauseIdx); i++)
<a name="l01257"></a>01257     {
<a name="l01258"></a>01258       <span class="keywordtype">int</span> lit = clause_[clauseIdx][i];
<a name="l01259"></a>01259       <span class="keywordtype">int</span> atm = abs(lit);
<a name="l01260"></a>01260         <span class="comment">// True literal</span>
<a name="l01261"></a>01261       <span class="keywordflow">if</span> (<a class="code" href="classVariableState.html#a6cd0ba26bb4d5c3f7b19d0cd76f3317">isTrueLiteral</a>(lit))
<a name="l01262"></a>01262         <span class="keywordflow">if</span> (trueLit == whichTrueLit++)
<a name="l01263"></a>01263           <span class="keywordflow">return</span> atm;
<a name="l01264"></a>01264     }
<a name="l01265"></a>01265       <span class="comment">// If we're here, then no other true lit exists</span>
<a name="l01266"></a>01266     assert(<span class="keyword">false</span>);
<a name="l01267"></a>01267     <span class="keywordflow">return</span> -1;
<a name="l01268"></a>01268   }
<a name="l01269"></a>01269 
<a name="l01270"></a><a class="code" href="classVariableState.html#7931e1d2b5d6b39bad5109d3574f82be">01270</a>   <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="classVariableState.html#7931e1d2b5d6b39bad5109d3574f82be">getMaxClauseWeight</a>()
<a name="l01271"></a>01271   {
<a name="l01272"></a>01272     <span class="keywordtype">double</span> maxWeight = 0.0;
<a name="l01273"></a>01273     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classVariableState.html#703e262481d6c0b076799511af07df67">getNumClauses</a>(); i++)
<a name="l01274"></a>01274     {
<a name="l01275"></a>01275       <span class="keywordtype">double</span> weight = abs(clauseCost_[i]);
<a name="l01276"></a>01276       <span class="keywordflow">if</span> (weight &gt; maxWeight) maxWeight = weight;
<a name="l01277"></a>01277     }
<a name="l01278"></a>01278     <span class="keywordflow">return</span> maxWeight;
<a name="l01279"></a>01279   }
<a name="l01280"></a>01280   
<a name="l01281"></a><a class="code" href="classVariableState.html#5166274f9edd5ea901f9abf8315843b8">01281</a>   <span class="keyword">const</span> <span class="keywordtype">long</span> <span class="keywordtype">double</span> <a class="code" href="classVariableState.html#5166274f9edd5ea901f9abf8315843b8">getMakeCost</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; atomIdx)
<a name="l01282"></a>01282   {
<a name="l01283"></a>01283     <span class="keywordflow">return</span> makeCost_[atomIdx];
<a name="l01284"></a>01284   }
<a name="l01285"></a>01285    
<a name="l01286"></a><a class="code" href="classVariableState.html#4c562c16692e5b895446b9d7f4d23f17">01286</a>   <span class="keyword">const</span> <span class="keywordtype">long</span> <span class="keywordtype">double</span> <a class="code" href="classVariableState.html#4c562c16692e5b895446b9d7f4d23f17">getBreakCost</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; atomIdx)
<a name="l01287"></a>01287   {
<a name="l01288"></a>01288     <span class="keywordflow">return</span> breakCost_[atomIdx];
<a name="l01289"></a>01289   }
<a name="l01290"></a>01290    
<a name="l01291"></a><a class="code" href="classVariableState.html#12d6e101244182a1962c99cc016f4b78">01291</a>   <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classVariableState.html#12d6e101244182a1962c99cc016f4b78">getClauseSize</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; clauseIdx)
<a name="l01292"></a>01292   {
<a name="l01293"></a>01293     <span class="keywordflow">return</span> clause_[clauseIdx].<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>();
<a name="l01294"></a>01294   }
<a name="l01295"></a>01295 
<a name="l01296"></a><a class="code" href="classVariableState.html#1ff785b813b350e67466c7210856243e">01296</a>   <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classVariableState.html#1ff785b813b350e67466c7210856243e">getWatch1</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; clauseIdx)
<a name="l01297"></a>01297   {
<a name="l01298"></a>01298     <span class="keywordflow">return</span> watch1_[clauseIdx];
<a name="l01299"></a>01299   }
<a name="l01300"></a>01300 
<a name="l01301"></a><a class="code" href="classVariableState.html#c0823bb22e2680eec885ca035ec17548">01301</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#c0823bb22e2680eec885ca035ec17548">setWatch1</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; clauseIdx, <span class="keyword">const</span> <span class="keywordtype">int</span>&amp; atomIdx)
<a name="l01302"></a>01302   {
<a name="l01303"></a>01303     watch1_[clauseIdx] = atomIdx;
<a name="l01304"></a>01304   }
<a name="l01305"></a>01305   
<a name="l01306"></a><a class="code" href="classVariableState.html#04e9c3e0a50b7bdfd04cdc0bafd6906d">01306</a>   <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classVariableState.html#04e9c3e0a50b7bdfd04cdc0bafd6906d">getWatch2</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; clauseIdx)
<a name="l01307"></a>01307   {
<a name="l01308"></a>01308     <span class="keywordflow">return</span> watch2_[clauseIdx];
<a name="l01309"></a>01309   }
<a name="l01310"></a>01310 
<a name="l01311"></a><a class="code" href="classVariableState.html#575dad9109552494ca6c9a56582844c7">01311</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#575dad9109552494ca6c9a56582844c7">setWatch2</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; clauseIdx, <span class="keyword">const</span> <span class="keywordtype">int</span>&amp; atomIdx)
<a name="l01312"></a>01312   {
<a name="l01313"></a>01313     watch2_[clauseIdx] = atomIdx;
<a name="l01314"></a>01314   }
<a name="l01315"></a>01315   
<a name="l01316"></a><a class="code" href="classVariableState.html#a42f553cdd24e54b7f96f67a1ce138d3">01316</a>   <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="classVariableState.html#a42f553cdd24e54b7f96f67a1ce138d3">isBlockEvidence</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; blockIdx)
<a name="l01317"></a>01317   {
<a name="l01318"></a>01318     <span class="keywordflow">return</span> (*blockEvidence_)[blockIdx];
<a name="l01319"></a>01319   }
<a name="l01320"></a>01320 
<a name="l01321"></a><a class="code" href="classVariableState.html#783eea1b0ecfd64095ddbb50cbaacb80">01321</a>   <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classVariableState.html#783eea1b0ecfd64095ddbb50cbaacb80">getBlockSize</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; blockIdx)
<a name="l01322"></a>01322   {
<a name="l01323"></a>01323       <span class="comment">// Lazy: blocks are in domain</span>
<a name="l01324"></a>01324     <span class="keywordflow">if</span> (lazy_)
<a name="l01325"></a>01325       <span class="keywordflow">return</span> domain_-&gt;<a class="code" href="classDomain.html#36913a072d47f3d22c4550cb1b5feb99">getPredBlock</a>(blockIdx)-&gt;<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>();
<a name="l01326"></a>01326     <span class="keywordflow">else</span>
<a name="l01327"></a>01327       <span class="keywordflow">return</span> (*blocks_)[blockIdx].size();
<a name="l01328"></a>01328   }
<a name="l01329"></a>01329   
<a name="l01334"></a><a class="code" href="classVariableState.html#48db641f2970801eefcb83a0147d9173">01334</a>   <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classVariableState.html#48db641f2970801eefcb83a0147d9173">getBlockIndex</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; atomIdx)
<a name="l01335"></a>01335   {
<a name="l01336"></a>01336     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; blocks_-&gt;<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>(); i++)
<a name="l01337"></a>01337     {
<a name="l01338"></a>01338       <span class="keywordtype">int</span> blockIdx = (*blocks_)[i].find(atomIdx);
<a name="l01339"></a>01339       <span class="keywordflow">if</span> (blockIdx &gt;= 0)
<a name="l01340"></a>01340         <span class="keywordflow">return</span> i;
<a name="l01341"></a>01341     }
<a name="l01342"></a>01342     <span class="keywordflow">return</span> -1;
<a name="l01343"></a>01343   }
<a name="l01344"></a>01344   
<a name="l01345"></a><a class="code" href="classVariableState.html#42099717c3620c1806f2a1d6588e27bc">01345</a>   <a class="code" href="classArray.html">Array&lt;int&gt;</a>&amp; <a class="code" href="classVariableState.html#42099717c3620c1806f2a1d6588e27bc">getBlockArray</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; blockIdx)
<a name="l01346"></a>01346   {
<a name="l01347"></a>01347     <span class="keywordflow">return</span> (*blocks_)[blockIdx];
<a name="l01348"></a>01348   }
<a name="l01349"></a>01349 
<a name="l01350"></a><a class="code" href="classVariableState.html#b70bc9bf914ce154f8515715f4cace80">01350</a>   <span class="keywordtype">bool</span> <a class="code" href="classVariableState.html#b70bc9bf914ce154f8515715f4cace80">getBlockEvidence</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; blockIdx)
<a name="l01351"></a>01351   {
<a name="l01352"></a>01352     <span class="keywordflow">return</span> (*blockEvidence_)[blockIdx];
<a name="l01353"></a>01353   }
<a name="l01354"></a>01354   
<a name="l01355"></a><a class="code" href="classVariableState.html#5270f9c8fe20d2917f51bfc2a93d4ecb">01355</a>   <span class="keywordtype">int</span> <a class="code" href="classVariableState.html#5270f9c8fe20d2917f51bfc2a93d4ecb">getNumBlocks</a>()
<a name="l01356"></a>01356   {
<a name="l01357"></a>01357     <span class="keywordflow">return</span> blocks_-&gt;<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>();
<a name="l01358"></a>01358   }
<a name="l01359"></a>01359   
<a name="l01363"></a><a class="code" href="classVariableState.html#94db87fa8e1827f8ee9a0ed315d3f606">01363</a>   <span class="keyword">const</span> <span class="keywordtype">long</span> <span class="keywordtype">double</span> <a class="code" href="classVariableState.html#94db87fa8e1827f8ee9a0ed315d3f606">getLowCost</a>()
<a name="l01364"></a>01364   {
<a name="l01365"></a>01365     <span class="keywordflow">return</span> lowCost_; 
<a name="l01366"></a>01366   }
<a name="l01367"></a>01367 
<a name="l01371"></a><a class="code" href="classVariableState.html#a6aef60392382d145d024f6f06e148b2">01371</a>   <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classVariableState.html#a6aef60392382d145d024f6f06e148b2">getLowBad</a>()
<a name="l01372"></a>01372   {
<a name="l01373"></a>01373     <span class="keywordflow">return</span> lowBad_;
<a name="l01374"></a>01374   }
<a name="l01375"></a>01375 
<a name="l01380"></a><a class="code" href="classVariableState.html#770da3b8b33f4aeff3de22e0ddc451e7">01380</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#770da3b8b33f4aeff3de22e0ddc451e7">makeUnitCosts</a>()
<a name="l01381"></a>01381   {
<a name="l01382"></a>01382     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; clauseCost_.<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>(); i++)
<a name="l01383"></a>01383     {
<a name="l01384"></a>01384       <span class="keywordflow">if</span> (clauseCost_[i] &gt; 0) clauseCost_[i] = 1.0;
<a name="l01385"></a>01385       <span class="keywordflow">else</span>
<a name="l01386"></a>01386       {
<a name="l01387"></a>01387         assert(clauseCost_[i] &lt; 0);
<a name="l01388"></a>01388         clauseCost_[i] = -1.0;
<a name="l01389"></a>01389       }
<a name="l01390"></a>01390     }
<a name="l01391"></a>01391     <span class="keywordflow">if</span> (vsdebug) cout &lt;&lt; <span class="stringliteral">"Made unit costs"</span> &lt;&lt; endl;
<a name="l01392"></a>01392     <a class="code" href="classVariableState.html#2c53e96f2f2f3ed8978fae90a7daad36">initMakeBreakCostWatch</a>();
<a name="l01393"></a>01393   }
<a name="l01394"></a>01394 
<a name="l01398"></a><a class="code" href="classVariableState.html#bfbe2f7663f7938cedf0888d5a189712">01398</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#bfbe2f7663f7938cedf0888d5a189712">saveLowState</a>()
<a name="l01399"></a>01399   {
<a name="l01400"></a>01400     <span class="keywordflow">if</span> (vsdebug) cout &lt;&lt; <span class="stringliteral">"Saving low state: "</span> &lt;&lt; endl;
<a name="l01401"></a>01401     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt;= <a class="code" href="classVariableState.html#bc520a99648ee29ef9447b86c26d9faf">getNumAtoms</a>(); i++)
<a name="l01402"></a>01402     {
<a name="l01403"></a>01403       lowAtom_[i] = atom_[i];
<a name="l01404"></a>01404       <span class="keywordflow">if</span> (vsdebug) cout &lt;&lt; lowAtom_[i] &lt;&lt; endl;
<a name="l01405"></a>01405     }
<a name="l01406"></a>01406     lowCost_ = costOfFalseClauses_;
<a name="l01407"></a>01407     lowBad_ = numFalseClauses_;
<a name="l01408"></a>01408   }
<a name="l01409"></a>01409 
<a name="l01413"></a><a class="code" href="classVariableState.html#bec37519e017eb2799b2ec09d0cdf0af">01413</a>   <span class="keywordtype">int</span> <a class="code" href="classVariableState.html#bec37519e017eb2799b2ec09d0cdf0af">getTrueFixedAtomInBlock</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> blockIdx)
<a name="l01414"></a>01414   {
<a name="l01415"></a>01415     <a class="code" href="classArray.html">Array&lt;int&gt;</a>&amp; block = (*blocks_)[blockIdx];
<a name="l01416"></a>01416     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; block.<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>(); i++)
<a name="l01417"></a>01417       <span class="keywordflow">if</span> (fixedAtom_[block[i] + 1] &gt; 0) <span class="keywordflow">return</span> i;
<a name="l01418"></a>01418     <span class="keywordflow">return</span> -1;
<a name="l01419"></a>01419   }
<a name="l01420"></a>01420 
<a name="l01421"></a><a class="code" href="classVariableState.html#fd93e92c1f1a6f906289bc37b0eb5d0f">01421</a>   <span class="keyword">const</span> <a class="code" href="classHashArray.html">GroundPredicateHashArray</a>* <a class="code" href="classVariableState.html#fd93e92c1f1a6f906289bc37b0eb5d0f">getGndPredHashArrayPtr</a>()<span class="keyword"> const</span>
<a name="l01422"></a>01422 <span class="keyword">  </span>{
<a name="l01423"></a>01423     <span class="keywordflow">return</span> &amp;gndPredHashArray_;
<a name="l01424"></a>01424   }
<a name="l01425"></a>01425 
<a name="l01426"></a><a class="code" href="classVariableState.html#e86b1ea959f145302a6044f958e195cc">01426</a>   <span class="keyword">const</span> <a class="code" href="classHashArray.html">GroundPredicateHashArray</a>* <a class="code" href="classVariableState.html#e86b1ea959f145302a6044f958e195cc">getUnePreds</a>()<span class="keyword"> const</span>
<a name="l01427"></a>01427 <span class="keyword">  </span>{
<a name="l01428"></a>01428     <span class="keywordflow">return</span> unePreds_;
<a name="l01429"></a>01429   }
<a name="l01430"></a>01430 
<a name="l01431"></a><a class="code" href="classVariableState.html#919610377b94639dddbb749e348c44cf">01431</a>   <span class="keyword">const</span> <a class="code" href="classHashArray.html">GroundPredicateHashArray</a>* <a class="code" href="classVariableState.html#919610377b94639dddbb749e348c44cf">getKnePreds</a>()<span class="keyword"> const</span>
<a name="l01432"></a>01432 <span class="keyword">  </span>{
<a name="l01433"></a>01433     <span class="keywordflow">return</span> knePreds_;
<a name="l01434"></a>01434   }
<a name="l01435"></a>01435 
<a name="l01436"></a><a class="code" href="classVariableState.html#b2f6b6972649b634eb1eacce1e3bcda4">01436</a>   <span class="keyword">const</span> <a class="code" href="classArray.html">Array&lt;TruthValue&gt;</a>* <a class="code" href="classVariableState.html#b2f6b6972649b634eb1eacce1e3bcda4">getKnePredValues</a>()<span class="keyword"> const</span>
<a name="l01437"></a>01437 <span class="keyword">  </span>{
<a name="l01438"></a>01438     <span class="keywordflow">return</span> knePredValues_;
<a name="l01439"></a>01439   }
<a name="l01440"></a>01440 
<a name="l01444"></a><a class="code" href="classVariableState.html#4162873f734b00ff359fa71bd27e1441">01444</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#4162873f734b00ff359fa71bd27e1441">setGndClausesWtsToSumOfParentWts</a>()
<a name="l01445"></a>01445   {
<a name="l01446"></a>01446     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; gndClauses_-&gt;<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>(); i++)
<a name="l01447"></a>01447     {
<a name="l01448"></a>01448       <a class="code" href="classGroundClause.html">GroundClause</a>* gndClause = (*gndClauses_)[i];
<a name="l01449"></a>01449       gndClause-&gt;setWtToSumOfParentWts();
<a name="l01450"></a>01450       <span class="keywordflow">if</span> (vsdebug) cout &lt;&lt; <span class="stringliteral">"Setting cost of clause "</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">" to "</span>
<a name="l01451"></a>01451                         &lt;&lt; gndClause-&gt;getWt() &lt;&lt; endl;
<a name="l01452"></a>01452       clauseCost_[i] = gndClause-&gt;getWt();
<a name="l01453"></a>01453 
<a name="l01454"></a>01454         <span class="comment">// Set thresholds for clause selection</span>
<a name="l01455"></a>01455       <span class="keywordflow">if</span> (gndClause-&gt;isHardClause()) threshold_[i] = RAND_MAX;
<a name="l01456"></a>01456       <span class="keywordflow">else</span>
<a name="l01457"></a>01457       {
<a name="l01458"></a>01458         <span class="keywordtype">double</span> w = gndClause-&gt;getWt();
<a name="l01459"></a>01459         threshold_[i] = RAND_MAX*(1 - exp(-abs(w)));
<a name="l01460"></a>01460         <span class="keywordflow">if</span> (vsdebug)
<a name="l01461"></a>01461         {
<a name="l01462"></a>01462           cout &lt;&lt; <span class="stringliteral">"Weight: "</span> &lt;&lt; w &lt;&lt; endl;            
<a name="l01463"></a>01463         }
<a name="l01464"></a>01464       }
<a name="l01465"></a>01465       <span class="keywordflow">if</span> (vsdebug)
<a name="l01466"></a>01466         cout &lt;&lt; <span class="stringliteral">"Threshold: "</span> &lt;&lt; threshold_[i] &lt;&lt; endl;
<a name="l01467"></a>01467     }
<a name="l01468"></a>01468   }
<a name="l01469"></a>01469 
<a name="l01478"></a><a class="code" href="classVariableState.html#27096b8568bf1595981b75b2922560e3">01478</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#27096b8568bf1595981b75b2922560e3">getNumClauseGndings</a>(<a class="code" href="classArray.html">Array&lt;double&gt;</a>* <span class="keyword">const</span> &amp; numGndings, <span class="keywordtype">bool</span> tv)
<a name="l01479"></a>01479   {
<a name="l01480"></a>01480     <span class="comment">// TODO: lazy version</span>
<a name="l01481"></a>01481     IntPairItr itr;
<a name="l01482"></a>01482     IntPair *clauseFrequencies;
<a name="l01483"></a>01483     
<a name="l01484"></a>01484       <span class="comment">// numGndings should have been initialized with non-negative values</span>
<a name="l01485"></a>01485     <span class="keywordtype">int</span> clauseCnt = numGndings-&gt;<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>();
<a name="l01486"></a>01486     assert(clauseCnt == mln_-&gt;<a class="code" href="classMLN.html#9af698a87c5b518e9ce18755bc414231">getNumClauses</a>());
<a name="l01487"></a>01487     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> clauseno = 0; clauseno &lt; clauseCnt; clauseno++)
<a name="l01488"></a>01488       assert ((*numGndings)[clauseno] &gt;= 0);
<a name="l01489"></a>01489     
<a name="l01490"></a>01490     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; gndClauses_-&gt;<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>(); i++)
<a name="l01491"></a>01491     {
<a name="l01492"></a>01492       <a class="code" href="classGroundClause.html">GroundClause</a> *gndClause = (*gndClauses_)[i];
<a name="l01493"></a>01493       <span class="keywordtype">int</span> satLitcnt = 0;
<a name="l01494"></a>01494       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; gndClause-&gt;getNumGroundPredicates(); j++)
<a name="l01495"></a>01495       {
<a name="l01496"></a>01496         <span class="keywordtype">int</span> lit = gndClause-&gt;getGroundPredicateIndex(j);
<a name="l01497"></a>01497         <span class="keywordflow">if</span> (<a class="code" href="classVariableState.html#a6cd0ba26bb4d5c3f7b19d0cd76f3317">isTrueLiteral</a>(lit)) satLitcnt++;
<a name="l01498"></a>01498       }
<a name="l01499"></a>01499       <span class="comment">//int satLitcnt = getNumTrueLits(i);</span>
<a name="l01500"></a>01500       <span class="keywordflow">if</span> (tv &amp;&amp; satLitcnt == 0)
<a name="l01501"></a>01501         <span class="keywordflow">continue</span>;
<a name="l01502"></a>01502       <span class="keywordflow">if</span> (!tv &amp;&amp; satLitcnt &gt; 0)
<a name="l01503"></a>01503         <span class="keywordflow">continue</span>;
<a name="l01504"></a>01504 
<a name="l01505"></a>01505       clauseFrequencies = gndClause-&gt;getClauseFrequencies();
<a name="l01506"></a>01506       <span class="keywordflow">for</span> (itr = clauseFrequencies-&gt;begin();
<a name="l01507"></a>01507            itr != clauseFrequencies-&gt;end(); itr++)
<a name="l01508"></a>01508       {
<a name="l01509"></a>01509         <span class="keywordtype">int</span> clauseno = itr-&gt;first;
<a name="l01510"></a>01510         <span class="keywordtype">int</span> frequency = itr-&gt;second;
<a name="l01511"></a>01511         (*numGndings)[clauseno] += frequency;
<a name="l01512"></a>01512       }
<a name="l01513"></a>01513     }
<a name="l01514"></a>01514   }
<a name="l01515"></a>01515 
<a name="l01524"></a><a class="code" href="classVariableState.html#a082702ae807ec09afb99391faf58121">01524</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#27096b8568bf1595981b75b2922560e3">getNumClauseGndings</a>(<span class="keywordtype">double</span> numGndings[], <span class="keywordtype">int</span> clauseCnt, <span class="keywordtype">bool</span> tv)
<a name="l01525"></a>01525   {
<a name="l01526"></a>01526     <span class="comment">// TODO: lazy version</span>
<a name="l01527"></a>01527     IntPairItr itr;
<a name="l01528"></a>01528     IntPair *clauseFrequencies;
<a name="l01529"></a>01529     
<a name="l01530"></a>01530     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> clauseno = 0; clauseno &lt; clauseCnt; clauseno++)
<a name="l01531"></a>01531       numGndings[clauseno] = 0;
<a name="l01532"></a>01532     
<a name="l01533"></a>01533     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; gndClauses_-&gt;<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>(); i++)
<a name="l01534"></a>01534     {
<a name="l01535"></a>01535       <a class="code" href="classGroundClause.html">GroundClause</a> *gndClause = (*gndClauses_)[i];
<a name="l01536"></a>01536       <span class="keywordtype">int</span> satLitcnt = <a class="code" href="classVariableState.html#b6a9a11612400d7eebd0c4c50731ee65">getNumTrueLits</a>(i);
<a name="l01537"></a>01537       <span class="keywordflow">if</span> (tv &amp;&amp; satLitcnt == 0)
<a name="l01538"></a>01538         <span class="keywordflow">continue</span>;
<a name="l01539"></a>01539       <span class="keywordflow">if</span> (!tv &amp;&amp; satLitcnt &gt; 0)
<a name="l01540"></a>01540         <span class="keywordflow">continue</span>;
<a name="l01541"></a>01541 
<a name="l01542"></a>01542       clauseFrequencies = gndClause-&gt;getClauseFrequencies();
<a name="l01543"></a>01543       <span class="keywordflow">for</span> (itr = clauseFrequencies-&gt;begin();
<a name="l01544"></a>01544            itr != clauseFrequencies-&gt;end(); itr++)
<a name="l01545"></a>01545       {
<a name="l01546"></a>01546         <span class="keywordtype">int</span> clauseno = itr-&gt;first;
<a name="l01547"></a>01547         <span class="keywordtype">int</span> frequency = itr-&gt;second;
<a name="l01548"></a>01548         numGndings[clauseno] += frequency;
<a name="l01549"></a>01549       }
<a name="l01550"></a>01550     }
<a name="l01551"></a>01551   }
<a name="l01552"></a>01552 
<a name="l01564"></a><a class="code" href="classVariableState.html#a5927ac9488727ae38468de0f1488b6e">01564</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#a5927ac9488727ae38468de0f1488b6e">getNumClauseGndingsWithUnknown</a>(<span class="keywordtype">double</span> numGndings[], <span class="keywordtype">int</span> clauseCnt,
<a name="l01565"></a>01565                                       <span class="keywordtype">bool</span> tv,
<a name="l01566"></a>01566                                       <span class="keyword">const</span> <a class="code" href="classArray.html">Array&lt;bool&gt;</a>* <span class="keyword">const</span>&amp; unknownPred)
<a name="l01567"></a>01567   {
<a name="l01568"></a>01568     assert(unknownPred-&gt;<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>() == <a class="code" href="classVariableState.html#bc520a99648ee29ef9447b86c26d9faf">getNumAtoms</a>());
<a name="l01569"></a>01569     IntPairItr itr;
<a name="l01570"></a>01570     IntPair *clauseFrequencies;
<a name="l01571"></a>01571     
<a name="l01572"></a>01572     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> clauseno = 0; clauseno &lt; clauseCnt; clauseno++)
<a name="l01573"></a>01573       numGndings[clauseno] = 0;
<a name="l01574"></a>01574     
<a name="l01575"></a>01575     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; gndClauses_-&gt;<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>(); i++)
<a name="l01576"></a>01576     {
<a name="l01577"></a>01577       <a class="code" href="classGroundClause.html">GroundClause</a> *gndClause = (*gndClauses_)[i];
<a name="l01578"></a>01578       <span class="keywordtype">int</span> satLitcnt = 0;
<a name="l01579"></a>01579       <span class="keywordtype">bool</span> unknown = <span class="keyword">false</span>;
<a name="l01580"></a>01580       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; gndClause-&gt;getNumGroundPredicates(); j++)
<a name="l01581"></a>01581       {
<a name="l01582"></a>01582         <span class="keywordtype">int</span> lit = gndClause-&gt;getGroundPredicateIndex(j);
<a name="l01583"></a>01583         <span class="keywordflow">if</span> ((*unknownPred)[abs(lit) - 1])
<a name="l01584"></a>01584         {
<a name="l01585"></a>01585           unknown = <span class="keyword">true</span>;
<a name="l01586"></a>01586           <span class="keywordflow">continue</span>;
<a name="l01587"></a>01587         }
<a name="l01588"></a>01588         <span class="keywordflow">if</span> (<a class="code" href="classVariableState.html#a6cd0ba26bb4d5c3f7b19d0cd76f3317">isTrueLiteral</a>(lit)) satLitcnt++;
<a name="l01589"></a>01589       }
<a name="l01590"></a>01590       
<a name="l01591"></a>01591       <span class="keywordflow">if</span> (tv &amp;&amp; satLitcnt == 0)
<a name="l01592"></a>01592         <span class="keywordflow">continue</span>;
<a name="l01593"></a>01593       <span class="keywordflow">if</span> (!tv &amp;&amp; (satLitcnt &gt; 0 || unknown))
<a name="l01594"></a>01594         <span class="keywordflow">continue</span>;
<a name="l01595"></a>01595 
<a name="l01596"></a>01596       clauseFrequencies = gndClause-&gt;getClauseFrequencies();
<a name="l01597"></a>01597       <span class="keywordflow">for</span> (itr = clauseFrequencies-&gt;begin();
<a name="l01598"></a>01598            itr != clauseFrequencies-&gt;end(); itr++)
<a name="l01599"></a>01599       {
<a name="l01600"></a>01600         <span class="keywordtype">int</span> clauseno = itr-&gt;first;
<a name="l01601"></a>01601         <span class="keywordtype">int</span> frequency = itr-&gt;second;
<a name="l01602"></a>01602         numGndings[clauseno] += frequency;
<a name="l01603"></a>01603       }
<a name="l01604"></a>01604     }
<a name="l01605"></a>01605   }
<a name="l01606"></a>01606 
<a name="l01613"></a><a class="code" href="classVariableState.html#51328d98874eae61096c94b6626f14df">01613</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#51328d98874eae61096c94b6626f14df">setOthersInBlockToFalse</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; atomIdx,
<a name="l01614"></a>01614                                <span class="keyword">const</span> <span class="keywordtype">int</span>&amp; blockIdx)
<a name="l01615"></a>01615   {
<a name="l01616"></a>01616     <a class="code" href="classArray.html">Array&lt;int&gt;</a>&amp; block = (*blocks_)[blockIdx];
<a name="l01617"></a>01617     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; block.<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>(); i++)
<a name="l01618"></a>01618     {
<a name="l01619"></a>01619         <span class="comment">// Atom not the one specified and not fixed</span>
<a name="l01620"></a>01620       <span class="keywordflow">if</span> (i != atomIdx &amp;&amp; fixedAtom_[block[i] + 1] == 0)
<a name="l01621"></a>01621         <a class="code" href="classVariableState.html#5ca24c889ca9ea4ec1ad6fa64b59e348">setValueOfAtom</a>(block[i] + 1, <span class="keyword">false</span>);
<a name="l01622"></a>01622     }
<a name="l01623"></a>01623   }
<a name="l01624"></a>01624 
<a name="l01625"></a>01625 
<a name="l01634"></a><a class="code" href="classVariableState.html#7929d260582cb7cc66fc7af5eb7c359b">01634</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#7929d260582cb7cc66fc7af5eb7c359b">fixAtom</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; atomIdx, <span class="keyword">const</span> <span class="keywordtype">bool</span>&amp; value)
<a name="l01635"></a>01635   {
<a name="l01636"></a>01636     assert(atomIdx &gt; 0);
<a name="l01637"></a>01637       <span class="comment">// If already fixed to opp. sense, then contradiction</span>
<a name="l01638"></a>01638     <span class="keywordflow">if</span> ((fixedAtom_[atomIdx] == 1 &amp;&amp; value == <span class="keyword">false</span>) ||
<a name="l01639"></a>01639         (fixedAtom_[atomIdx] == -1 &amp;&amp; value == <span class="keyword">true</span>))
<a name="l01640"></a>01640     {
<a name="l01641"></a>01641       cout &lt;&lt; <span class="stringliteral">"Contradiction: Tried to fix atom "</span> &lt;&lt; atomIdx &lt;&lt;
<a name="l01642"></a>01642       <span class="stringliteral">" to true and false ... exiting."</span> &lt;&lt; endl;
<a name="l01643"></a>01643       exit(0);
<a name="l01644"></a>01644     }
<a name="l01645"></a>01645 
<a name="l01646"></a>01646     <span class="keywordflow">if</span> (vsdebug)
<a name="l01647"></a>01647     {
<a name="l01648"></a>01648       cout &lt;&lt; <span class="stringliteral">"Fixing "</span>;
<a name="l01649"></a>01649       (*gndPreds_)[atomIdx - 1]-&gt;print(cout, domain_);
<a name="l01650"></a>01650       cout &lt;&lt; <span class="stringliteral">" to "</span> &lt;&lt; value &lt;&lt; endl;
<a name="l01651"></a>01651     }
<a name="l01652"></a>01652     
<a name="l01653"></a>01653     <a class="code" href="classVariableState.html#5ca24c889ca9ea4ec1ad6fa64b59e348">setValueOfAtom</a>(atomIdx, value);
<a name="l01654"></a>01654     fixedAtom_[atomIdx] = (value) ? 1 : -1;
<a name="l01655"></a>01655   }
<a name="l01656"></a>01656 
<a name="l01668"></a><a class="code" href="classVariableState.html#b80a4267b5c2ea04a786b5dd4c23d879">01668</a>   <a class="code" href="classArray.html">Array&lt;int&gt;</a>* <a class="code" href="classVariableState.html#b80a4267b5c2ea04a786b5dd4c23d879">simplifyClauseFromFixedAtoms</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; clauseIdx)
<a name="l01669"></a>01669   {
<a name="l01670"></a>01670     <a class="code" href="classArray.html">Array&lt;int&gt;</a>* returnArray = <span class="keyword">new</span> <a class="code" href="classArray.html">Array&lt;int&gt;</a>;
<a name="l01671"></a>01671       <span class="comment">// If already satisfied from fixed atoms, then return empty array</span>
<a name="l01672"></a>01672     <span class="keywordflow">if</span> (isSatisfied_[clauseIdx]) <span class="keywordflow">return</span> returnArray;
<a name="l01673"></a>01673 
<a name="l01674"></a>01674       <span class="comment">// Keeps track of pos. clause being satisfied or </span>
<a name="l01675"></a>01675       <span class="comment">// neg. clause being unsatisfied due to fixed atoms</span>
<a name="l01676"></a>01676     <span class="keywordtype">bool</span> isGood = (clauseCost_[clauseIdx] &gt; 0) ? <span class="keyword">false</span> : <span class="keyword">true</span>;
<a name="l01677"></a>01677       <span class="comment">// Keeps track of all atoms being fixed to false in a pos. clause</span>
<a name="l01678"></a>01678     <span class="keywordtype">bool</span> allFalseAtoms = (clauseCost_[clauseIdx] &gt; 0) ? <span class="keyword">true</span> : <span class="keyword">false</span>;
<a name="l01679"></a>01679       <span class="comment">// Check each literal in clause</span>
<a name="l01680"></a>01680     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classVariableState.html#12d6e101244182a1962c99cc016f4b78">getClauseSize</a>(clauseIdx); i++)
<a name="l01681"></a>01681     {
<a name="l01682"></a>01682       <span class="keywordtype">int</span> lit = clause_[clauseIdx][i];
<a name="l01683"></a>01683       <span class="keywordtype">int</span> fixedValue = fixedAtom_[abs(lit)];
<a name="l01684"></a>01684 
<a name="l01685"></a>01685       <span class="keywordflow">if</span> (clauseCost_[clauseIdx] &gt; 0)
<a name="l01686"></a>01686       { <span class="comment">// Pos. clause: check if clause is satisfied</span>
<a name="l01687"></a>01687         <span class="keywordflow">if</span> ((fixedValue == 1 &amp;&amp; lit &gt; 0) ||
<a name="l01688"></a>01688             (fixedValue == -1 &amp;&amp; lit &lt; 0))
<a name="l01689"></a>01689         { <span class="comment">// True fixed lit</span>
<a name="l01690"></a>01690           isGood = <span class="keyword">true</span>;
<a name="l01691"></a>01691           allFalseAtoms = <span class="keyword">false</span>;
<a name="l01692"></a>01692           returnArray-&gt;<a class="code" href="classArray.html#732046291e31f830757e0847280fb593">clear</a>();
<a name="l01693"></a>01693           <span class="keywordflow">break</span>;
<a name="l01694"></a>01694         }
<a name="l01695"></a>01695         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fixedValue == 0)
<a name="l01696"></a>01696         { <span class="comment">// Lit not fixed</span>
<a name="l01697"></a>01697           allFalseAtoms = <span class="keyword">false</span>;
<a name="l01698"></a>01698           returnArray-&gt;<a class="code" href="classArray.html#752db599431d93ee14c5b0f7b05ba03a">append</a>(lit);
<a name="l01699"></a>01699         }
<a name="l01700"></a>01700       }
<a name="l01701"></a>01701       <span class="keywordflow">else</span>
<a name="l01702"></a>01702       { <span class="comment">// Neg. clause:</span>
<a name="l01703"></a>01703         assert(clauseCost_[clauseIdx] &lt; 0);
<a name="l01704"></a>01704         <span class="keywordflow">if</span> ((fixedValue == 1 &amp;&amp; lit &gt; 0) ||
<a name="l01705"></a>01705             (fixedValue == -1 &amp;&amp; lit &lt; 0))
<a name="l01706"></a>01706         { <span class="comment">// True fixed lit</span>
<a name="l01707"></a>01707           cout &lt;&lt; <span class="stringliteral">"Contradiction: Tried to fix atom "</span> &lt;&lt; abs(lit) &lt;&lt;
<a name="l01708"></a>01708           <span class="stringliteral">" to true in a negative clause ... exiting."</span> &lt;&lt; endl;
<a name="l01709"></a>01709           exit(0);
<a name="l01710"></a>01710         }
<a name="l01711"></a>01711         <span class="keywordflow">else</span>
<a name="l01712"></a>01712         { <span class="comment">// False fixed lit or non-fixed lit</span>
<a name="l01713"></a>01713           returnArray-&gt;<a class="code" href="classArray.html#752db599431d93ee14c5b0f7b05ba03a">append</a>(lit);
<a name="l01714"></a>01714             <span class="comment">// Non-fixed lit</span>
<a name="l01715"></a>01715           <span class="keywordflow">if</span> (fixedValue == 0) isGood = <span class="keyword">false</span>;          
<a name="l01716"></a>01716         }
<a name="l01717"></a>01717       }
<a name="l01718"></a>01718     }
<a name="l01719"></a>01719     <span class="keywordflow">if</span> (allFalseAtoms)
<a name="l01720"></a>01720     {
<a name="l01721"></a>01721       cout &lt;&lt; <span class="stringliteral">"Contradiction: All atoms in clause "</span> &lt;&lt; clauseIdx &lt;&lt;
<a name="l01722"></a>01722       <span class="stringliteral">" fixed to false ... exiting."</span> &lt;&lt; endl;
<a name="l01723"></a>01723       exit(0);
<a name="l01724"></a>01724     }
<a name="l01725"></a>01725     <span class="keywordflow">if</span> (isGood) isSatisfied_[clauseIdx] = <span class="keyword">true</span>;
<a name="l01726"></a>01726     <span class="keywordflow">return</span> returnArray;
<a name="l01727"></a>01727   }
<a name="l01728"></a>01728 
<a name="l01735"></a><a class="code" href="classVariableState.html#127a243149f859dab21fcfd8279c29ad">01735</a>   <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="classVariableState.html#127a243149f859dab21fcfd8279c29ad">isDeadClause</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; clauseIdx)
<a name="l01736"></a>01736   {
<a name="l01737"></a>01737     <span class="keywordflow">return</span> deadClause_[clauseIdx];
<a name="l01738"></a>01738   }
<a name="l01739"></a>01739 
<a name="l01743"></a><a class="code" href="classVariableState.html#1b8fca3de746960f83057feea8cbaeb3">01743</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#1b8fca3de746960f83057feea8cbaeb3">eliminateSoftClauses</a>()
<a name="l01744"></a>01744   {
<a name="l01745"></a>01745     <span class="keywordtype">bool</span> atLeastOneDead = <span class="keyword">false</span>;
<a name="l01746"></a>01746     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classVariableState.html#703e262481d6c0b076799511af07df67">getNumClauses</a>(); i++)
<a name="l01747"></a>01747     {
<a name="l01748"></a>01748       <span class="keywordflow">if</span> (!(*gndClauses_)[i]-&gt;isHardClause())
<a name="l01749"></a>01749       {
<a name="l01750"></a>01750         atLeastOneDead = <span class="keyword">true</span>;
<a name="l01751"></a>01751         deadClause_[i] = <span class="keyword">true</span>;
<a name="l01752"></a>01752       }
<a name="l01753"></a>01753     }
<a name="l01754"></a>01754     <span class="keywordflow">if</span> (atLeastOneDead) <a class="code" href="classVariableState.html#2c53e96f2f2f3ed8978fae90a7daad36">initMakeBreakCostWatch</a>();
<a name="l01755"></a>01755   }
<a name="l01756"></a>01756  
<a name="l01764"></a><a class="code" href="classVariableState.html#4e30712524da7ecb7b450b98155dd717">01764</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#4e30712524da7ecb7b450b98155dd717">killClauses</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; startClause)
<a name="l01765"></a>01765   {
<a name="l01766"></a>01766     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = startClause; i &lt; <a class="code" href="classVariableState.html#703e262481d6c0b076799511af07df67">getNumClauses</a>(); i++)
<a name="l01767"></a>01767     {
<a name="l01768"></a>01768       <a class="code" href="classGroundClause.html">GroundClause</a>* clause = (*gndClauses_)[i];
<a name="l01769"></a>01769       <span class="keywordflow">if</span> ((<a class="code" href="classVariableState.html#e337445a944f87ab57d255fcf7fee119">clauseGoodInPrevious</a>(i)) &amp;&amp;
<a name="l01770"></a>01770           (clause-&gt;isHardClause() || random() &lt;= threshold_[i]))
<a name="l01771"></a>01771       {
<a name="l01772"></a>01772         <span class="keywordflow">if</span> (vsdebug)
<a name="l01773"></a>01773         {
<a name="l01774"></a>01774           cout &lt;&lt; <span class="stringliteral">"Keeping clause "</span>&lt;&lt; i &lt;&lt; <span class="stringliteral">" "</span>;
<a name="l01775"></a>01775           clause-&gt;print(cout, domain_, &amp;gndPredHashArray_);
<a name="l01776"></a>01776           cout &lt;&lt; endl;
<a name="l01777"></a>01777         }
<a name="l01778"></a>01778         deadClause_[i] = <span class="keyword">false</span>;
<a name="l01779"></a>01779       }
<a name="l01780"></a>01780       <span class="keywordflow">else</span>
<a name="l01781"></a>01781       {
<a name="l01782"></a>01782         deadClause_[i] = <span class="keyword">true</span>;
<a name="l01783"></a>01783       }
<a name="l01784"></a>01784     }
<a name="l01785"></a>01785     <a class="code" href="classVariableState.html#2c53e96f2f2f3ed8978fae90a7daad36">initMakeBreakCostWatch</a>();
<a name="l01786"></a>01786   }
<a name="l01787"></a>01787 
<a name="l01788"></a>01788   
<a name="l01796"></a><a class="code" href="classVariableState.html#e337445a944f87ab57d255fcf7fee119">01796</a>   <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="classVariableState.html#e337445a944f87ab57d255fcf7fee119">clauseGoodInPrevious</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; clauseIdx)
<a name="l01797"></a>01797   {
<a name="l01798"></a>01798     <span class="comment">//GroundClause* clause = (*gndClauses_)[clauseIdx];</span>
<a name="l01799"></a>01799     <span class="keywordtype">int</span> numSatLits = numTrueLits_[clauseIdx];
<a name="l01800"></a>01800       <span class="comment">// Num. of satisfied lits in previous iteration is stored in clause</span>
<a name="l01801"></a>01801     <span class="keywordflow">if</span> ((numSatLits &gt; 0 &amp;&amp; clauseCost_[clauseIdx] &gt; 0.0) ||
<a name="l01802"></a>01802         (numSatLits == 0 &amp;&amp; clauseCost_[clauseIdx] &lt; 0.0))
<a name="l01803"></a>01803       <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01804"></a>01804     <span class="keywordflow">else</span>
<a name="l01805"></a>01805       <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01806"></a>01806   }
<a name="l01807"></a>01807 
<a name="l01811"></a><a class="code" href="classVariableState.html#350c294f81bd00d994fe92b1ed8f0f6f">01811</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#350c294f81bd00d994fe92b1ed8f0f6f">resetDeadClauses</a>()
<a name="l01812"></a>01812   {
<a name="l01813"></a>01813     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; deadClause_.<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>(); i++)
<a name="l01814"></a>01814       deadClause_[i] = <span class="keyword">false</span>;
<a name="l01815"></a>01815     <a class="code" href="classVariableState.html#2c53e96f2f2f3ed8978fae90a7daad36">initMakeBreakCostWatch</a>();
<a name="l01816"></a>01816   }
<a name="l01817"></a>01817    
<a name="l01821"></a><a class="code" href="classVariableState.html#b2cb3ec1d58399e4f4ae544c504a6a20">01821</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#b2cb3ec1d58399e4f4ae544c504a6a20">resetFixedAtoms</a>()
<a name="l01822"></a>01822   {
<a name="l01823"></a>01823     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; fixedAtom_.<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>(); i++)
<a name="l01824"></a>01824       fixedAtom_[i] = 0;
<a name="l01825"></a>01825     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; isSatisfied_.<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>(); i++)
<a name="l01826"></a>01826       isSatisfied_[i] = <span class="keyword">false</span>;
<a name="l01827"></a>01827   }
<a name="l01828"></a>01828 
<a name="l01829"></a><a class="code" href="classVariableState.html#f23af662926e90cbf33b464dc00f18f0">01829</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#f23af662926e90cbf33b464dc00f18f0">setLazy</a>(<span class="keyword">const</span> <span class="keywordtype">bool</span>&amp; l) { lazy_ = l; }
<a name="l01830"></a><a class="code" href="classVariableState.html#0aa423d45e9a45d43fc45f76dcc7d965">01830</a>   <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="classVariableState.html#0aa423d45e9a45d43fc45f76dcc7d965">getLazy</a>() { <span class="keywordflow">return</span> lazy_; }
<a name="l01831"></a>01831 
<a name="l01832"></a><a class="code" href="classVariableState.html#eb3f62075b6a1af215b73df383c55e3a">01832</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#eb3f62075b6a1af215b73df383c55e3a">setUseThreshold</a>(<span class="keyword">const</span> <span class="keywordtype">bool</span>&amp; t) { useThreshold_ = t;}
<a name="l01833"></a><a class="code" href="classVariableState.html#53751af94ce5cd468ff4c53b75c38881">01833</a>   <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="classVariableState.html#53751af94ce5cd468ff4c53b75c38881">getUseThreshold</a>() { <span class="keywordflow">return</span> useThreshold_; }
<a name="l01834"></a>01834   
<a name="l01835"></a><a class="code" href="classVariableState.html#43a78105492c54fca8826edca9d12e18">01835</a>   <span class="keywordtype">long</span> <span class="keywordtype">double</span> <a class="code" href="classVariableState.html#43a78105492c54fca8826edca9d12e18">getHardWt</a>() { <span class="keywordflow">return</span> hardWt_; }
<a name="l01836"></a>01836   
<a name="l01837"></a><a class="code" href="classVariableState.html#0194e4cbd37bc1b5a7eb8807bfac7439">01837</a>   <span class="keyword">const</span> <a class="code" href="classDomain.html">Domain</a>* <a class="code" href="classVariableState.html#0194e4cbd37bc1b5a7eb8807bfac7439">getDomain</a>() { <span class="keywordflow">return</span> domain_; }
<a name="l01838"></a>01838 
<a name="l01839"></a><a class="code" href="classVariableState.html#1548f0738dfae172390bd766aae71fdd">01839</a>   <span class="keyword">const</span> <a class="code" href="classMLN.html">MLN</a>* <a class="code" href="classVariableState.html#1548f0738dfae172390bd766aae71fdd">getMLN</a>() { <span class="keywordflow">return</span> mln_; }
<a name="l01840"></a>01840 
<a name="l01846"></a><a class="code" href="classVariableState.html#0abdaf7a4b916cfc61907f09b68710c8">01846</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#0abdaf7a4b916cfc61907f09b68710c8">printLowState</a>(ostream&amp; out)
<a name="l01847"></a>01847   {
<a name="l01848"></a>01848     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classVariableState.html#bc520a99648ee29ef9447b86c26d9faf">getNumAtoms</a>(); i++)
<a name="l01849"></a>01849     {
<a name="l01850"></a>01850       (*gndPreds_)[i]-&gt;print(out, domain_);
<a name="l01851"></a>01851       out &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; lowAtom_[i + 1] &lt;&lt; endl;
<a name="l01852"></a>01852     }
<a name="l01853"></a>01853   }
<a name="l01854"></a>01854 
<a name="l01861"></a><a class="code" href="classVariableState.html#2229f05fc17e02a969a178c9a2fe708c">01861</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#2229f05fc17e02a969a178c9a2fe708c">printGndPred</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; predIndex, ostream&amp; out)
<a name="l01862"></a>01862   {
<a name="l01863"></a>01863     (*gndPreds_)[predIndex]-&gt;print(out, domain_);
<a name="l01864"></a>01864   }
<a name="l01865"></a>01865 
<a name="l01872"></a><a class="code" href="classVariableState.html#e6903cc7c8abc7f43fa2f72e81dd0b94">01872</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#e6903cc7c8abc7f43fa2f72e81dd0b94">getTruePreds</a>(vector&lt;string&gt;&amp; truePreds)
<a name="l01873"></a>01873   {
<a name="l01874"></a>01874     truePreds.clear();
<a name="l01875"></a>01875     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classVariableState.html#bc520a99648ee29ef9447b86c26d9faf">getNumAtoms</a>(); i++)
<a name="l01876"></a>01876     {
<a name="l01877"></a>01877       <span class="keywordflow">if</span> (<a class="code" href="classVariableState.html#73ac1309ad13b2e21ff4904cb835610e">getValueOfLowAtom</a>(i + 1))
<a name="l01878"></a>01878       {
<a name="l01879"></a>01879         ostringstream oss(ostringstream::out);
<a name="l01880"></a>01880         <a class="code" href="classVariableState.html#2229f05fc17e02a969a178c9a2fe708c">printGndPred</a>(i, oss);
<a name="l01881"></a>01881         truePreds.push_back(oss.str());
<a name="l01882"></a>01882       }
<a name="l01883"></a>01883     }
<a name="l01884"></a>01884   }
<a name="l01885"></a>01885 
<a name="l01896"></a><a class="code" href="classVariableState.html#b097423bddeaf431723ade2b990c10ce">01896</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#b097423bddeaf431723ade2b990c10ce">setAsEvidence</a>(<span class="keyword">const</span> <a class="code" href="classGroundPredicate.html">GroundPredicate</a>* <span class="keyword">const</span> &amp; predicate,
<a name="l01897"></a>01897                      <span class="keyword">const</span> <span class="keywordtype">bool</span>&amp; trueEvidence)
<a name="l01898"></a>01898   {
<a name="l01899"></a>01899     <span class="keywordflow">if</span> (vsdebug)
<a name="l01900"></a>01900     {
<a name="l01901"></a>01901       cout &lt;&lt; <span class="stringliteral">"Setting to evidence "</span> ;
<a name="l01902"></a>01902       predicate-&gt;<a class="code" href="classGroundPredicate.html#d8291702c56dbceed35016b052f38f38">print</a>(cout, domain_);
<a name="l01903"></a>01903       cout &lt;&lt; endl;
<a name="l01904"></a>01904     }
<a name="l01905"></a>01905     <a class="code" href="classDatabase.html">Database</a>* db = domain_-&gt;<a class="code" href="classDomain.html#732940c3a6c4064099aaf353513b553f">getDB</a>();
<a name="l01906"></a>01906     <span class="keywordtype">int</span> atomIdx = gndPredHashArray_.<a class="code" href="classHashArray.html#3a29d73618fa8d216ca8342b6b1bac89">find</a>((<a class="code" href="classGroundPredicate.html">GroundPredicate</a>*)predicate);
<a name="l01907"></a>01907       <span class="comment">// If already evidence, then check its truth value</span>
<a name="l01908"></a>01908     <span class="keywordflow">if</span> (atomIdx &lt;= 0)
<a name="l01909"></a>01909     {
<a name="l01910"></a>01910         <span class="comment">// If predicate already evidence with same truth value, then do nothing</span>
<a name="l01911"></a>01911       <span class="keywordflow">if</span> (db-&gt;<a class="code" href="classDatabase.html#599fbc0b7e396c424f747a4c8bedd25e">getValue</a>(predicate) == trueEvidence)
<a name="l01912"></a>01912         <span class="keywordflow">return</span>;
<a name="l01913"></a>01913         
<a name="l01914"></a>01914         <span class="comment">// Changing truth value of evidence</span>
<a name="l01915"></a>01915       <span class="keywordflow">if</span> (trueEvidence)
<a name="l01916"></a>01916         db-&gt;<a class="code" href="classDatabase.html#55bde3da38b3b555e9897d860dfff500">setValue</a>(predicate, TRUE);
<a name="l01917"></a>01917       <span class="keywordflow">else</span>
<a name="l01918"></a>01918         db-&gt;<a class="code" href="classDatabase.html#55bde3da38b3b555e9897d860dfff500">setValue</a>(predicate, FALSE);
<a name="l01919"></a>01919     }
<a name="l01920"></a>01920     <span class="keywordflow">else</span>
<a name="l01921"></a>01921     {
<a name="l01922"></a>01922       <a class="code" href="classArray.html">Array&lt;int&gt;</a> gndClauseIndexes;      
<a name="l01923"></a>01923       gndClauseIndexes = <a class="code" href="classVariableState.html#97f47d59c8ce2f05e2e32c52cadd87c4">getNegOccurenceArray</a>(atomIdx + 1);
<a name="l01924"></a>01924       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; gndClauseIndexes.<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>(); i++)
<a name="l01925"></a>01925       {
<a name="l01926"></a>01926           <span class="comment">// Atom appears neg. in these clauses, so remove the atom from</span>
<a name="l01927"></a>01927           <span class="comment">// these clauses if true evidence, or remove clause if false evidence</span>
<a name="l01928"></a>01928           <span class="comment">// or a unit clause</span>
<a name="l01929"></a>01929         <span class="keywordflow">if</span> (!trueEvidence ||
<a name="l01930"></a>01930             (*gndClauses_)[gndClauseIndexes[i]]-&gt;getNumGroundPredicates() == 1)
<a name="l01931"></a>01931         {          
<a name="l01932"></a>01932           <span class="keywordflow">if</span> (vsdebug)
<a name="l01933"></a>01933             cout &lt;&lt; <span class="stringliteral">"Deleting ground clause "</span> &lt;&lt; gndClauseIndexes[i] &lt;&lt; endl;
<a name="l01934"></a>01934           <span class="keyword">delete</span> (*gndClauses_)[gndClauseIndexes[i]];
<a name="l01935"></a>01935           (*gndClauses_)[gndClauseIndexes[i]] = NULL;
<a name="l01936"></a>01936         }
<a name="l01937"></a>01937         <span class="keywordflow">else</span>
<a name="l01938"></a>01938         {
<a name="l01939"></a>01939           <span class="keywordflow">if</span> (vsdebug)
<a name="l01940"></a>01940           {
<a name="l01941"></a>01941             cout &lt;&lt; <span class="stringliteral">"Removing gnd pred "</span> &lt;&lt; -(atomIdx + 1)
<a name="l01942"></a>01942                  &lt;&lt; <span class="stringliteral">" from ground clause "</span> &lt;&lt; gndClauseIndexes[i] &lt;&lt; endl;
<a name="l01943"></a>01943           }
<a name="l01944"></a>01944           (*gndClauses_)[gndClauseIndexes[i]]-&gt;removeGndPred(-(atomIdx + 1));
<a name="l01945"></a>01945         }
<a name="l01946"></a>01946       }
<a name="l01947"></a>01947 
<a name="l01948"></a>01948       gndClauseIndexes = <a class="code" href="classVariableState.html#472841bdbf016395d0c6a8fc43f220ff">getPosOccurenceArray</a>(atomIdx + 1);
<a name="l01949"></a>01949       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; gndClauseIndexes.<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>(); i++)
<a name="l01950"></a>01950       {
<a name="l01951"></a>01951           <span class="comment">// Atom appears pos. in these clauses, so remove the atom from</span>
<a name="l01952"></a>01952           <span class="comment">// these clauses if false evidence, or remove clause if true evidence</span>
<a name="l01953"></a>01953           <span class="comment">// or a unit clause</span>
<a name="l01954"></a>01954         <span class="keywordflow">if</span> (trueEvidence ||
<a name="l01955"></a>01955             (*gndClauses_)[gndClauseIndexes[i]]-&gt;getNumGroundPredicates() == 1)
<a name="l01956"></a>01956         {
<a name="l01957"></a>01957           <span class="keywordflow">if</span> (vsdebug)
<a name="l01958"></a>01958             cout &lt;&lt; <span class="stringliteral">"Deleting ground clause "</span> &lt;&lt; gndClauseIndexes[i] &lt;&lt; endl;
<a name="l01959"></a>01959           <span class="keyword">delete</span> (*gndClauses_)[gndClauseIndexes[i]];
<a name="l01960"></a>01960           (*gndClauses_)[gndClauseIndexes[i]] = NULL;
<a name="l01961"></a>01961         }
<a name="l01962"></a>01962         <span class="keywordflow">else</span>
<a name="l01963"></a>01963         {
<a name="l01964"></a>01964           <span class="keywordflow">if</span> (vsdebug)
<a name="l01965"></a>01965           {
<a name="l01966"></a>01966             cout &lt;&lt; <span class="stringliteral">"Removing gnd pred "</span> &lt;&lt; -(atomIdx + 1)
<a name="l01967"></a>01967                  &lt;&lt; <span class="stringliteral">" from ground clause "</span> &lt;&lt; gndClauseIndexes[i] &lt;&lt; endl;
<a name="l01968"></a>01968           }
<a name="l01969"></a>01969           (*gndClauses_)[gndClauseIndexes[i]]-&gt;removeGndPred(atomIdx + 1);
<a name="l01970"></a>01970         }
<a name="l01971"></a>01971       }
<a name="l01972"></a>01972       
<a name="l01973"></a>01973       gndPredHashArray_.<a class="code" href="classHashArray.html#e5e111447c99c8bec8dcb007e9b7816b">removeItemFastDisorder</a>(atomIdx);
<a name="l01974"></a>01974       gndPredHashArray_.<a class="code" href="classHashArray.html#e113aa6f71b16def86aa32bbc2fee334">compress</a>();
<a name="l01975"></a>01975       gndPreds_-&gt;<a class="code" href="classArray.html#f3a485906b00ac44e39f0d402bd09512">removeItemFastDisorder</a>(atomIdx);
<a name="l01976"></a>01976       gndPreds_-&gt;<a class="code" href="classArray.html#d076eab62161d62c67aadebcc71e5cb2">compress</a>();
<a name="l01977"></a>01977         <span class="comment">// By removing a pred, the pred at the end of the array gets the</span>
<a name="l01978"></a>01978         <span class="comment">// index of the pred deleted, so we have to update to the new index</span>
<a name="l01979"></a>01979         <span class="comment">// in all clauses</span>
<a name="l01980"></a>01980       <span class="keywordtype">int</span> oldIdx = gndPredHashArray_.<a class="code" href="classHashArray.html#ccdf0d4f7188821cd872b1618312fbd0">size</a>();
<a name="l01981"></a>01981       replaceAtomIndexInAllClauses(oldIdx, atomIdx);      
<a name="l01982"></a>01982       gndClauses_-&gt;<a class="code" href="classArray.html#9b58ce1b5d1283b76e2f11de7bf96657">removeAllNull</a>();
<a name="l01983"></a>01983     }
<a name="l01984"></a>01984   }
<a name="l01985"></a>01985 
<a name="l01994"></a><a class="code" href="classVariableState.html#dfe0128b21fb28fcfd5a2796bc17eced">01994</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#dfe0128b21fb28fcfd5a2796bc17eced">setAsQuery</a>(<span class="keyword">const</span> <a class="code" href="classGroundPredicate.html">GroundPredicate</a>* <span class="keyword">const</span> &amp; predicate)
<a name="l01995"></a>01995   {
<a name="l01996"></a>01996     <span class="keywordflow">if</span> (vsdebug)
<a name="l01997"></a>01997     {
<a name="l01998"></a>01998       cout &lt;&lt; <span class="stringliteral">"Setting to query "</span> ;
<a name="l01999"></a>01999       predicate-&gt;<a class="code" href="classGroundPredicate.html#d8291702c56dbceed35016b052f38f38">print</a>(cout, domain_);
<a name="l02000"></a>02000       cout &lt;&lt; endl;
<a name="l02001"></a>02001     }
<a name="l02002"></a>02002     <a class="code" href="classDatabase.html">Database</a>* db = domain_-&gt;<a class="code" href="classDomain.html#732940c3a6c4064099aaf353513b553f">getDB</a>();
<a name="l02003"></a>02003       <span class="comment">// If already non-evidence, then do nothing</span>
<a name="l02004"></a>02004     <span class="keywordflow">if</span> (gndPredHashArray_.<a class="code" href="classHashArray.html#7ef36132544b3d97362a9216a0e04c87">contains</a>((<a class="code" href="classGroundPredicate.html">GroundPredicate</a>*)predicate))
<a name="l02005"></a>02005       <span class="keywordflow">return</span>;
<a name="l02006"></a>02006     <span class="keywordflow">else</span>
<a name="l02007"></a>02007     {
<a name="l02008"></a>02008         <span class="comment">// Evidence -&gt; query</span>
<a name="l02009"></a>02009         <span class="comment">// Add predicate to query set and get clauses</span>
<a name="l02010"></a>02010       gndPredHashArray_.<a class="code" href="classHashArray.html#5b55b617cd22fd9e0557de4d15a608be">append</a>((<a class="code" href="classGroundPredicate.html">GroundPredicate</a>*)predicate);
<a name="l02011"></a>02011       <a class="code" href="classPredicate.html">Predicate</a>* p = predicate-&gt;createEquivalentPredicate(domain_);
<a name="l02012"></a>02012       db-&gt;<a class="code" href="classDatabase.html#03711a23747b17d9465cd5d443900f21">setEvidenceStatus</a>(p, <span class="keyword">false</span>);
<a name="l02013"></a>02013       <span class="keywordtype">bool</span> ignoreActivePreds = <span class="keyword">true</span>;
<a name="l02014"></a>02014       <a class="code" href="classVariableState.html#1944a7ef1d312dab635ad19801ba13f7">getActiveClauses</a>(p, newClauses_, <span class="keyword">true</span>, ignoreActivePreds);
<a name="l02015"></a>02015     }
<a name="l02016"></a>02016   }
<a name="l02017"></a>02017 
<a name="l02019"></a>02019   
<a name="l02026"></a><a class="code" href="classVariableState.html#e25d7b335279bab8def1c7ed12d29ffa">02026</a>   <a class="code" href="classGroundPredicate.html">GroundPredicate</a>* <a class="code" href="classVariableState.html#e25d7b335279bab8def1c7ed12d29ffa">getGndPred</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; index)
<a name="l02027"></a>02027   {
<a name="l02028"></a>02028     <span class="keywordflow">return</span> (*gndPreds_)[index];
<a name="l02029"></a>02029   }
<a name="l02030"></a>02030 
<a name="l02037"></a><a class="code" href="classVariableState.html#cfd4c00140b2adacfe5113d35b79f71d">02037</a>   <a class="code" href="classGroundClause.html">GroundClause</a>* <a class="code" href="classVariableState.html#cfd4c00140b2adacfe5113d35b79f71d">getGndClause</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; index)
<a name="l02038"></a>02038   {
<a name="l02039"></a>02039     <span class="keywordflow">return</span> (*gndClauses_)[index];
<a name="l02040"></a>02040   }
<a name="l02041"></a>02041 
<a name="l02045"></a><a class="code" href="classVariableState.html#66d8070da3adc21c6c7b906117712ff0">02045</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#66d8070da3adc21c6c7b906117712ff0">saveLowStateToGndPreds</a>()
<a name="l02046"></a>02046   {
<a name="l02047"></a>02047     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classVariableState.html#bc520a99648ee29ef9447b86c26d9faf">getNumAtoms</a>(); i++)
<a name="l02048"></a>02048       (*gndPreds_)[i]-&gt;setTruthValue(lowAtom_[i + 1]);
<a name="l02049"></a>02049   }
<a name="l02050"></a>02050 
<a name="l02054"></a><a class="code" href="classVariableState.html#90c5cf374c125ced03d93bd827e458b8">02054</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#90c5cf374c125ced03d93bd827e458b8">saveLowStateToDB</a>()
<a name="l02055"></a>02055   {
<a name="l02056"></a>02056     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classVariableState.html#bc520a99648ee29ef9447b86c26d9faf">getNumAtoms</a>(); i++)
<a name="l02057"></a>02057     {
<a name="l02058"></a>02058       <a class="code" href="classGroundPredicate.html">GroundPredicate</a>* p = gndPredHashArray_[i];
<a name="l02059"></a>02059       <span class="keywordtype">bool</span> value = lowAtom_[i + 1];
<a name="l02060"></a>02060       <span class="keywordflow">if</span> (value)
<a name="l02061"></a>02061       {
<a name="l02062"></a>02062         domain_-&gt;<a class="code" href="classDomain.html#732940c3a6c4064099aaf353513b553f">getDB</a>()-&gt;<a class="code" href="classDatabase.html#55bde3da38b3b555e9897d860dfff500">setValue</a>(p, TRUE);
<a name="l02063"></a>02063       }
<a name="l02064"></a>02064       <span class="keywordflow">else</span>
<a name="l02065"></a>02065       {
<a name="l02066"></a>02066         domain_-&gt;<a class="code" href="classDomain.html#732940c3a6c4064099aaf353513b553f">getDB</a>()-&gt;<a class="code" href="classDatabase.html#55bde3da38b3b555e9897d860dfff500">setValue</a>(p, FALSE);
<a name="l02067"></a>02067       }
<a name="l02068"></a>02068     }
<a name="l02069"></a>02069   }
<a name="l02070"></a>02070 
<a name="l02077"></a><a class="code" href="classVariableState.html#df5999e531cf4de1350b46df789e0c81">02077</a>   <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classVariableState.html#df5999e531cf4de1350b46df789e0c81">getGndPredIndex</a>(<a class="code" href="classGroundPredicate.html">GroundPredicate</a>* <span class="keyword">const</span>&amp; gndPred)
<a name="l02078"></a>02078   {
<a name="l02079"></a>02079     <span class="keywordflow">return</span> gndPreds_-&gt;<a class="code" href="classArray.html#e5a7703acd6b54d55cd7c95b68262b09">find</a>(gndPred);
<a name="l02080"></a>02080   }
<a name="l02081"></a>02081 
<a name="l02082"></a>02082      
<a name="l02084"></a>02084 
<a name="l02085"></a>02085 
<a name="l02087"></a>02087  
<a name="l02101"></a><a class="code" href="classVariableState.html#1944a7ef1d312dab635ad19801ba13f7">02101</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#1944a7ef1d312dab635ad19801ba13f7">getActiveClauses</a>(<a class="code" href="classPredicate.html">Predicate</a> *inputPred,
<a name="l02102"></a>02102                         <a class="code" href="classArray.html">Array&lt;GroundClause*&gt;</a>&amp; activeClauses,
<a name="l02103"></a>02103                         <span class="keywordtype">bool</span> <span class="keyword">const</span> &amp; active,
<a name="l02104"></a>02104                         <span class="keywordtype">bool</span> <span class="keyword">const</span> &amp; ignoreActivePreds)
<a name="l02105"></a>02105   {
<a name="l02106"></a>02106     <a class="code" href="classClause.html">Clause</a> *fclause;
<a name="l02107"></a>02107     <a class="code" href="classGroundClause.html">GroundClause</a>* newClause;
<a name="l02108"></a>02108     <span class="keywordtype">int</span> clauseCnt;
<a name="l02109"></a>02109     <a class="code" href="classHashArray.html">GroundClauseHashArray</a> clauseHashArray;
<a name="l02110"></a>02110 
<a name="l02111"></a>02111     <a class="code" href="classArray.html">Array&lt;GroundClause*&gt;</a>* newClauses = <span class="keyword">new</span> <a class="code" href="classArray.html">Array&lt;GroundClause*&gt;</a>; 
<a name="l02112"></a>02112   
<a name="l02113"></a>02113     <span class="keyword">const</span> <a class="code" href="classArray.html">Array&lt;IndexClause*&gt;</a>* indexClauses = NULL;
<a name="l02114"></a>02114       
<a name="l02115"></a>02115       <span class="comment">// inputPred is null: all active clauses should be retrieved</span>
<a name="l02116"></a>02116     <span class="keywordflow">if</span> (inputPred == NULL)
<a name="l02117"></a>02117     {
<a name="l02118"></a>02118       clauseCnt = mln_-&gt;<a class="code" href="classMLN.html#9af698a87c5b518e9ce18755bc414231">getNumClauses</a>();
<a name="l02119"></a>02119     }
<a name="l02120"></a>02120       <span class="comment">// Otherwise, look at all first order clauses containing the pred</span>
<a name="l02121"></a>02121     <span class="keywordflow">else</span>
<a name="l02122"></a>02122     {
<a name="l02123"></a>02123       <span class="keywordflow">if</span> (domain_-&gt;<a class="code" href="classDomain.html#732940c3a6c4064099aaf353513b553f">getDB</a>()-&gt;<a class="code" href="classDatabase.html#1c459bc03d0e73b3d51eafae6b9d5151">getDeactivatedStatus</a>(inputPred)) <span class="keywordflow">return</span>;
<a name="l02124"></a>02124       <span class="keywordtype">int</span> predId = inputPred-&gt;<a class="code" href="classPredicate.html#bf7ace41fac6ed9b6c68bb29a1c95445">getId</a>();
<a name="l02125"></a>02125       indexClauses = mln_-&gt;<a class="code" href="classMLN.html#fe5ab9aa70237fbbfa70541d90619eeb">getClausesContainingPred</a>(predId);
<a name="l02126"></a>02126       clauseCnt = indexClauses-&gt;<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>();
<a name="l02127"></a>02127     }
<a name="l02128"></a>02128 
<a name="l02129"></a>02129       <span class="comment">// Look at each first-order clause and get active groundings</span>
<a name="l02130"></a>02130     <span class="keywordtype">int</span> clauseno = 0;
<a name="l02131"></a>02131     <span class="keywordflow">while</span> (clauseno &lt; clauseCnt)
<a name="l02132"></a>02132     {
<a name="l02133"></a>02133       <span class="keywordflow">if</span> (inputPred)
<a name="l02134"></a>02134         fclause = (<a class="code" href="classClause.html">Clause</a> *) (*indexClauses)[clauseno]-&gt;clause;           
<a name="l02135"></a>02135       <span class="keywordflow">else</span>
<a name="l02136"></a>02136         fclause = (<a class="code" href="classClause.html">Clause</a> *) mln_-&gt;<a class="code" href="classMLN.html#497ce3f0fc49d215ab278a4a285e161e">getClause</a>(clauseno);
<a name="l02137"></a>02137 
<a name="l02138"></a>02138       <span class="keywordflow">if</span> (vsdebug)
<a name="l02139"></a>02139       {
<a name="l02140"></a>02140         cout &lt;&lt; <span class="stringliteral">"Getting active clauses for FO clause: "</span>;
<a name="l02141"></a>02141         fclause-&gt;<a class="code" href="classClause.html#c7ca63adf8f409bb95159f428a2439b7">print</a>(cout, domain_);
<a name="l02142"></a>02142         cout &lt;&lt; endl;
<a name="l02143"></a>02143       }
<a name="l02144"></a>02144       
<a name="l02145"></a>02145       <span class="keywordtype">long</span> <span class="keywordtype">double</span> wt = fclause-&gt;<a class="code" href="classClause.html#e234aafdd6eb6df9db924e254d13f12e">getWt</a>();
<a name="l02146"></a>02146       <span class="keyword">const</span> <span class="keywordtype">double</span>* parentWtPtr = NULL;
<a name="l02147"></a>02147       <span class="keywordflow">if</span> (!fclause-&gt;<a class="code" href="classClause.html#7eb908b452f9e428fc05cc22501c5cb8">isHardClause</a>()) parentWtPtr = fclause-&gt;<a class="code" href="classClause.html#be9f5a3ccd9ec0b6c92ecb26d3e7323e">getWtPtr</a>();
<a name="l02148"></a>02148       <span class="keyword">const</span> <span class="keywordtype">int</span> clauseId = mln_-&gt;<a class="code" href="classMLN.html#e7dd082d7dce234cab11adfc3a83be1a">findClauseIdx</a>(fclause);
<a name="l02149"></a>02149       newClauses-&gt;<a class="code" href="classArray.html#732046291e31f830757e0847280fb593">clear</a>();
<a name="l02150"></a>02150 
<a name="l02151"></a>02151       fclause-&gt;<a class="code" href="classClause.html#e7d9bdbce92ec00ea4fcd71c4106b1d5">getActiveClauses</a>(inputPred, domain_, newClauses,
<a name="l02152"></a>02152                                 &amp;gndPredHashArray_, ignoreActivePreds);
<a name="l02153"></a>02153 
<a name="l02154"></a>02154       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; newClauses-&gt;<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>(); i++)
<a name="l02155"></a>02155       {
<a name="l02156"></a>02156         newClause = (*newClauses)[i];
<a name="l02157"></a>02157         <span class="keywordtype">int</span> pos = clauseHashArray.<a class="code" href="classHashArray.html#3a29d73618fa8d216ca8342b6b1bac89">find</a>(newClause);
<a name="l02158"></a>02158           <span class="comment">// If clause already present, then just add weight</span>
<a name="l02159"></a>02159         <span class="keywordflow">if</span> (pos &gt;= 0)
<a name="l02160"></a>02160         {
<a name="l02161"></a>02161           <span class="keywordflow">if</span> (vsdebug)
<a name="l02162"></a>02162           {
<a name="l02163"></a>02163             cout &lt;&lt; <span class="stringliteral">"Adding weight "</span> &lt;&lt; wt &lt;&lt; <span class="stringliteral">" to clause "</span>;
<a name="l02164"></a>02164             clauseHashArray[pos]-&gt;print(cout, domain_, &amp;gndPredHashArray_);
<a name="l02165"></a>02165             cout &lt;&lt; endl;
<a name="l02166"></a>02166           }
<a name="l02167"></a>02167           clauseHashArray[pos]-&gt;addWt(wt);
<a name="l02168"></a>02168           <span class="keywordflow">if</span> (parentWtPtr)
<a name="l02169"></a>02169           {
<a name="l02170"></a>02170             clauseHashArray[pos]-&gt;appendParentWtPtr(parentWtPtr);
<a name="l02171"></a>02171             clauseHashArray[pos]-&gt;incrementClauseFrequency(clauseId, 1);
<a name="l02172"></a>02172           }
<a name="l02173"></a>02173           <span class="keyword">delete</span> newClause;
<a name="l02174"></a>02174           <span class="keywordflow">continue</span>;
<a name="l02175"></a>02175         }
<a name="l02176"></a>02176 
<a name="l02177"></a>02177           <span class="comment">// If here, then clause is not yet present        </span>
<a name="l02178"></a>02178         newClause-&gt;<a class="code" href="classGroundClause.html#87aa563d0f712f7481ece8b8d7551a47">setWt</a>(wt);
<a name="l02179"></a>02179         newClause-&gt;<a class="code" href="classGroundClause.html#b2bc8fac453a33ecc45d199cf080b7c9">appendToGndPreds</a>(&amp;gndPredHashArray_);
<a name="l02180"></a>02180         <span class="keywordflow">if</span> (parentWtPtr)
<a name="l02181"></a>02181         {
<a name="l02182"></a>02182           newClause-&gt;<a class="code" href="classGroundClause.html#57fa4005be94e9f87517ffced6a36d1b">appendParentWtPtr</a>(parentWtPtr);
<a name="l02183"></a>02183           newClause-&gt;<a class="code" href="classGroundClause.html#5949e09d289c58be8dac58b4e2162e6b">incrementClauseFrequency</a>(clauseId, 1);
<a name="l02184"></a>02184           assert(newClause-&gt;<a class="code" href="classGroundClause.html#7fed23e12512496e45056fbc5e624a23">getWt</a>() == *parentWtPtr);
<a name="l02185"></a>02185         }      
<a name="l02186"></a>02186 
<a name="l02187"></a>02187         <span class="keywordflow">if</span> (vsdebug)
<a name="l02188"></a>02188         {
<a name="l02189"></a>02189           cout &lt;&lt; <span class="stringliteral">"Appending clause "</span>;
<a name="l02190"></a>02190           newClause-&gt;<a class="code" href="classGroundClause.html#5300f9943f0e43994822ca482f7cd5ed">print</a>(cout, domain_, &amp;gndPredHashArray_);
<a name="l02191"></a>02191           cout &lt;&lt; endl;
<a name="l02192"></a>02192         }
<a name="l02193"></a>02193         clauseHashArray.<a class="code" href="classHashArray.html#5b55b617cd22fd9e0557de4d15a608be">append</a>(newClause);
<a name="l02194"></a>02194       }
<a name="l02195"></a>02195       clauseno++; 
<a name="l02196"></a>02196     } <span class="comment">//while (clauseno &lt; clauseCnt)</span>
<a name="l02197"></a>02197 
<a name="l02198"></a>02198     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; clauseHashArray.<a class="code" href="classHashArray.html#ccdf0d4f7188821cd872b1618312fbd0">size</a>(); i++)
<a name="l02199"></a>02199     {
<a name="l02200"></a>02200       newClause = clauseHashArray[i];
<a name="l02201"></a>02201       activeClauses.<a class="code" href="classArray.html#752db599431d93ee14c5b0f7b05ba03a">append</a>(newClause);
<a name="l02202"></a>02202     }
<a name="l02203"></a>02203     <span class="keyword">delete</span> newClauses;
<a name="l02204"></a>02204   }
<a name="l02205"></a>02205 
<a name="l02213"></a><a class="code" href="classVariableState.html#879c6333edb862b00e2a3550fce77e1f">02213</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#1944a7ef1d312dab635ad19801ba13f7">getActiveClauses</a>(<a class="code" href="classArray.html">Array&lt;GroundClause*&gt;</a> &amp;allClauses,
<a name="l02214"></a>02214                         <span class="keywordtype">bool</span> <span class="keyword">const</span> &amp; ignoreActivePreds)
<a name="l02215"></a>02215   {
<a name="l02216"></a>02216     <a class="code" href="classVariableState.html#1944a7ef1d312dab635ad19801ba13f7">getActiveClauses</a>(NULL, allClauses, <span class="keyword">true</span>, ignoreActivePreds);
<a name="l02217"></a>02217   }
<a name="l02218"></a>02218   
<a name="l02219"></a><a class="code" href="classVariableState.html#c8f49252f55ea07378b7efb2cbfeeb32">02219</a>   <span class="keywordtype">int</span> <a class="code" href="classVariableState.html#c8f49252f55ea07378b7efb2cbfeeb32">getNumActiveAtoms</a>()
<a name="l02220"></a>02220   {
<a name="l02221"></a>02221     <span class="keywordflow">return</span> activeAtoms_; 
<a name="l02222"></a>02222   }
<a name="l02223"></a>02223 
<a name="l02228"></a><a class="code" href="classVariableState.html#328560d1ccaecf634090c84a72fb094f">02228</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#328560d1ccaecf634090c84a72fb094f">addOneAtomToEachBlock</a>()
<a name="l02229"></a>02229   {
<a name="l02230"></a>02230     assert(lazy_);
<a name="l02231"></a>02231       <span class="comment">// For each block: select one to set to true</span>
<a name="l02232"></a>02232     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; blocks_-&gt;<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>(); i++)
<a name="l02233"></a>02233     {
<a name="l02234"></a>02234         <span class="comment">// If evidence atom exists, then all others are false</span>
<a name="l02235"></a>02235       <span class="keywordflow">if</span> ((*blockEvidence_)[i])
<a name="l02236"></a>02236       {
<a name="l02237"></a>02237           <span class="comment">// If first argument is -1, then all are set to false</span>
<a name="l02238"></a>02238         <a class="code" href="classVariableState.html#51328d98874eae61096c94b6626f14df">setOthersInBlockToFalse</a>(-1, i);
<a name="l02239"></a>02239         <span class="keywordflow">continue</span>;
<a name="l02240"></a>02240       }
<a name="l02241"></a>02241 
<a name="l02242"></a>02242         <span class="comment">// Assumption is initLazyBlocks has been called</span>
<a name="l02243"></a>02243         <span class="comment">// Pick one ground pred from the block in the domain</span>
<a name="l02244"></a>02244       <span class="keyword">const</span> <a class="code" href="classArray.html">Array&lt;Predicate*&gt;</a>* block = domain_-&gt;<a class="code" href="classDomain.html#36913a072d47f3d22c4550cb1b5feb99">getPredBlock</a>(i);
<a name="l02245"></a>02245 
<a name="l02246"></a>02246       <span class="keywordtype">int</span> chosen = random() % block-&gt;<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>();
<a name="l02247"></a>02247       <a class="code" href="classPredicate.html">Predicate</a>* pred = (*block)[chosen];
<a name="l02248"></a>02248       <a class="code" href="classGroundPredicate.html">GroundPredicate</a>* groundPred = <span class="keyword">new</span> <a class="code" href="classGroundPredicate.html">GroundPredicate</a>(pred);
<a name="l02249"></a>02249 
<a name="l02250"></a>02250         <span class="comment">// If chosen pred is not yet present, then add it, otherwise delete it</span>
<a name="l02251"></a>02251       <span class="keywordtype">int</span> index = gndPredHashArray_.<a class="code" href="classHashArray.html#3a29d73618fa8d216ca8342b6b1bac89">find</a>(groundPred);
<a name="l02252"></a>02252       <span class="keywordflow">if</span> (index &lt; 0)
<a name="l02253"></a>02253       {
<a name="l02254"></a>02254           <span class="comment">// Pred not yet present</span>
<a name="l02255"></a>02255         index = gndPredHashArray_.<a class="code" href="classHashArray.html#5b55b617cd22fd9e0557de4d15a608be">append</a>(groundPred);
<a name="l02256"></a>02256         (*blocks_)[i].append(index);
<a name="l02257"></a>02257         chosen = (*blocks_)[i].size() - 1;
<a name="l02258"></a>02258           <span class="comment">// addNewClauses adds the predicate to the state and updates</span>
<a name="l02259"></a>02259           <span class="comment">// info arrays</span>
<a name="l02260"></a>02260         <span class="keywordtype">bool</span> initial = <span class="keyword">false</span>;
<a name="l02261"></a>02261         <a class="code" href="classVariableState.html#2748a93f222dafedaf7443634e234ddd">addNewClauses</a>(initial);
<a name="l02262"></a>02262       }
<a name="l02263"></a>02263       <span class="keywordflow">else</span>
<a name="l02264"></a>02264       {
<a name="l02265"></a>02265         <span class="keyword">delete</span> groundPred;
<a name="l02266"></a>02266         chosen = (*blocks_)[i].find(index);
<a name="l02267"></a>02267       }
<a name="l02268"></a>02268       <a class="code" href="classVariableState.html#5ca24c889ca9ea4ec1ad6fa64b59e348">setValueOfAtom</a>(index + 1, <span class="keyword">true</span>);
<a name="l02269"></a>02269       <a class="code" href="classVariableState.html#51328d98874eae61096c94b6626f14df">setOthersInBlockToFalse</a>(chosen, i);
<a name="l02270"></a>02270     }
<a name="l02271"></a>02271   }
<a name="l02272"></a>02272 
<a name="l02276"></a><a class="code" href="classVariableState.html#7b3f22000c5ad265858bc34da586b280">02276</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#7b3f22000c5ad265858bc34da586b280">initLazyBlocks</a>()
<a name="l02277"></a>02277   {
<a name="l02278"></a>02278     assert(lazy_);
<a name="l02279"></a>02279     blocks_ = <span class="keyword">new</span> <a class="code" href="classArray.html">Array&lt;Array&lt;int&gt;</a> &gt;;
<a name="l02280"></a>02280     blocks_-&gt;<a class="code" href="classArray.html#a8417f3aab7a56eee773c45173c77626">growToSize</a>(domain_-&gt;<a class="code" href="classDomain.html#1fca2a61f944ae7114b673f73f066019">getNumPredBlocks</a>());
<a name="l02281"></a>02281     blockEvidence_ = <span class="keyword">new</span> <a class="code" href="classArray.html">Array&lt;bool&gt;</a>(*(domain_-&gt;<a class="code" href="classDomain.html#c2fe18b503e404c4127005ffd0c3f2f1">getBlockEvidenceArray</a>()));
<a name="l02282"></a>02282   }
<a name="l02283"></a>02283 
<a name="l02287"></a><a class="code" href="classVariableState.html#d6804e71c36bc1d271ee2b3cbaf81750">02287</a>   <span class="keywordtype">void</span> <a class="code" href="classVariableState.html#d6804e71c36bc1d271ee2b3cbaf81750">fillLazyBlocks</a>()
<a name="l02288"></a>02288   {
<a name="l02289"></a>02289     assert(lazy_);
<a name="l02290"></a>02290     <span class="keyword">const</span> <a class="code" href="classArray.html">Array&lt;Array&lt;Predicate*&gt;</a>*&gt;* blocks = domain_-&gt;<a class="code" href="classDomain.html#5f05770d91e89ddbba841bf79b51a9a4">getPredBlocks</a>();
<a name="l02291"></a>02291     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; blocks-&gt;<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>(); i++)
<a name="l02292"></a>02292     {
<a name="l02293"></a>02293       <span class="keywordflow">if</span> (vsdebug) cout &lt;&lt; <span class="stringliteral">"Block "</span> &lt;&lt; i &lt;&lt; endl;
<a name="l02294"></a>02294       <a class="code" href="classArray.html">Array&lt;Predicate*&gt;</a>* block = (*blocks)[i];
<a name="l02295"></a>02295       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; block-&gt;<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>(); j++)
<a name="l02296"></a>02296       {
<a name="l02297"></a>02297         <a class="code" href="classPredicate.html">Predicate</a>* pred = (*block)[j];
<a name="l02298"></a>02298         <span class="keywordflow">if</span> (vsdebug)
<a name="l02299"></a>02299         {
<a name="l02300"></a>02300           cout &lt;&lt; <span class="stringliteral">"\tPred: "</span>;
<a name="l02301"></a>02301           pred-&gt;printWithStrVar(cout, domain_);
<a name="l02302"></a>02302           cout &lt;&lt; endl;
<a name="l02303"></a>02303         }
<a name="l02304"></a>02304           <span class="comment">// Add all non-evid preds in blocks to the state</span>
<a name="l02305"></a>02305         <span class="keywordflow">if</span> (domain_-&gt;<a class="code" href="classDomain.html#732940c3a6c4064099aaf353513b553f">getDB</a>()-&gt;<a class="code" href="classDatabase.html#dc72bc31bf15a485b7353fa82291dbb9">getEvidenceStatus</a>(pred))
<a name="l02306"></a>02306           <span class="keywordflow">continue</span>;
<a name="l02307"></a>02307         <a class="code" href="classGroundPredicate.html">GroundPredicate</a>* groundPred = <span class="keyword">new</span> <a class="code" href="classGroundPredicate.html">GroundPredicate</a>(pred);
<a name="l02308"></a>02308 
<a name="l02309"></a>02309           <span class="comment">// Add pred if not yet present, otherwise delete it</span>
<a name="l02310"></a>02310         <span class="keywordtype">int</span> index = gndPredHashArray_.<a class="code" href="classHashArray.html#3a29d73618fa8d216ca8342b6b1bac89">find</a>(groundPred);
<a name="l02311"></a>02311         <span class="keywordflow">if</span> (index &lt; 0)
<a name="l02312"></a>02312           index = gndPredHashArray_.<a class="code" href="classHashArray.html#5b55b617cd22fd9e0557de4d15a608be">append</a>(groundPred);
<a name="l02313"></a>02313         <span class="keywordflow">else</span>
<a name="l02314"></a>02314           <span class="keyword">delete</span> groundPred;
<a name="l02315"></a>02315 
<a name="l02316"></a>02316           <span class="comment">// Append the atom to the block if not yet there</span>
<a name="l02317"></a>02317         <span class="keywordflow">if</span> (!(*blocks_)[i].contains(index))
<a name="l02318"></a>02318           (*blocks_)[i].append(index);
<a name="l02319"></a>02319       }
<a name="l02320"></a>02320     }
<a name="l02321"></a>02321       <span class="comment">// addNewClauses adds the predicates to the state and updates info arrays</span>
<a name="l02322"></a>02322     <span class="keywordtype">bool</span> initial = <span class="keyword">true</span>;
<a name="l02323"></a>02323     <a class="code" href="classVariableState.html#2748a93f222dafedaf7443634e234ddd">addNewClauses</a>(initial);
<a name="l02324"></a>02324   }
<a name="l02325"></a>02325 
<a name="l02327"></a>02327 
<a name="l02328"></a>02328   
<a name="l02329"></a>02329  <span class="keyword">private</span>:
<a name="l02330"></a>02330  
<a name="l02336"></a>02336   <span class="keywordtype">void</span> setHardClauseWeight()
<a name="l02337"></a>02337   {
<a name="l02338"></a>02338       <span class="comment">// Soft weights are summed up to determine hard weight</span>
<a name="l02339"></a>02339     <span class="keywordtype">long</span> <span class="keywordtype">double</span> sumSoftWts = 0.0;
<a name="l02340"></a>02340       <span class="comment">// Determine hard clause weight</span>
<a name="l02341"></a>02341     <span class="keywordtype">int</span> clauseCnt = mln_-&gt;<a class="code" href="classMLN.html#9af698a87c5b518e9ce18755bc414231">getNumClauses</a>();    
<a name="l02342"></a>02342       <span class="comment">// Sum up the soft weights of all grounded clauses</span>
<a name="l02343"></a>02343     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; clauseCnt; i++)
<a name="l02344"></a>02344     {
<a name="l02345"></a>02345       <a class="code" href="classClause.html">Clause</a>* fclause = (<a class="code" href="classClause.html">Clause</a> *) mln_-&gt;<a class="code" href="classMLN.html#497ce3f0fc49d215ab278a4a285e161e">getClause</a>(i);
<a name="l02346"></a>02346         <span class="comment">// Skip hard clauses</span>
<a name="l02347"></a>02347       <span class="keywordflow">if</span> (fclause-&gt;isHardClause()) <span class="keywordflow">continue</span>;
<a name="l02348"></a>02348         <span class="comment">// Weight could be negative</span>
<a name="l02349"></a>02349       <span class="keywordtype">long</span> <span class="keywordtype">double</span> wt = abs(fclause-&gt;getWt());
<a name="l02350"></a>02350       <span class="keywordtype">long</span> <span class="keywordtype">double</span> numGndings = fclause-&gt;getNumGroundings(domain_);
<a name="l02351"></a>02351       sumSoftWts += wt*numGndings;
<a name="l02352"></a>02352     }
<a name="l02353"></a>02353     assert(sumSoftWts &gt;= 0);
<a name="l02354"></a>02354       <span class="comment">// Add constant so weight isn't zero if no soft clauses present</span>
<a name="l02355"></a>02355     hardWt_ = sumSoftWts + 10.0;
<a name="l02356"></a>02356     cout &lt;&lt; <span class="stringliteral">"Set hard weight to "</span> &lt;&lt; hardWt_ &lt;&lt; endl;
<a name="l02357"></a>02357   }
<a name="l02358"></a>02358 
<a name="l02366"></a>02366   <span class="keywordtype">void</span> replaceAtomIndexInAllClauses(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; oldIdx, <span class="keyword">const</span> <span class="keywordtype">int</span>&amp; newIdx)
<a name="l02367"></a>02367   {
<a name="l02368"></a>02368     <a class="code" href="classArray.html">Array&lt;int&gt;</a> gndClauseIndexes;
<a name="l02369"></a>02369 
<a name="l02370"></a>02370     gndClauseIndexes = <a class="code" href="classVariableState.html#97f47d59c8ce2f05e2e32c52cadd87c4">getNegOccurenceArray</a>(oldIdx + 1);
<a name="l02371"></a>02371     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; gndClauseIndexes.<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>(); i++)
<a name="l02372"></a>02372     {
<a name="l02373"></a>02373         <span class="comment">// Atom appears neg. in these clauses, so it appears as -(oldIdx + 1)</span>
<a name="l02374"></a>02374       <span class="keywordflow">if</span> ((*gndClauses_)[gndClauseIndexes[i]])
<a name="l02375"></a>02375         (*gndClauses_)[gndClauseIndexes[i]]-&gt;changeGndPredIndex(-(oldIdx + 1),
<a name="l02376"></a>02376                                                                 -(newIdx + 1));
<a name="l02377"></a>02377     }
<a name="l02378"></a>02378 
<a name="l02379"></a>02379     gndClauseIndexes = <a class="code" href="classVariableState.html#472841bdbf016395d0c6a8fc43f220ff">getPosOccurenceArray</a>(oldIdx + 1);
<a name="l02380"></a>02380     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; gndClauseIndexes.<a class="code" href="classArray.html#d7a2ae7ae5e0d02cd7d4d9e2f696379e">size</a>(); i++)
<a name="l02381"></a>02381     {
<a name="l02382"></a>02382         <span class="comment">// Atom appears pos. in these clauses, so it appears as (oldIdx + 1)</span>
<a name="l02383"></a>02383       <span class="keywordflow">if</span> ((*gndClauses_)[gndClauseIndexes[i]])
<a name="l02384"></a>02384         (*gndClauses_)[gndClauseIndexes[i]]-&gt;changeGndPredIndex(oldIdx + 1,
<a name="l02385"></a>02385                                                                 newIdx + 1);
<a name="l02386"></a>02386     }
<a name="l02387"></a>02387   }
<a name="l02388"></a>02388 
<a name="l02389"></a>02389  <span class="keyword">private</span>:
<a name="l02390"></a>02390 
<a name="l02391"></a>02391     <span class="comment">// If true, this is a lazy variable state, else eager.</span>
<a name="l02392"></a>02392   <span class="keywordtype">bool</span> lazy_;
<a name="l02393"></a>02393 
<a name="l02394"></a>02394     <span class="comment">// Weight used for hard clauses (sum of soft weights + constant)</span>
<a name="l02395"></a>02395   <span class="keywordtype">long</span> <span class="keywordtype">double</span> hardWt_;
<a name="l02396"></a>02396   
<a name="l02397"></a>02397     <span class="comment">// mln and domain are used to build MRF in eager state and to</span>
<a name="l02398"></a>02398     <span class="comment">// retrieve active atoms in lazy state.</span>
<a name="l02399"></a>02399   <a class="code" href="classMLN.html">MLN</a>* mln_;
<a name="l02400"></a>02400   <a class="code" href="classDomain.html">Domain</a>* domain_;
<a name="l02401"></a>02401 
<a name="l02402"></a>02402     <span class="comment">// Eager version: Pointer to gndPreds_ and gndClauses_ in MRF</span>
<a name="l02403"></a>02403     <span class="comment">// Lazy version: Holds active atoms and clauses</span>
<a name="l02404"></a>02404   <a class="code" href="classArray.html">Array&lt;GroundPredicate*&gt;</a>* gndPreds_;
<a name="l02405"></a>02405   <a class="code" href="classArray.html">Array&lt;GroundClause*&gt;</a>* gndClauses_;
<a name="l02406"></a>02406   
<a name="l02407"></a>02407     <span class="comment">// Predicates corresponding to the groundings of the unknown non-evidence</span>
<a name="l02408"></a>02408     <span class="comment">// predicates</span>
<a name="l02409"></a>02409   <a class="code" href="classHashArray.html">GroundPredicateHashArray</a>* unePreds_;
<a name="l02410"></a>02410 
<a name="l02411"></a>02411     <span class="comment">// Predicates corresponding to the groundings of the known non-evidence</span>
<a name="l02412"></a>02412     <span class="comment">// predicates</span>
<a name="l02413"></a>02413   <a class="code" href="classHashArray.html">GroundPredicateHashArray</a>* knePreds_;
<a name="l02414"></a>02414     <span class="comment">// Actual truth values of ground known non-evidence preds</span>
<a name="l02415"></a>02415   <a class="code" href="classArray.html">Array&lt;TruthValue&gt;</a>* knePredValues_;  
<a name="l02416"></a>02416   
<a name="l02417"></a>02417 
<a name="l02419"></a>02419     <span class="comment">// Number of distinct atoms in the first set of unsatisfied clauses</span>
<a name="l02420"></a>02420   <span class="keywordtype">int</span> baseNumAtoms_;
<a name="l02421"></a>02421     <span class="comment">// If true, atoms are not deactivated when mem. is full</span>
<a name="l02422"></a>02422   <span class="keywordtype">bool</span> noApprox_;
<a name="l02423"></a>02423     <span class="comment">// Indicates whether deactivation of atoms has taken place yet</span>
<a name="l02424"></a>02424   <span class="keywordtype">bool</span> haveDeactivated_;
<a name="l02425"></a>02425     <span class="comment">// Max. amount of memory to use</span>
<a name="l02426"></a>02426   <span class="keywordtype">int</span> memLimit_;
<a name="l02427"></a>02427     <span class="comment">// Max. amount of clauses memory can hold</span>
<a name="l02428"></a>02428   <span class="keywordtype">int</span> clauseLimit_;
<a name="l02430"></a>02430 
<a name="l02431"></a>02431 
<a name="l02433"></a>02433     <span class="comment">// MRF is used with eager states. If lazy, this stays NULL.</span>
<a name="l02434"></a>02434   <a class="code" href="classMRF.html">MRF</a>* mrf_;
<a name="l02436"></a>02436 
<a name="l02437"></a>02437     <span class="comment">// Holds the new active clauses</span>
<a name="l02438"></a>02438   <a class="code" href="classArray.html">Array&lt;GroundClause*&gt;</a> newClauses_;
<a name="l02439"></a>02439     <span class="comment">// Holds the new gnd preds</span>
<a name="l02440"></a>02440   <a class="code" href="classArray.html">Array&lt;GroundPredicate*&gt;</a> newPreds_;
<a name="l02441"></a>02441     <span class="comment">// Holds the ground predicates in a hash array.</span>
<a name="l02442"></a>02442     <span class="comment">// Fast access is needed for comparing preds when activating clauses.</span>
<a name="l02443"></a>02443   <a class="code" href="classHashArray.html">GroundPredicateHashArray</a> gndPredHashArray_;
<a name="l02444"></a>02444 
<a name="l02445"></a>02445     <span class="comment">// Clauses to be satisfied</span>
<a name="l02446"></a>02446     <span class="comment">// Indexed as clause_[clause_num][literal_num]</span>
<a name="l02447"></a>02447   <a class="code" href="classArray.html">Array&lt;Array&lt;int&gt;</a> &gt; clause_;
<a name="l02448"></a>02448     <span class="comment">// Cost of each clause (can be negative)</span>
<a name="l02449"></a>02449   <a class="code" href="classArray.html">Array&lt;long double&gt;</a> clauseCost_;
<a name="l02450"></a>02450     <span class="comment">// Highest cost of false clause</span>
<a name="l02451"></a>02451   <span class="keywordtype">long</span> <span class="keywordtype">double</span> highestCost_;
<a name="l02452"></a>02452     <span class="comment">// If true, more than one clause has highest cost</span>
<a name="l02453"></a>02453   <span class="keywordtype">bool</span> eqHighest_;
<a name="l02454"></a>02454     <span class="comment">// Number of clauses with highest cost</span>
<a name="l02455"></a>02455   <span class="keywordtype">int</span> numHighest_;
<a name="l02456"></a>02456     <span class="comment">// Clauses which are pos. and unsatisfied or neg. and satisfied</span>
<a name="l02457"></a>02457   <a class="code" href="classArray.html">Array&lt;int&gt;</a> falseClause_;
<a name="l02458"></a>02458     <span class="comment">// Where each clause is listed in falseClause_</span>
<a name="l02459"></a>02459   <a class="code" href="classArray.html">Array&lt;int&gt;</a> whereFalse_;
<a name="l02460"></a>02460     <span class="comment">// Number of true literals in each clause</span>
<a name="l02461"></a>02461   <a class="code" href="classArray.html">Array&lt;int&gt;</a> numTrueLits_;
<a name="l02462"></a>02462     <span class="comment">// watch1_[c] contains the id of the first atom which c is watching</span>
<a name="l02463"></a>02463   <a class="code" href="classArray.html">Array&lt;int&gt;</a> watch1_;
<a name="l02464"></a>02464     <span class="comment">// watch2_[c] contains the id of the second atom which c is watching</span>
<a name="l02465"></a>02465   <a class="code" href="classArray.html">Array&lt;int&gt;</a> watch2_;
<a name="l02466"></a>02466     <span class="comment">// Which clauses are satisfied by fixed atoms</span>
<a name="l02467"></a>02467   <a class="code" href="classArray.html">Array&lt;bool&gt;</a> isSatisfied_;
<a name="l02468"></a>02468     <span class="comment">// Clauses which are not to be considered</span>
<a name="l02469"></a>02469   <a class="code" href="classArray.html">Array&lt;bool&gt;</a> deadClause_;
<a name="l02470"></a>02470     <span class="comment">// Use threshold to exclude clauses from the state?</span>
<a name="l02471"></a>02471   <span class="keywordtype">bool</span> useThreshold_;
<a name="l02472"></a>02472     <span class="comment">// Pre-computed thresholds for each clause</span>
<a name="l02473"></a>02473   <a class="code" href="classArray.html">Array&lt;long double&gt;</a> threshold_;
<a name="l02474"></a>02474 
<a name="l02475"></a>02475     <span class="comment">// Holds the index of clauses in which each literal occurs</span>
<a name="l02476"></a>02476     <span class="comment">// Indexed as occurence_[2*abs(lit) - (lit &gt; 0)][occurence_num]</span>
<a name="l02477"></a>02477   <a class="code" href="classArray.html">Array&lt;Array&lt;int&gt;</a> &gt; occurence_;
<a name="l02478"></a>02478 
<a name="l02479"></a>02479     <span class="comment">// Current assigment of atoms</span>
<a name="l02480"></a>02480   <a class="code" href="classArray.html">Array&lt;bool&gt;</a> atom_;
<a name="l02481"></a>02481     <span class="comment">// Cost of clauses which would become satisfied by flipping each atom</span>
<a name="l02482"></a>02482   <a class="code" href="classArray.html">Array&lt;long double&gt;</a> makeCost_;
<a name="l02483"></a>02483     <span class="comment">// Cost of clauses which would become unsatisfied by flipping each atom</span>
<a name="l02484"></a>02484   <a class="code" href="classArray.html">Array&lt;long double&gt;</a> breakCost_;
<a name="l02485"></a>02485     <span class="comment">// Indicates if an atom is fixed to a value (0 = not fixed, -1 = false,</span>
<a name="l02486"></a>02486     <span class="comment">// 1 = true)</span>
<a name="l02487"></a>02487   <a class="code" href="classArray.html">Array&lt;int&gt;</a> fixedAtom_;
<a name="l02488"></a>02488 
<a name="l02489"></a>02489     <span class="comment">// Assigment of atoms producing lowest cost so far</span>
<a name="l02490"></a>02490   <a class="code" href="classArray.html">Array&lt;bool&gt;</a> lowAtom_;
<a name="l02491"></a>02491     <span class="comment">// Cost of false clauses in the currently best state</span>
<a name="l02492"></a>02492   <span class="keywordtype">long</span> <span class="keywordtype">double</span> lowCost_;
<a name="l02493"></a>02493     <span class="comment">// Number of false clauses in the currently best state</span>
<a name="l02494"></a>02494   <span class="keywordtype">int</span> lowBad_;
<a name="l02495"></a>02495 
<a name="l02496"></a>02496     <span class="comment">// Current no. of unsatisfied clauses</span>
<a name="l02497"></a>02497   <span class="keywordtype">int</span> numFalseClauses_;
<a name="l02498"></a>02498     <span class="comment">// Cost associated with the number of false clauses</span>
<a name="l02499"></a>02499   <span class="keywordtype">long</span> <span class="keywordtype">double</span> costOfFalseClauses_;
<a name="l02500"></a>02500   
<a name="l02501"></a>02501     <span class="comment">// For block inference: blocks_ and blockEvidence_</span>
<a name="l02502"></a>02502     <span class="comment">// All atom indices in (*blocks_)[i] are to be treated as in one block</span>
<a name="l02503"></a>02503   <a class="code" href="classArray.html">Array&lt;Array&lt;int&gt;</a> &gt;* blocks_;
<a name="l02504"></a>02504     <span class="comment">// (*blockEvidence_)[i] states whether block i has true evidence and</span>
<a name="l02505"></a>02505     <span class="comment">// thus all should be false</span>
<a name="l02506"></a>02506   <a class="code" href="classArray.html">Array&lt;bool &gt;</a>* blockEvidence_;
<a name="l02507"></a>02507 
<a name="l02508"></a>02508     <span class="comment">// Number of active atoms in state.  </span>
<a name="l02509"></a>02509   <span class="keywordtype">int</span> activeAtoms_;
<a name="l02510"></a>02510   
<a name="l02511"></a>02511 };
<a name="l02512"></a>02512 
<a name="l02513"></a>02513 <span class="preprocessor">#endif </span><span class="comment">/*VARIABLESTATE_H_*/</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Feb 14 15:15:19 2007 for Alchemy by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1 </small></address>
</body>
</html>
